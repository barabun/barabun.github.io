<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html>
<html epub:prefix="z3998: http://www.daisy.org/z3998/2012/vocab/structure/#" lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
 <head>
  <link href="style.css" rel="stylesheet" type="text/css"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   6: C++ usage
  </title>
 </head>
 <body>
  <div class="navigation">
   <a class="nav-button" href="chapter_014.html">
    ← Previous
   </a>
   <a class="nav-button" href="index.html">
    Table of Contents
   </a>
   <a class="nav-button" href="chapter_016.html">
    Next →
   </a>
  </div>
  <div class="chapter-content">
   <div id="sbo-rt-content">
    <span aria-label="209" epub:type="pagebreak" id="pagebreak_209" role="doc-pagebreak">
    </span>
    <section epub:type="chapter" id="CH0006" role="doc-chapter" xmlns:epub="http://www.idpf.org/2007/ops">
     <h1 class="chaptitle" epub:type="title" id="B9780443222191000106">
      6: C++ usage
     </h1>
     <section epub:type="preamble">
      <a id="abs0010">
      </a>
      <div class="abstract">
       <h2 class="h1hd" id="cesectitle0010">
        Abstract
       </h2>
       <div id="abssec0010">
        <p class="abspara" id="abspara0010">
         This chapter deals with core C++ language features that can affect application programming interface (API) design. This includes using namespaces via either a consistent prefix for all API symbols or the C++ namespace keyword. The topic of how to declare constructors and assignment operators correctly is then covered, including the Rule of Three. Const correctness issues are then covered, including method, parameter, and return value const correctness. Template API issues are discussed, such as implicit versus explicit instantiation and best practices for laying out template header files. The section on operator overloading describes how to define operators in the most robust fashion and how to decide whether an operator should be a member or free function. The use of default arguments is presented as one way to make backward-compatible API changes, although sometimes overloaded functions provide a better solution. The use of #define to define constants and enums is discouraged and alternative strongly typed options are provided. The use of friends is also discouraged because they can break encapsulation and allow clients to access internal details. The topic of symbol exporting is also explained, including the use of __declspec attributes for exposing symbols in a dynamic library on Windows. Finally, the use of good coding conventions is advocated and an example framework for such a document is presented.
        </p>
       </div>
      </div>
     </section>
     <section>
      <h3 class="h2hd" id="cesectitle0015">
       Keywords
      </h3>
      <div class="keywords">
       Assignment; Const correctness; Constructor; Default argument; Friends; Namespace; Operator overloading; Parameter; Rule of three; Template
      </div>
     </section>
     <section>
      <p class="textfl" id="p0010">
       This chapter explores the qualities that make a good application programming interface (API) in C++. The generic API qualities that I covered in
       <a href="../B9780443222191000143/CH0002_25-80_B9780443222191000143.xhtml">
        Chapter 2
       </a>
       could be applied to any programming language: the concepts of hiding private details, ease of use, loose coupling, and minimal completeness transcend the use of any programming language. Although I presented C++-specific examples for each of these topics, the concepts themselves are language agnostic.
      </p>
      <p class="text" id="p0015">
       However, there are many specific C++ style decisions that can affect the quality of an API, such as the use of namespaces, operators, friends, and const correctness. I will discuss each of these, and more, in the following sections.
      </p>
      <p class="text" id="p0020">
       This chapter will focus on issues that are applicable across all revisions of the C++ standard: in other words, those that relate only to C++98 and C++03. I will address newer features that relate to API design for C++11 and later revisions in the following chapter.
      </p>
      <p class="text" id="p0025">
       Note that I will defer some performance-related C++ topics, such as inlining and const references, until the later chapter on Performance. I will cover topics relating to multithreading in the chapter on Concurrency.
      </p>
      <section>
       <a id="s0010">
       </a>
       <h2 class="h1hd" id="cesectitle0020">
        Namespaces
       </h2>
       <p class="textfl" id="p0030">
        A namespace is a logical grouping of unique symbols. It provides a way to avoid naming collisions, so that two APIs don't try to define symbols with the same name. For example, if two APIs both define a class called
        <span class="inlinecode">
         String
        </span>
        , then you cannot use the two APIs in the same program because only one definition can exist at any time. You should always use some form of namespacing in your APIs to ensure that they can interoperate with any other APIs that your clients may decide to use.
       </p>
       <p class="text" id="p0035">
        There are two common ways that you can add a namespace to your API. The first is to use a unique prefix for all of your public API symbols, which has the benefit that it can be used for plain C APIs as well. There are many examples of this type of namespacing:
       </p>
       <div>
        <ol id="ulist0010">
         <li class="bulllist" id="p0040">
          <a id="u0010">
          </a>
          ▪ The OpenGL API uses “gl” as a prefix for all public symbols (e.g.,
          <span class="inlinecode">
           glBegin()
          </span>
          ,
          <span class="inlinecode">
           glVertex3f()
          </span>
          , and
          <span class="inlinecode">
           GL_BLEND_COLOR)
          </span>
          (
          <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib87" id="bib_87">
           Shreiner, 2004
          </a>
          ).
         </li>
         <li class="bulllist" id="p0045">
          <a id="u0015">
          </a>
          ▪ The Qt API uses the “Q” prefix for all public names (e.g.,
          <span class="inlinecode">
           QWidget
          </span>
          ,
          <span class="inlinecode">
           QApplication
          </span>
          , and
          <span class="inlinecode">
           Q_FLAGS)
          </span>
          .
         </li>
         <li class="bulllist" id="p0050">
          <a id="u0020">
          </a>
          ▪ The libpng library uses the “png” prefix for all identifiers (e.g.,
          <span class="inlinecode">
           png_read_row()
          </span>
          ,
          <span class="inlinecode">
           png_create_write_struct()
          </span>
          , and
          <span class="inlinecode">
           png_set_invalid())
          </span>
          .
         </li>
         <li class="bulllist" id="p0055">
          <a id="u0025">
          </a>
          ▪ The GNU GTK
          <span title='hsp="0.25"'>
          </span>
          +
          <span title='hsp="0.25"'>
          </span>
          API uses the “gtk” prefix (e.g.,
          <span class="inlinecode">
           gtk_init()
          </span>
          ,
          <span class="inlinecode">
           gtk_style_new()
          </span>
          , and
          <span class="inlinecode">
           GtkArrowType)
          </span>
          .
          <a id="p210">
          </a>
         </li>
         <li>
          <span aria-label="210" epub:type="pagebreak" id="pagebreak_210" role="doc-pagebreak">
          </span>
         </li>
         <li class="bulllist" id="p0060">
          <a id="u0030">
          </a>
          ▪ The Second Life source code uses the “LL” prefix (short for Linden Lab) for various classes, enums, and constants (e.g.,
          <span class="inlinecode">
           LLEvent
          </span>
          ,
          <span class="inlinecode">
           LLUUID
          </span>
          , and
          <span class="inlinecode">
           LL_ACK_FLAG)
          </span>
          .
         </li>
         <li class="bulllist" id="p0065">
          <a id="u0035">
          </a>
          ▪ The Netscape Portable Runtime names all exported types with a “PR” prefix (e.g.,
          <span class="inlinecode">
           PR_WaitCondVar()
          </span>
          ,
          <span class="inlinecode">
           PR_fprintf()
          </span>
          , and
          <span class="inlinecode">
           PRFileDesc)
          </span>
          .
         </li>
        </ol>
       </div>
       <p class="text" id="p0070">
        The second approach is to use the C++
        <span class="inlinecode">
         namespace
        </span>
        keyword. This essentially defines a scope where any names within that scope are given an additional prefix identifier. For example,
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0010">
          <img alt="image" height="545" src="../../IMAGES/B9780443222191000106/main.assets/u06-01-9780443222191.jpg" width="727"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="text" id="p0075">
        The
        <span class="inlinecode">
         String
        </span>
        class in this case must now be referenced as
        <span class="inlinecode">
         MyAPI::String
        </span>
        . The benefit of this style is that you don't need to meticulously ensure that every class, function, enum, or constant has a consistent prefix: the compiler does it for you. This method is used by the C++ Standard Library, in which all container classes, iterators, and algorithms are contained within the “std” namespace. You can also create nested namespaces, forming a namespace tree. For example, Intel's Threading Build Blocks API uses the “tbb” namespace for all of its public symbols and tbb:strict_ppl for internal code. The Boost libraries also use nested namespaces inside of the root “boost” namespace (e.g., the
        <span class="inlinecode">
         boost::variant
        </span>
        namespace contains the public symbols for the Boost Variant API and
        <span class="inlinecode">
         boost::detail::variant
        </span>
        contains the internal details for that API).
       </p>
       <p class="text" id="p0080">
        Using the namespace feature can produce verbose symbol names, particularly for symbols that are contained within several nested namespaces. However, C++ provides a way to make it more convenient to use symbols within a namespace with the
        <span class="inlinecode">
         using
        </span>
        keyword:
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0015">
          <img alt="image" height="139" src="../../IMAGES/B9780443222191000106/main.assets/u06-02-9780443222191.jpg" width="1005"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="text" id="p0085">
        or, preferably (because it limits the extent of symbols imported into the global namespace):
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0020">
          <img alt="image" height="139" src="../../IMAGES/B9780443222191000106/main.assets/u06-03-9780443222191.jpg" width="1004"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="text" id="p0090">
        However, you should never use the
        <span class="inlinecode">
         using
        </span>
        keyword in the global scope of your public API headers! Doing so would cause all of the symbols in the referenced namespace to
        <a id="p211">
        </a>
        <span aria-label="211" epub:type="pagebreak" id="pagebreak_211" role="doc-pagebreak">
        </span>
        become visible in the global namespace. This would subvert the entire point of using namespaces in the first place (
        <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib92" id="bib_92">
         Stroustrup, 2000
        </a>
        ). If you wish to reference symbols in another namespace in your header files, then always use the fully qualified name (e.g.,
        <span class="inlinecode">
         std::string)
        </span>
        .
       </p>
       <div>
        <aside aria-labelledby="b0010" epub:type="sidebar">
         <div class="box_top_space">
         </div>
         <div class="boxg1" id="b0010">
          <div class="b1textfl" id="bpar0010">
           <i>
            TIP: Always provide a namespace for your API symbols, via either a consistent naming prefix or the C++
           </i>
           <span class="inlinecode">
            <i>
             namespace
            </i>
           </span>
           <i>
            keyword.
           </i>
          </div>
         </div>
        </aside>
       </div>
      </section>
      <section>
       <a id="s0015">
       </a>
       <h2 class="h1hd" id="cesectitle0025">
        Constructors and assignment
       </h2>
       <p class="textfl" id="p0095">
        If you are creating objects that contain state and that may be copied or assigned by client programs (sometimes called value objects), you need to consider the correct design of your constructors and assignment operator. Your compiler will generate default versions of these methods for you if you don't define them yourself. However, if your class has any dynamically allocated objects, then you must explicitly define these methods yourself to ensure that the objects are copied correctly. Specifically, your C++03 compiler can generate default versions for the following four special methods (in the next chapter, we'll learn about two further special methods added in C++11):
       </p>
       <div>
        <ol id="ulist0015">
         <li class="bulllist" id="p0100">
          <a id="u0040">
          </a>
          ▪
          <b>
           Default constructor.
          </b>
          A constructor is used to initialize an object after it’s been allocated by the
          <span class="inlinecode">
           new
          </span>
          call. You can define multiple constructors with different arguments. The default constructor is defined as the constructor that can be called with no arguments (this could be a constructor with no arguments or with arguments that all specify default values). Your C++ compiler will automatically generate a default constructor if you do not explicitly define one. Note, however, that if you define a nondefault constructor, the compiler will no longer generate a default constructor for you.
         </li>
         <li class="bulllist" id="p0105">
          <a id="u0045">
          </a>
          ▪
          <b>
           Destructor.
          </b>
          The destructor is called in response to a
          <span class="inlinecode">
           delete
          </span>
          call to release any resources the object is holding. There can be only one destructor for a class. If you don't specify a destructor, your C++ compiler will generate one automatically. The compiler will also generate code to call the destructors automatically for all your member variables in the reverse order they appear in the class declaration. The destructors for any base classes will be called automatically.
         </li>
         <li class="bulllist" id="p0110">
          <a id="u0050">
          </a>
          ▪
          <b>
           Copy constructor.
          </b>
          A copy constructor is a special constructor that creates a new object from an existing object. If you don't define a copy constructor, the compiler will generate one for you that performs a shallow copy of the existing object's member variables. If your object allocates any resources, you most likely need a copy constructor so you can perform a deep copy. The copy constructor gets called in the following situations:
         </li>
         <li class="bulllist">
          <ol id="ulist0020">
           <li class="bulllist1" id="p0115">
            <a id="u0055">
            </a>
            • An object is passed to a method by value or returned by value.
           </li>
           <li class="bulllist1" id="p0120">
            <a id="u0060">
            </a>
            • An object is initialized using the syntax
            <span class="inlinecode">
             MyClass a = b;
            </span>
           </li>
           <li class="bulllist1" id="p0125">
            <a id="u0065">
            </a>
            • An object is placed in a brace-enclosed initializer list.
            <a id="p212">
            </a>
           </li>
           <li>
            <span aria-label="212" epub:type="pagebreak" id="pagebreak_212" role="doc-pagebreak">
            </span>
           </li>
           <li class="bulllist1" id="p0130">
            <a id="u0070">
            </a>
            • An object is thrown or caught in an exception.
           </li>
          </ol>
         </li>
         <li class="bulllist" id="p0135">
          <a id="u0075">
          </a>
          ▪
          <b>
           Assignment operator.
          </b>
          The assignment operator is used to assign the value of one object to another object (e.g.,
          <span class="inlinecode">
           a = b)
          </span>
          . It differs from the copy constructor in that the object to which it is being assigned already exists. Some guidelines for implementing the assignment operator include:
         </li>
         <li class="bulllist">
          <ul class="ce_list" id="olist0010">
           <li class="numlist1" id="p0140">
            <a id="o0010">
            </a>
            1. Use a const reference for the right-hand operand.
           </li>
           <li class="numlist1" id="p0145">
            <a id="o0015">
            </a>
            2. Return
            <span class="inlinecode">
             ∗this
            </span>
            as a reference to allow operator chaining.
           </li>
           <li class="numlist1" id="p0150">
            <a id="o0020">
            </a>
            3. Destroy any existing state before setting the new state.
           </li>
           <li class="numlist1" id="p0155">
            <a id="o0025">
            </a>
            4. Check for self-assignment (
            <span class="inlinecode">
             a = a
            </span>
            ) by comparing
            <span class="inlinecode">
             this
            </span>
            with
            <span class="inlinecode">
             &amp;rhs
            </span>
            .
           </li>
          </ul>
         </li>
        </ol>
       </div>
       <div id="p0160">
        As a corollary to this, if you wish to create objects that should never be copied by your clients (also known as reference objects), then you should mark the object as noncopyable by declaring the copy constructor and assignment operator as private class members, or as of C++11, you can use the
        <span title='hsp="0.25"'>
        </span>
        =
        <span title='hsp="0.25"'>
        </span>
        <span class="inlinecode">
         delete
        </span>
        specifier after the function's declaration.
       </div>
       <p class="text" id="p0165">
        Many novice C++ developers get into trouble because they have a class that allocates resources, and hence requires a destructor, but they don't also define a copy constructor and assignment operator. For example, consider the following simple integer array class where I show the implementation of the constructor and destructor inline to clarify the behavior:
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0025">
          <img alt="image" height="1297" src="../../IMAGES/B9780443222191000106/main.assets/u06-04-9780443222191.jpg" width="1213"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="text" id="p0170">
        This class allocates memory but does not define either a copy constructor or an assignment operator. As a result, the following code will crash when the two variables go out of scope because the destructor of each will try to free the same memory:
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0030">
          <img alt="image" height="255" src="../../IMAGES/B9780443222191000106/main.assets/u06-05-9780443222191.jpg" width="2115"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="textfl">
        <a id="p213">
        </a>
       </p>
       <div>
        <span aria-label="213" epub:type="pagebreak" id="pagebreak_213" role="doc-pagebreak">
        </span>
       </div>
       <p class="text" id="p0175">
        When creating a value object, it's therefore essential that you follow the rule of “the Big Three”, also called “the Rule of Three”. This term was introduced by Marshall Cline in the early 1990s and essentially states that there are three member functions that always go together: the destructor, the copy constructor, and the assignment operator (
        <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib17" id="bib_17">
         Cline et al., 1998
        </a>
        ). If you define one of these, you normally need to define the other two as well (declaring an empty virtual destructor to enable subclassing is one exception, because it doesn't perform an actual deallocation). James Coplien referred to this same concept as the orthodox canonical class form (
        <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib21" id="bib_21">
         Coplien, 1991
        </a>
        ).
       </p>
       <div>
        <aside aria-labelledby="b0015" epub:type="sidebar">
         <div class="box_top_space">
         </div>
         <div class="boxg1" id="b0015">
          <div class="b1textfl" id="bpar0015">
           <i>
            TIP: If your class allocates resources, you should follow the Rule of Three and define a destructor, copy constructor, and assignment operator.
           </i>
          </div>
         </div>
        </aside>
       </div>
       <p class="text" id="p0180">
        Note: C++11 introduced the move constructor and move assignment operator, resulting in the Rule of Three changing to the Rule of Five. However, following the Rule of Three is still valid because the new move functions will fall back to using your copy functions if not defined. I will discuss this further in the next chapter on C++ Revisions.
       </p>
       <section>
        <a id="s0020">
        </a>
        <h3 class="h2hd" id="cesectitle0030">
         Defining constructors and assignment
        </h3>
        <p class="textfl" id="p0185">
         Writing constructors and operators can be a tricky business, so here's an example that demonstrates the various combinations. It builds on the earlier array example and presents a class for storing an array of strings. The array is allocated dynamically, so you must define a copy constructor and assignment operator; otherwise the memory will be freed twice on destruction if you copy the array. Here's the declaration of the
         <span class="inlinecode">
          Array
         </span>
         class in the header file:
         <a id="p214">
         </a>
         <span aria-label="214" epub:type="pagebreak" id="pagebreak_214" role="doc-pagebreak">
         </span>
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0035">
           <img alt="image" height="1412" src="../../IMAGES/B9780443222191000106/main.assets/u06-06-9780443222191.jpg" width="1663"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="textfl">
         And here are sample definitions for the constructors and assignment operator:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0040">
           <img alt="image" height="2109" src="../../IMAGES/B9780443222191000106/main.assets/u06-07-9780443222191.jpg" width="1892"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0190">
         Given the previous
         <span class="inlinecode">
          Array
         </span>
         class, the follow code demonstrates when the various methods will be called:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0045">
           <img alt="image" height="313" src="../../IMAGES/B9780443222191000106/main.assets/u06-08-9780443222191.jpg" width="2218"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="textfl">
         <a id="p215">
         </a>
        </p>
        <div>
         <span aria-label="215" epub:type="pagebreak" id="pagebreak_215" role="doc-pagebreak">
         </span>
        </div>
        <p class="text" id="p0195">
         Note: there are certain cases in which your compiler may elide the call to your copy constructor: for example, if it performs some form of return value optimization (
         <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib67" id="bib_67">
          Meyers, 1998
         </a>
         ).
        </p>
       </section>
       <section>
        <a id="s0025">
        </a>
        <h3 class="h2hd" id="cesectitle0035">
         The explicit keyword
        </h3>
        <p class="textfl" id="p0200">
         You may have noticed the use of the
         <span class="inlinecode">
          explicit
         </span>
         keyword before the declaration of the nondefault constructor in the previous
         <span class="inlinecode">
          Array
         </span>
         example. Adding
         <span class="inlinecode">
          explicit
         </span>
         is a good general practice for any nondefault constructor that accepts a single argument. It's used to prevent a nondefault constructor from being called implicitly when constructing an object. For example, without the
         <span class="inlinecode">
          explicit
         </span>
         keyword, this code is valid C++:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0050">
           <img alt="image" height="81" src="../../IMAGES/B9780443222191000106/main.assets/u06-09-9780443222191.jpg" width="449"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0205">
         This will call the
         <span class="inlinecode">
          Array
         </span>
         nondefault constructor with the integer argument of 10. However, this type of implicit behavior can be confusing, unintuitive, and in most cases unintended. As a further example of this kind of undesired implicit conversion, consider the function signature:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0055">
           <img alt="image" height="81" src="../../IMAGES/B9780443222191000106/main.assets/u06-10-9780443222191.jpg" width="1732"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0210">
         Without declaring the single-argument constructor of
         <span class="inlinecode">
          Array
         </span>
         as explicit, you could call this function as:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0060">
           <img alt="image" height="81" src="../../IMAGES/B9780443222191000106/main.assets/u06-11-9780443222191.jpg" width="796"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0215">
         This weakens the type safety of your API because now the compiler will not enforce the type of the first argument to be an explicit
         <span class="inlinecode">
          Array
         </span>
         object. As a result, there's the potential for the user to forget the correct order of arguments and pass them in the wrong order. This is why you should always use the
         <span class="inlinecode">
          explicit
         </span>
         keyword for any single-argument constructors unless you know that you want to support implicit conversion.
        </p>
        <p class="text" id="p0220">
         You can also declare your copy constructor to be explicit, too. This will prevent implicit invocations of the copy constructor, such as passing an object to a function by value or returning an object by value. However, you will still be able to call the copy constructor explicitly using the “
         <span class="inlinecode">
          Array a = b
         </span>
         ” or “
         <span class="inlinecode">
          Array a(b)
         </span>
         ” syntax. As of C++11, you can use the
         <span class="inlinecode">
          explicit
         </span>
         keyword in front of conversion operators as well as constructors. Doing so will prevent those conversion functions from being used for implicit conversions.
         <a id="p216">
         </a>
         <span aria-label="216" epub:type="pagebreak" id="pagebreak_216" role="doc-pagebreak">
         </span>
        </p>
        <div>
         <aside aria-labelledby="b0020" epub:type="sidebar">
          <div class="box_top_space">
          </div>
          <div class="boxg1" id="b0020">
           <div class="b1textfl" id="bpar0020">
            <i>
             TIP: Consider using the
            </i>
            <span class="inlinecode">
             <i>
              explicit
             </i>
            </span>
            <i>
             keyword before the declaration of any noncopy constructor with a single argument.
            </i>
           </div>
          </div>
         </aside>
        </div>
       </section>
      </section>
      <section>
       <a id="s0030">
       </a>
       <h2 class="h1hd" id="cesectitle0040">
        Const correctness
       </h2>
       <p class="textfl" id="p0225">
        Const correctness refers to the use of the C++
        <span class="inlinecode">
         const
        </span>
        keyword to declare a variable or method as immutable. It's a compile time construct that you can use to maintain the correctness of code that shouldn't modify certain variables. In C++, you can define variables as const, meaning that they should not be modified, and you can also define methods as const, meaning that they should not modify any member variables of the class. Using const correctness is simply good programming practice. However, it can also provide documentation of the intent of your methods, and hence make them easier to use.
       </p>
       <div>
        <aside aria-labelledby="b0025" epub:type="sidebar">
         <div class="box_top_space">
         </div>
         <div class="boxg1" id="b0025">
          <div class="b1textfl" id="bpar0025">
           <i>
            TIP: Ensure that your API is const correct.
           </i>
          </div>
         </div>
        </aside>
       </div>
       <section>
        <a id="s0035">
        </a>
        <h3 class="h2hd" id="cesectitle0045">
         Method const correctness
        </h3>
        <p class="textfl" id="p0230">
         A const method cannot modify any of the member variables of the class. In essence, all of the member variables are treated as const variables inside a const method. This form of const correctness is indicated by appending the
         <span class="inlinecode">
          const
         </span>
         keyword after the method's parameter list. There are two principal benefits of declaring a method as const:
        </p>
        <div>
         <ul class="ce_list" id="olist0015">
          <li class="numlist" id="p0235">
           <a id="o0030">
           </a>
           1. To advertise the fact that the method will not change the state of the object. As I've just mentioned, this is helpful documentation for the users of your API.
          </li>
          <li class="numlist" id="p0240">
           <a id="o0035">
           </a>
           2. To allow the method to be used on const versions of an object. A nonconst method cannot be called on a const version of an object.
          </li>
         </ul>
        </div>
        <p class="text" id="p0245">
         Scott Meyers describes two camps of philosophy about what a const method represents. There's the bitwise constness camp, which believes that a const method should not change any of the member variables of a class, and then there's the logical constness camp, which says that a const method may change a member variable if that change cannot be detected by the user (
         <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib70" id="bib_70">
          Meyers, 2005
         </a>
         ). Your C++ compiler conforms to the bitwise approach. However, there are times when you really want it to behave in the logical constness manner. A classic example is if you want to cache some property of a class because it takes too long to compute. For example, consider a
         <span class="inlinecode">
          HashTable
         </span>
         class that needs to return the number of elements in the hash table very efficiently. As a result, you
         <a id="p217">
         </a>
         <span aria-label="217" epub:type="pagebreak" id="pagebreak_217" role="doc-pagebreak">
         </span>
         decide to cache its size and compute the value lazily, on demand. Given the following class declaration:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0065">
           <img alt="image" height="834" src="../../IMAGES/B9780443222191000106/main.assets/u06-12-9780443222191.jpg" width="1490"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0250">
         you may want to implement the
         <span class="inlinecode">
          Size()
         </span>
         const method as:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0070">
           <img alt="image" height="544" src="../../IMAGES/B9780443222191000106/main.assets/u06-13-9780443222191.jpg" width="1317"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0255">
         Unfortunately this is not legal C++, because the
         <span class="inlinecode">
          Size()
         </span>
         method does actually modify member variables (
         <span class="inlinecode">
          mSizeIsDirty
         </span>
         and
         <span class="inlinecode">
          mCachedSize
         </span>
         ). However, these are not part of our logical public interface: they are internal state that lets us offer a more efficient API. This is why there is the notion of logical constness. C++ provides a way around this problem with the
         <span class="inlinecode">
          mutable
         </span>
         keyword. Declaring the
         <span class="inlinecode">
          mCachedSize
         </span>
         and
         <span class="inlinecode">
          mSizeIsDirty
         </span>
         variables as mutable means that they can be modified within a const method. Using
         <span class="inlinecode">
          mutable
         </span>
         is a great way to maintain the logical constness of your API, rather than removing the
         <span class="inlinecode">
          const
         </span>
         keyword on a member function that really should be declared const:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0075">
           <img alt="image" height="602" src="../../IMAGES/B9780443222191000106/main.assets/u06-14-9780443222191.jpg" width="1040"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="textfl">
         <a id="p218">
         </a>
         <span aria-label="218" epub:type="pagebreak" id="pagebreak_218" role="doc-pagebreak">
         </span>
        </p>
        <div>
         <aside aria-labelledby="b0030" epub:type="sidebar">
          <div class="box_top_space">
          </div>
          <div class="boxg1" id="b0030">
           <div class="b1textfl" id="bpar0030">
            <i>
             TIP: Declare methods and parameters as const as soon as you can. Trying to retrofit const correctness into an API later can be a time-consuming and frustrating activity.
            </i>
           </div>
          </div>
         </aside>
        </div>
       </section>
       <section>
        <a id="s0040">
        </a>
        <h3 class="h2hd" id="cesectitle0050">
         Parameter const correctness
        </h3>
        <p class="textfl" id="p0260">
         The
         <span class="inlinecode">
          const
         </span>
         keyword can also be used to indicate whether you intend for a parameter to be an input or an output: that is, a parameter that's used to pass some value into a method or one that is used to receive some result. For example, consider a method such as:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0080">
           <img alt="image" height="81" src="../../IMAGES/B9780443222191000106/main.assets/u06-15-9780443222191.jpg" width="1524"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0265">
         It's not clear from this function signature whether this method will modify the string that you pass in. Clearly it returns a string result, but perhaps it also changes the parameter string. It certainly could do so if it wanted to. If the purpose of this method is to take the parameter and return a lowercase version without affecting the input string, then the simple addition of const can make this unequivocally clear:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0085">
           <img alt="image" height="81" src="../../IMAGES/B9780443222191000106/main.assets/u06-16-9780443222191.jpg" width="1734"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0270">
         Now the compiler will enforce the fact that the function
         <span class="inlinecode">
          StringToLower()
         </span>
         will not modify the string that the user passes in. As a result, it's clear and unambiguous what the intended use of this function is just by looking at the function signature.
        </p>
        <p class="text" id="p0275">
         Often, you'll find that if you have a const method, any reference or pointer parameters can also be declared const. Although this is not a hard and fast rule, it follows logically from the general promise that the const method doesn't modify any state. For example, in the following function the
         <span class="inlinecode">
          root_node
         </span>
         parameter can be declared const because it's not necessary to modify this object to compute the result of the const method:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0090">
           <img alt="image" height="81" src="../../IMAGES/B9780443222191000106/main.assets/u06-17-9780443222191.jpg" width="1734"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <div>
         <aside aria-labelledby="b0035" epub:type="sidebar">
          <div class="box_top_space">
          </div>
          <div class="boxg1" id="b0035">
           <div class="b1textfl" id="bpar0035">
            <i>
             TIP: When passing a reference or pointer into a const method, think about whether that parameter can be declared const, too.
            </i>
           </div>
          </div>
         </aside>
        </div>
        <p class="textfl">
         <a id="p219">
         </a>
        </p>
        <div>
         <span aria-label="219" epub:type="pagebreak" id="pagebreak_219" role="doc-pagebreak">
         </span>
        </div>
       </section>
       <section>
        <a id="s0045">
        </a>
        <h3 class="h2hd" id="cesectitle0055">
         Return value const correctness
        </h3>
        <p class="textfl" id="p0280">
         When returning the result of a function, the main reason to declare that result as const is if it references the internal state of the object. For example, if you're returning a result by value, then it makes little sense to specify it as const, because the returned object will be a copy and hence changing it will not affect any of your class's internal state.
        </p>
        <p class="text" id="p0285">
         Alternatively, if you return a pointer or reference to a private data member, then you should declare the result to be const; otherwise users will be able to modify your internal state without going through your public API. In this case, you must also think about whether the returned pointer or reference will survive longer than your class. If this is possible, you should consider returning a reference-counted pointer such as an
         <span class="inlinecode">
          std::weak_ptr
         </span>
         or
         <span class="inlinecode">
          std::shared_ptr
         </span>
         , as discussed earlier in
         <a href="../B9780443222191000143/CH0002_25-80_B9780443222191000143.xhtml">
          Chapter 2
         </a>
         .
        </p>
        <p class="text" id="p0290">
         Therefore, the most common decision you will have with respect to return value const correctness is whether to return the result by value or const reference, that is,
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0095">
           <img alt="image" height="660" src="../../IMAGES/B9780443222191000106/main.assets/u06-18-9780443222191.jpg" width="1179"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0295">
         In general, I recommend that you return the result by value because it's safer. You may prefer the const reference method in a few cases where performance is critical, but it's likely that modern compiler optimizations will make most of those cases unnecessary. Returning by value is safer because you don't have to worry about clients holding on to references after your object has been destroyed, but also because returning a const reference can break encapsulation. It also makes multithreaded cases more complicated because the responsibility to perform locking is moved to the client instead of being kept behind the API call.
        </p>
        <div>
         <aside aria-labelledby="b0040" epub:type="sidebar">
          <div class="box_top_space">
          </div>
          <div class="boxg1" id="b0040">
           <div class="b1textfl" id="bpar0040">
            <i>
             TIP: Prefer to return the result of a function by value, rather than const reference.
            </i>
           </div>
          </div>
         </aside>
        </div>
        <p class="text" id="p0300">
         On the face of it, our earlier const reference
         <span class="inlinecode">
          GetName()
         </span>
         method seems acceptable: the method is declared to be const to indicate that it doesn't modify the state of the object, and the returned reference to the object's internal state is also declared to be const so that clients can't modify it. However, a determined client can always cast away the
         <a id="p220">
         </a>
         <span aria-label="220" epub:type="pagebreak" id="pagebreak_220" role="doc-pagebreak">
         </span>
         constness of the reference and then directly modify the underlying private data member, such as in this example:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0100">
           <img alt="image" height="487" src="../../IMAGES/B9780443222191000106/main.assets/u06-19-9780443222191.jpg" width="2011"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
       </section>
      </section>
      <section>
       <a id="s0050">
       </a>
       <h2 class="h1hd" id="cesectitle0060">
        Templates
       </h2>
       <p class="textfl" id="p0305">
        Templates provide a versatile and powerful ability to generate code at compile time. They are particularly useful for generating lots of code that looks similar but differs only by type. However, if you decide to provide class templates as part of your public API, there are several issues you should consider to ensure that you provide a well-insulated, efficient, and cross-platform interface. The following sections will address several of these factors.
       </p>
       <p class="text" id="p0310">
        Note that I will not cover all aspects of template programming here, only those features that affect good API design. For a more thorough and in-depth treatment of templates, there are several other good books on the market (
        <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib48" id="bib_48">
         Josuttis, 1999
        </a>
        ;
        <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib3" id="bib_3">
         Alexandrescu, 2001
        </a>
        ;
        <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib100" id="bib_100">
         Vandevoorde and Josuttis, 2002
        </a>
        ).
       </p>
       <section>
        <a id="s0055">
        </a>
        <h3 class="h2hd" id="cesectitle0065">
         Template terminology
        </h3>
        <p class="textfl" id="p0315">
         Templates are an often poorly understood part of the C++ specification, so let's begin by defining some terms so that we can proceed from a common base. I will use this template declaration as a reference for the definitions:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0105">
           <img alt="image" height="660" src="../../IMAGES/B9780443222191000106/main.assets/u06-20-9780443222191.jpg" width="900"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0320">
         This class template describes a generic stack class where you can specify the type of the elements in the stack,
         <span class="inlinecode">
          T
         </span>
         :
        </p>
        <div>
         <ol id="ulist0025">
          <li class="bulllist" id="p0325">
           <a id="u0080">
           </a>
           ▪
           <b>
            Template Parameters
           </b>
           : These are the names that are listed after the template keyword in a template declaration. For example,
           <span class="inlinecode">
            T
           </span>
           is the single template parameter specified in our earlier
           <span class="inlinecode">
            Stack
           </span>
           example.
           <a id="p221">
           </a>
          </li>
          <li>
           <span aria-label="221" epub:type="pagebreak" id="pagebreak_221" role="doc-pagebreak">
           </span>
          </li>
          <li class="bulllist" id="p0330">
           <a id="u0085">
           </a>
           ▪
           <b>
            Template Arguments
           </b>
           : These are the entities that are substituted for template parameters during specialization. For example, given a specialization
           <span class="inlinecode">
            Stack&lt;int&gt;
           </span>
           , “int” is a template argument.
          </li>
          <li class="bulllist" id="p0335">
           <a id="u0090">
           </a>
           ▪
           <b>
            Instantiation
           </b>
           : This is when the compiler generates a regular class, method, or function by substituting each of the template's parameters with a concrete type. This can happen implicitly when you create an object based upon a template, or explicitly if you want to control when the code generation happens. For example, these lines of code create two specific stack instances and will normally cause the compiler to generate code for these two different types:
          </li>
         </ol>
        </div>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0110">
           <img alt="image" height="139" src="../../IMAGES/B9780443222191000106/main.assets/u06-21-9780443222191.jpg" width="1143"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <div>
         <ol id="ulist0030">
          <li class="bulllist" id="p0340">
           <a id="u0095">
           </a>
           ▪
           <b>
            Implicit Instantiation
           </b>
           : This is when the compiler decides when to generate code for your template instances. Leaving the decision to the compiler means that it must find an appropriate place to insert the code, and it must also make sure that only one instance of the code exists, to avoid duplicate symbol link errors. This is a nontrivial problem and can cause extra bloat in your object files or longer compile and link times to solve. Most important for API design, implicit instantiation means that you must include the template definitions in your header files so that the compiler has access to the definitions whenever it needs to generate the instantiation code.
          </li>
          <li class="bulllist" id="p0345">
           <a id="u0100">
           </a>
           ▪
           <b>
            Explicit Instantiation
           </b>
           : This is when the programmer determines when the compiler should generate the code for a specific specialization. This can make for much more efficient compilation and link times because the compiler no longer needs to maintain bookkeeping information for all of its implicit instantiations. However, the onus is then placed on the programmer to ensure that a particular specialization is explicitly instantiated once and only once. From an API perspective, explicit instantiation allows us to move the template implementation into the
           <span class="inlinecode">
            .cpp
           </span>
           file, and so hide it from the user.
          </li>
          <li class="bulllist" id="p0350">
           <a id="u0105">
           </a>
           ▪
           <b>
            Lazy Instantiation
           </b>
           : This describes the standard implicit instantiation behavior of a C++ compiler in which it will generate code for only the parts of a template that are actually used. For example, given our two earlier instantiations, if you never called
           <span class="inlinecode">
            IsEmpty()
           </span>
           on the
           <span class="inlinecode">
            myStringStack
           </span>
           object, then the compiler would not generate code for the
           <span class="inlinecode">
            std::string
           </span>
           specialization of that method. This means that you can instantiate a template with a type that can be used by some, but not all methods of a class template. For example, say one method uses the
           <span class="inlinecode">
            &gt;=
           </span>
           operator, but the type you want to instantiate does not define this operator. This is fine if you don't call the particular method that attempts to use the
           <span class="inlinecode">
            &gt;=
           </span>
           operator.
           <a id="p222">
           </a>
          </li>
          <li>
           <span aria-label="222" epub:type="pagebreak" id="pagebreak_222" role="doc-pagebreak">
           </span>
          </li>
          <li class="bulllist" id="p0355">
           <a id="u0110">
           </a>
           ▪
           <b>
            Specialization
           </b>
           : When a template is instantiated, the resulting class, method, or function is called a specialization. More specifically, this is an instantiated (or generated) specialization. However, the term specialization can also be used when you provide a custom implementation for a function by specifying concrete types for all the template parameters. I gave an example of this earlier in the API Styles chapter, where I presented this implementation of the
           <span class="inlinecode">
            Stack::Push()
           </span>
           method, specialized for integer types. This is called an explicit specialization:
          </li>
         </ol>
        </div>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0115">
           <img alt="image" height="313" src="../../IMAGES/B9780443222191000106/main.assets/u06-22-9780443222191.jpg" width="1490"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <div>
         <ol id="ulist0035">
          <li class="bulllist" id="p0360">
           <a id="u0115">
           </a>
           ▪
           <b>
            Partial Specialization
           </b>
           : This is when you provide a specialization of the template for a subset of all possible cases. That is, you specialize one feature of the template but still allow the user to specify other features. For example, if your template accepts multiple parameters, you could partially specialize it by defining a case in which you specify a concrete type for only one of the parameters. In our
           <span class="inlinecode">
            Stack
           </span>
           example with a single template parameter, you could partially specialize this template specifically to handle pointers to any type T. This still lets users create a stack of any type, but it also lets you write specific logic to handle the case in which users create a stack of pointers. This partially specialized class declaration might look like:
          </li>
         </ol>
        </div>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0120">
           <img alt="image" height="661" src="../../IMAGES/B9780443222191000106/main.assets/u06-23-9780443222191.jpg" width="970"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="textfl">
         <a id="p223">
         </a>
        </p>
        <div>
         <span aria-label="223" epub:type="pagebreak" id="pagebreak_223" role="doc-pagebreak">
         </span>
        </div>
       </section>
       <section>
        <a id="s0060">
        </a>
        <h3 class="h2hd" id="cesectitle0070">
         Implicit instantiation API design
        </h3>
        <p class="textfl" id="p0365">
         If you want to allow your clients to instantiate your class templates with their own types, then you need to use implicit template instantiation. For example, if you provide a smart pointer class template,
         <span class="inlinecode">
          smart_pointer&lt;T&gt;
         </span>
         , you don't know ahead of time what types your clients will want to instantiate it with. As a result, the compiler needs to be able to access the definition of the template when it's used. This essentially means that you must expose the template definition in your header files. This is the biggest disadvantage of the implicit instantiation approach in terms of robust API design. However, even if you can't hide the implementation details in this situation, you can at least try to isolate them.
        </p>
        <p class="text" id="p0370">
         Because you need to include the template definition in your header file, it's easy and therefore tempting simply to inline the definitions directly within the class definition. This is a practice that I have already classified as poor design, and that assertion is still true in the case of templates. Instead, I recommend that all template implementation details should be contained within a separate implementation header, which is then included by the main public header. Using the example of our
         <span class="inlinecode">
          Stack
         </span>
         class template, you could provide the main public header:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0125">
           <img alt="image" height="1297" src="../../IMAGES/B9780443222191000106/main.assets/u06-24-9780443222191.jpg" width="2148"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="textfl">
         <a id="p224">
         </a>
        </p>
        <div>
         <span aria-label="224" epub:type="pagebreak" id="pagebreak_224" role="doc-pagebreak">
         </span>
        </div>
        <p class="text" id="p0375">
         Then the implementation header,
         <span class="inlinecode">
          stack_priv.h
         </span>
         , would look like:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0130">
           <img alt="image" height="1644" src="../../IMAGES/B9780443222191000106/main.assets/u06-25-9780443222191.jpg" width="1039"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0380">
         This is a technique used by many high-quality template-based APIs, such as the various Boost headers. It has the benefit of keeping the main public header uncluttered by implementation details while isolating the necessary exposure of internal details to a separate header that's clearly designated as containing private details. (The same technique can be used to isolate consciously inlined function details from their declarations.)
        </p>
        <p class="text" id="p0385">
         The technique of including template definitions in header files is referred to as the inclusion model (
         <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib100">
          Vandevoorde and Josuttis, 2002
         </a>
         ). It's worth noting that there was an alternative to this style called the separation model. This was meant to allow the declaration of a class template in an
         <span class="inlinecode">
          .h
         </span>
         file to be preceded with the
         <span class="inlinecode">
          export
         </span>
         keyword. The implementation of the template methods could then appear in a
         <span class="inlinecode">
          .cpp
         </span>
         file. From an API design perspective, this is a far preferable model because it would allow us to remove all implementation details from public headers. However, this part of the C++ specification was very poorly supported by most compilers. Ultimately the
         <span class="inlinecode">
          export
         </span>
         keyword was deprecated in C++11 and then repurposed for different functionality in C++20.
        </p>
       </section>
       <section>
        <a id="s0065">
        </a>
        <h3 class="h2hd" id="cesectitle0075">
         Explicit instantiation API design
        </h3>
        <p class="textfl" id="p0390">
         If you only want to provide a predetermined set of template specializations for your API and disallow your users from creating further ones, then you do in fact have the option of
         <a id="p225">
         </a>
         <span aria-label="225" epub:type="pagebreak" id="pagebreak_225" role="doc-pagebreak">
         </span>
         completely hiding your private code. For example, if you have created a 3D vector class template,
         <span class="inlinecode">
          Vector3D&lt;T&gt;
         </span>
         , you may want to provide specializations of this template only for
         <span class="inlinecode">
          int
         </span>
         ,
         <span class="inlinecode">
          short
         </span>
         ,
         <span class="inlinecode">
          float
         </span>
         , and
         <span class="inlinecode">
          double
         </span>
         , and you may feel that it's not necessary to let your users create further specializations.
        </p>
        <p class="text" id="p0395">
         In this case, you can put your template definitions into a
         <span class="inlinecode">
          .cpp
         </span>
         file and use explicit template instantiation to instantiate those specializations that you wish to export as part of your API. The
         <span class="inlinecode">
          template
         </span>
         keyword can be used to create an explicit instantiation. For instance, using our previous
         <span class="inlinecode">
          Stack
         </span>
         template example, you could create explicit instantiations for the type
         <span class="inlinecode">
          int
         </span>
         with the statement:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0135">
           <img alt="image" height="81" src="../../IMAGES/B9780443222191000106/main.assets/u06-26-9780443222191.jpg" width="900"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0400">
         This will cause the compiler to generate the code for the
         <span class="inlinecode">
          int
         </span>
         specialization at this point in the code. As a result, it will subsequently no longer attempt to instantiate this specialization implicitly elsewhere in the code. Consequently, using explicit instantiation can also help to reduce build times.
        </p>
        <p class="text" id="p0405">
         Let's look at how you can organize your code to take advantage of this feature. Our
         <span class="inlinecode">
          stack.h
         </span>
         header file looks almost the same as before, just without the
         <span class="inlinecode">
          #include "stack_priv.h"
         </span>
         line:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0140">
           <img alt="image" height="1123" src="../../IMAGES/B9780443222191000106/main.assets/u06-27-9780443222191.jpg" width="900"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="textfl">
         <a id="p226">
         </a>
        </p>
        <div>
         <span aria-label="226" epub:type="pagebreak" id="pagebreak_226" role="doc-pagebreak">
         </span>
        </div>
        <p class="text" id="p0410">
         Now you can contain all of the implementation details for this template in an associated
         <span class="inlinecode">
          .cpp
         </span>
         file:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0145">
           <img alt="image" height="1819" src="../../IMAGES/B9780443222191000106/main.assets/u06-28-9780443222191.jpg" width="1212"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0415">
         The important lines here are the last three, which create explicit instantiations of the
         <span class="inlinecode">
          Stack
         </span>
         class template for the types
         <span class="inlinecode">
          int
         </span>
         ,
         <span class="inlinecode">
          double
         </span>
         , and
         <span class="inlinecode">
          std::string
         </span>
         . The user will not be able to create further specializations (and the compiler will not be able to create implicit instantiations for the user, either), because the implementation details are hidden in our
         <span class="inlinecode">
          .cpp
         </span>
         file. On the other hand, our implementation details are now successfully hidden in our
         <span class="inlinecode">
          .cpp
         </span>
         file.
        </p>
        <p class="text" id="p0420">
         To indicate to your users which template specializations they can use (i.e., which you have explicitly instantiated for them), you could add a few typedefs to the end of your public header, such as:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0150">
           <img alt="image" height="197" src="../../IMAGES/B9780443222191000106/main.assets/u06-29-9780443222191.jpg" width="1352"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0425">
         It's worth noting that by adopting this template style, not only do you (and your clients) get faster builds owing to the removal of the overhead of implicit instantiation,
         <a id="p227">
         </a>
         <span aria-label="227" epub:type="pagebreak" id="pagebreak_227" role="doc-pagebreak">
         </span>
         but by removing the template definitions from your header, you reduce the
         <span class="inlinecode">
          #include
         </span>
         coupling of your API and the amount of extra code that your clients' programs must compile every time they
         <span class="inlinecode">
          #include
         </span>
         your API headers.
        </p>
        <div>
         <aside aria-labelledby="b0045" epub:type="sidebar">
          <div class="box_top_space">
          </div>
          <div class="boxg1" id="b0045">
           <div class="b1textfl" id="bpar0045">
            <i>
             TIP: Prefer explicit template instantiation if you need only a predetermined set of specializations. Doing so lets you hide private details and can reduce build times.
            </i>
           </div>
          </div>
         </aside>
        </div>
        <p class="text" id="p0430">
         It's also worth noting that most compilers provide an option to turn off implicit instantiation completely, which may be a useful optimization if you plan to use only explicit instantiation in your code. This option is called
         <span class="inlinecode">
          -fno-implicit-templates
         </span>
         in the GNU C++ and Intel ICC compilers.
        </p>
        <p class="text" id="p0435">
         As of C++11, support has been added for extern templates. That is, you will be able to use the
         <span class="inlinecode">
          extern
         </span>
         keyword to prevent the compiler from instantiating a template in the current translation unit. With the use of extern templates, you can force the compiler to instantiate a template at a certain point and tell it not to instantiate the template at other points. For example:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0155">
           <img alt="image" height="313" src="../../IMAGES/B9780443222191000106/main.assets/u06-30-9780443222191.jpg" width="1490"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
       </section>
      </section>
      <section>
       <a id="s0070">
       </a>
       <h2 class="h1hd" id="cesectitle0080">
        Operator overloading
       </h2>
       <p class="textfl" id="p0440">
        In addition to overloading functions, C++ allows you to overload many of the operators for your classes, such as
        <span class="inlinecode">
         +
        </span>
        ,
        <span class="inlinecode">
         ∗=
        </span>
        , or
        <span class="inlinecode">
         []
        </span>
        . This can be very useful to make your classes look and behave more like built-in types and to provide a more compact and intuitive syntax for certain methods. For example, instead of having to use syntax such as:
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0160">
          <img alt="image" height="81" src="../../IMAGES/B9780443222191000106/main.assets/u06-31-9780443222191.jpg" width="1318"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="text" id="p0445">
        you could write classes that support the syntax:
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0165">
          <img alt="image" height="81" src="../../IMAGES/B9780443222191000106/main.assets/u06-32-9780443222191.jpg" width="519"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="textfl">
        <a id="p228">
        </a>
       </p>
       <div>
        <span aria-label="228" epub:type="pagebreak" id="pagebreak_228" role="doc-pagebreak">
        </span>
       </div>
       <p class="text" id="p0450">
        Of course, you should only use operator overloading in cases where it makes sense: that is, where doing so would be considered natural to the user of your API and not violate the rule of least surprise. This generally means that you should preserve the natural semantics for operators, such as using the + operator to implement an operation analogous to addition or concatenation. You should also avoid overloading the operators
        <span class="inlinecode">
         &amp;&amp;
        </span>
        ,
        <span class="inlinecode">
         ||
        </span>
        ,
        <span class="inlinecode">
         &amp;
        </span>
        (unary ampersand), and
        <span class="inlinecode">
         ,
        </span>
        (comma) because these exhibit behaviors that may surprise your users, such as short-circuited evaluation and undefined evaluation order (
        <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib67">
         Meyers 1998
        </a>
        ;
        <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib98" id="bib_98">
         Sutter and Alexandrescu, 2004
        </a>
        ).
       </p>
       <p class="text" id="p0455">
        As I covered earlier in this chapter, a C++ compiler will generate a default assignment operator (
        <span class="inlinecode">
         =
        </span>
        ) for your class if you don't define one explicitly. However, if you wish to use any other operators with your objects, then you must explicitly define them; otherwise you'll end up with link errors.
       </p>
       <section>
        <a id="s0075">
        </a>
        <h3 class="h2hd" id="cesectitle0085">
         Overloadable operators
        </h3>
        <p class="textfl" id="p0460">
         Certain operators cannot be overloaded in C++, such as
         <span class="inlinecode">
          .
         </span>
         ,
         <span class="inlinecode">
          .∗
         </span>
         ,
         <span class="inlinecode">
          ?:
         </span>
         , and
         <span class="inlinecode">
          ::
         </span>
         , the preprocessor symbols
         <span class="inlinecode">
          #
         </span>
         and
         <span class="inlinecode">
          ##
         </span>
         , and the
         <span class="inlinecode">
          sizeof
         </span>
         operator. Of the remaining operators that you can overload for your own classes, there are two main categories:
        </p>
        <div>
         <ul class="ce_list" id="olist0020">
          <li class="numlist" id="p0465">
           <a id="o0040">
           </a>
           1.
           <b>
            Unary operators
           </b>
           : These are operators that act on a single operand. The list of unary operators includes:
          </li>
         </ul>
        </div>
        <div>
         <div class="pageavoid">
          <p class="tnum">
          </p>
          <div class="big_device">
           <table class="tbody" id="t0015">
            <thead>
             <tr>
              <th class="tcolhd1" scope="col">
               Name
              </th>
              <th class="tcolhd1" scope="col">
               Example
              </th>
              <th class="tcolhd1" scope="col">
               Name
              </th>
              <th class="tcolhd1" scope="col">
               Example
              </th>
             </tr>
            </thead>
            <tbody>
             <tr>
              <th class="tb" scope="row">
               Unary minus
              </th>
              <td class="tb">
               <span class="inlinecode">
                <span>
                 −
                </span>
                x
               </span>
              </td>
              <td class="tb">
               Unary plus
              </td>
              <td class="tb">
               <span class="inlinecode">
                +x
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Prefix decrement
              </th>
              <td class="tb">
               <span class="inlinecode">
                <span>
                 −
                </span>
                <span>
                 −
                </span>
                x
               </span>
              </td>
              <td class="tb">
               Postfix decrement
              </td>
              <td class="tb">
               <span class="inlinecode">
                x
                <span>
                 −
                </span>
                <span>
                 −
                </span>
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Prefix increment
              </th>
              <td class="tb">
               <span class="inlinecode">
                ++x
               </span>
              </td>
              <td class="tb">
               Postfix increment
              </td>
              <td class="tb">
               <span class="inlinecode">
                x++
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Dereference
              </th>
              <td class="tb">
               <span class="inlinecode">
                ∗x
               </span>
              </td>
              <td class="tb">
               Reference
              </td>
              <td class="tb">
               <span class="inlinecode">
                &amp;x
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Logical NOT
              </th>
              <td class="tb">
               <span class="inlinecode">
                !x
               </span>
              </td>
              <td class="tb">
               Bitwise NOT
              </td>
              <td class="tb">
               <span class="inlinecode">
                ∼x
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Function call
              </th>
              <td class="tb">
               <span class="inlinecode">
                x()
               </span>
              </td>
              <td class="tb">
              </td>
              <td class="tb">
              </td>
             </tr>
            </tbody>
           </table>
          </div>
         </div>
        </div>
        <div>
         <ul class="ce_list" id="olist0025">
          <li class="numlist" id="p0470">
           <a id="o0045">
           </a>
           2.
           <b>
            Binary operators
           </b>
           : There are operators that act on two operands. The list of binary operators includes:
          </li>
         </ul>
        </div>
        <p class="textfl">
         <a id="p229">
         </a>
         <span aria-label="229" epub:type="pagebreak" id="pagebreak_229" role="doc-pagebreak">
         </span>
        </p>
        <div>
         <div class="pageavoid">
          <p class="tnum">
          </p>
          <div class="big_device">
           <table class="tbody" id="t0020">
            <thead>
             <tr>
              <th class="tcolhd1" scope="col">
               Name
              </th>
              <th class="tcolhd1" scope="col">
               Example
              </th>
              <th class="tcolhd1" scope="col">
               Name
              </th>
              <th class="tcolhd1" scope="col">
               Example
              </th>
             </tr>
            </thead>
            <tbody>
             <tr>
              <th class="tb" scope="row">
               Addition
              </th>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                +
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
              <td class="tb">
               Subtraction
              </td>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                <span>
                 −
                </span>
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Assignment by addition
              </th>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                +
                <span title='hsp="0.25"'>
                </span>
                =
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
              <td class="tb">
               Assignment by subtraction
              </td>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                <span>
                 −
                </span>
                <span title='hsp="0.25"'>
                </span>
                =
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Multiplication
              </th>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                ∗
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
              <td class="tb">
               Division
              </td>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                /
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Assignment by multiplication
              </th>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                ∗
                <span title='hsp="0.25"'>
                </span>
                =
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
              <td class="tb">
               Assignment by division
              </td>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                /
                <span title='hsp="0.25"'>
                </span>
                =
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Equality
              </th>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                =
                <span title='hsp="0.25"'>
                </span>
                =
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
              <td class="tb">
               Inequality
              </td>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                !
                <span title='hsp="0.25"'>
                </span>
                =
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Assignment
              </th>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                =
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
              <td class="tb">
               Comma
              </td>
              <td class="tb">
               <span class="inlinecode">
                x, y
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Less than
              </th>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                &lt;
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
              <td class="tb">
               Greater than
              </td>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                &gt;
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Less than or equal to
              </th>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                &lt;=
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
              <td class="tb">
               Greater than or equal to
              </td>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                &gt;=
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Modulo
              </th>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                %
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
              <td class="tb">
               Bitwise XOR
              </td>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                <sup>
                 ˆ
                </sup>
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Assignment by modulo
              </th>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                %
                <span title='hsp="0.25"'>
                </span>
                =
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
              <td class="tb">
               Assignment by bitwise XOR
              </td>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                <sup>
                 ˆ
                </sup>
                <span title='hsp="0.25"'>
                </span>
                =
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Bitwise AND
              </th>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                &amp;
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
              <td class="tb">
               Bitwise OR
              </td>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                |
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Assignment by bitwise AND
              </th>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                &amp;
                <span title='hsp="0.25"'>
                </span>
                =
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
              <td class="tb">
               Assignment by bitwise OR
              </td>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                |
                <span title='hsp="0.25"'>
                </span>
                =
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Logical AND
              </th>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                &amp;&amp;
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
              <td class="tb">
               Logical OR
              </td>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                ||
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Bitwise left shift
              </th>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                &lt;&lt;
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
              <td class="tb">
               Bitwise right shift
              </td>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                &gt;&gt;
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Assignment by bitwise left shift
              </th>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                &lt;&lt;=
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
              <td class="tb">
               Assignment by bitwise right shift
              </td>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                &gt;&gt;=
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Class member access
              </th>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                -&gt;
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
              <td class="tb">
               Pointer-to-member selection
              </td>
              <td class="tb">
               <span class="inlinecode">
                x
                <span title='hsp="0.25"'>
                </span>
                -&gt;∗
                <span title='hsp="0.25"'>
                </span>
                y
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Array subscript
              </th>
              <td class="tb">
               <span class="inlinecode">
                x[y]
               </span>
              </td>
              <td class="tb">
               C-style cast
              </td>
              <td class="tb">
               <span class="inlinecode">
                (y) x
               </span>
              </td>
             </tr>
            </tbody>
           </table>
          </div>
         </div>
        </div>
       </section>
       <section>
        <a id="s0080">
        </a>
        <h3 class="h2hd" id="cesectitle0090">
         Free operators versus member operators
        </h3>
        <p class="textfl" id="p0475">
         Operators can either be defined as members of your class or as free functions. Some operators must be defined as class members, but others can be defined either way. For example, this code illustrates the
         <span class="inlinecode">
          +=
         </span>
         operator defined as a class member:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0170">
           <img alt="image" height="776" src="../../IMAGES/B9780443222191000106/main.assets/u06-33-9780443222191.jpg" width="1595"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0480">
         The following code shows an equivalent API using a free function version of the operator:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0175">
           <img alt="image" height="778" src="../../IMAGES/B9780443222191000106/main.assets/u06-34-9780443222191.jpg" width="1872"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="textfl">
         <a id="p230">
         </a>
        </p>
        <div>
         <span aria-label="230" epub:type="pagebreak" id="pagebreak_230" role="doc-pagebreak">
         </span>
        </div>
        <p class="text" id="p0485">
         In this section I'll cover some best practices for whether you should make your operators free functions or methods.
        </p>
        <p class="text" id="p0490">
         To begin with, the C++ standard requires the following operators to be declared as member methods to ensure that they receive an lvalue (an expression that refers to an object) as their first operand:
        </p>
        <div>
         <ol id="ulist0040">
          <li class="bulllist" id="p0495">
           <a id="u0120">
           </a>
           •
           <span class="inlinecode">
            =
           </span>
           Assignment
          </li>
          <li class="bulllist" id="p0500">
           <a id="u0125">
           </a>
           •
           <span class="inlinecode">
            []
           </span>
           Subscript
          </li>
          <li class="bulllist" id="p0505">
           <a id="u0130">
           </a>
           •
           <span class="inlinecode">
            -&gt;
           </span>
           <span title='hsp="0.25"'>
           </span>
           Class member access
          </li>
          <li class="bulllist" id="p0510">
           <a id="u0135">
           </a>
           •
           <span class="inlinecode">
            -&gt;∗
           </span>
           Pointer-to-member selection
          </li>
          <li class="bulllist" id="p0515">
           <a id="u0140">
           </a>
           •
           <span class="inlinecode">
            ()
           </span>
           Function call
          </li>
          <li class="bulllist" id="p0520">
           <a id="u0145">
           </a>
           •
           <span class="inlinecode">
            (T)
           </span>
           Conversion, i.e., C-style cast
          </li>
          <li class="bulllist" id="p0525">
           <a id="u0150">
           </a>
           •
           <span class="inlinecode">
            new
           </span>
           /
           <span class="inlinecode">
            delete
           </span>
          </li>
         </ol>
        </div>
        <p class="text" id="p0530">
         The remaining overloadable operators can be defined as either free functions or class methods. From the perspective of good API design, I recommend that you favor the free function version over the class method version of defining an operator. There are two specific reasons for this:
        </p>
        <div>
         <ul class="ce_list" id="olist0030">
          <li class="numlist" id="p0535">
           <a id="o0050">
           </a>
           1.
           <b>
            Operator symmetry.
           </b>
           If a binary operator is defined as a class method, it must have an object to be applied to as the left-hand operand. Taking the ∗ operator as an example, this means that your users would be able to write expressions such as "
           <span class="inlinecode">
            complexNumber ∗ 2.0
           </span>
           " (assuming that you have defined a constructor for
           <span class="inlinecode">
            Complex
           </span>
           that accepts a single double argument), but not "
           <span class="inlinecode">
            2.0 ∗ complexNumber
           </span>
           " (because
           <span class="inlinecode">
            2.0.operator +(complexNumber)
           </span>
           does not make sense). This breaks the commutative property of the operator that your users will expect (i.e., that
           <span class="inlinecode">
            x ∗ y
           </span>
           should be the same as
           <span class="inlinecode">
            y ∗ x)
           </span>
           . However, declaring the
           <span class="inlinecode">
            ∗
           </span>
           operator as a free function lets you benefit from implicit type conversions for both the left- and right-hand operands.
          </li>
          <li class="numlist" id="p0540">
           <a id="o0055">
           </a>
           2.
           <b>
            Reduced coupling.
           </b>
           A free function cannot access the private details of a class. It's therefore less coupled to the class because it can only access the public methods. This is a general API design statement that I covered in
           <a href="../B9780443222191000143/CH0002_25-80_B9780443222191000143.xhtml">
            Chapter 2
           </a>
           : turn a class method that does not need to access private or protected members into a free function to reduce the degree of coupling in your API (
           <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib68" id="bib_68">
            Meyers, 2000
           </a>
           ;
           <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib99" id="bib_99">
            Tulach, 2008
           </a>
           ).
          </li>
         </ul>
        </div>
        <p class="text" id="p0545">
         Having stated this general preference toward free function operators, I will now present the exception to this rule: If your operator must access private or protected members of your class, then you should define the operator as a method of the class. I make this exception because otherwise you would have to declare the free operator to be a friend of your class. As I will discuss later in this chapter, adding friends to your classes
         <a id="p231">
         </a>
         <span aria-label="231" epub:type="pagebreak" id="pagebreak_231" role="doc-pagebreak">
         </span>
         is a greater evil. One specific reason I'll mention here is that your clients cannot change the friendship list of your classes, so they could not add new operators in this same way.
        </p>
        <div>
         <aside aria-labelledby="b0050" epub:type="sidebar">
          <div class="box_top_space">
          </div>
          <div class="boxg1" id="b0050">
           <div class="b1textfl" id="bpar0050">
            <i>
             TIP: Prefer declaring operators as free functions, unless the operator must access protected or private members, or the operator is one of:
            </i>
            <span class="inlinecode">
             <i>
              =
             </i>
            </span>
            <i>
             ,
            </i>
            <span class="inlinecode">
             <i>
              []
             </i>
            </span>
            <i>
             ,
            </i>
            <span class="inlinecode">
             <i>
              -&gt;
             </i>
            </span>
            <i>
             ,
            </i>
            <span class="inlinecode">
             <i>
              -&gt;∗
             </i>
            </span>
            <i>
             ,
            </i>
            <span class="inlinecode">
             <i>
              ()
             </i>
            </span>
            <i>
             ,
            </i>
            <span class="inlinecode">
             <i>
              (T)
             </i>
            </span>
            <i>
             ,
            </i>
            <span class="inlinecode">
             <i>
              new
             </i>
            </span>
            <i>
             , or
            </i>
            <span class="inlinecode">
             <i>
              delete
             </i>
            </span>
            <i>
             .
            </i>
           </div>
          </div>
         </aside>
        </div>
       </section>
       <section>
        <a id="s0085">
        </a>
        <h3 class="h2hd" id="cesectitle0095">
         Adding operators to a class
        </h3>
        <p class="textfl" id="p0550">
         Let's develop the
         <span class="inlinecode">
          Complex
         </span>
         class a little further to make these points more concrete. The
         <span class="inlinecode">
          +=
         </span>
         operator modifies the contents of an object, and we know that all member variables should be private; therefore you will most likely need to make the
         <span class="inlinecode">
          +=
         </span>
         operator be a member method. However, the
         <span class="inlinecode">
          +
         </span>
         operator does not modify the left-hand operand. As such, it shouldn't need access to private members and can be made a free function. You also need to make it a free function to ensure that it benefits from symmetrical behavior, as described earlier. In fact, the
         <span class="inlinecode">
          +
         </span>
         operator can be implemented in terms of the
         <span class="inlinecode">
          +=
         </span>
         operator, which allows us to reuse code and provide more consistent behavior. It also reduces the number of methods that might need to be overloaded in derived classes:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0180">
           <img alt="image" height="255" src="../../IMAGES/B9780443222191000106/main.assets/u06-35-9780443222191.jpg" width="1976"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0555">
         Obviously, the same technique applies to the other arithmetic operators, such as
         <span class="inlinecode">
          -
         </span>
         ,
         <span class="inlinecode">
          -=
         </span>
         ,
         <span class="inlinecode">
          ∗
         </span>
         ,
         <span class="inlinecode">
          ∗=
         </span>
         ,
         <span class="inlinecode">
          /
         </span>
         , and
         <span class="inlinecode">
          /=
         </span>
         . For example,
         <span class="inlinecode">
          ∗=
         </span>
         can be implemented as a member function, whereas
         <span class="inlinecode">
          ∗
         </span>
         can be implemented as a free function that uses the
         <span class="inlinecode">
          ∗=
         </span>
         operator.
        </p>
        <div id="p0560">
         As for the relational operators
         <span title='hsp="0.25"'>
         </span>
         =
         <span title='hsp="0.25"'>
         </span>
         <span class="inlinecode">
          =
         </span>
         ,
         <span class="inlinecode">
          !=
         </span>
         ,
         <span class="inlinecode">
          &lt;
         </span>
         ,
         <span class="inlinecode">
          &lt;=
         </span>
         ,
         <span class="inlinecode">
          &gt;
         </span>
         , and
         <span class="inlinecode">
          &gt;=
         </span>
         , these must also be implemented as free functions to ensure symmetrical behavior. In the case of our
         <span class="inlinecode">
          Complex
         </span>
         class, you can implement these using the public
         <span class="inlinecode">
          GetReal()
         </span>
         and
         <span class="inlinecode">
          GetImaginary()
         </span>
         methods. However, if these operators should need access to the private state of the object, there is a way to resolve this apparent dilemma. In this case, you can provide public methods that test for the equality and less than conditions. All of the relational operators could then be implemented in terms of these two primitive functions (
         <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib6" id="bib_6">
          Astrachan, 2000
         </a>
         ):
         <a id="p232">
         </a>
         <span aria-label="232" epub:type="pagebreak" id="pagebreak_232" role="doc-pagebreak">
         </span>
        </div>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0185">
           <img alt="image" height="1702" src="../../IMAGES/B9780443222191000106/main.assets/u06-36-9780443222191.jpg" width="1906"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0565">
         The last operator I will consider here is
         <span class="inlinecode">
          &lt;&lt;
         </span>
         , which I will use for stream output (as opposed to bit shifting). The stream operators must be declared as free functions because the first parameter is a stream object. Again, you can use the public
         <span class="inlinecode">
          GetReal()
         </span>
         and
         <span class="inlinecode">
          GetImaginary()
         </span>
         methods to make this possible. However, if the stream operator did need to access private members of your class, then you could create a public
         <span class="inlinecode">
          ToString()
         </span>
         method for the
         <span class="inlinecode">
          &lt;&lt;
         </span>
         operator to call, as a way to avoid using friends.
        </p>
        <p class="text" id="p0570">
         Putting all these recommendations together, here's what the operators of our
         <span class="inlinecode">
          Complex
         </span>
         class might look like:
         <a id="p233">
         </a>
         <span aria-label="233" epub:type="pagebreak" id="pagebreak_233" role="doc-pagebreak">
         </span>
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0190">
           <img alt="image" height="2041" src="../../IMAGES/B9780443222191000106/main.assets/u06-37-9780443222191.jpg" width="1954"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
       </section>
       <section>
        <a id="s0090">
        </a>
        <h3 class="h2hd" id="cesectitle0100">
         Operator syntax
        </h3>
        <p class="textfl" id="p0575">
         <a href="#t0010" id="Bt0010">
          Table 6.1
         </a>
         provides a list of operators that you can overload in your classes and the recommended syntax for declaring each operator so that they have the same semantics as their built-in counterparts. This table omits operators that you can't overload, as well as those that I've previously stated you should not overload, such as
         <span class="inlinecode">
          &amp;&amp;
         </span>
         and
         <span class="inlinecode">
          ||
         </span>
         . Where an operator can be defined as either a free function or a class method, I present both forms, but I list the free function form first because you should generally prefer this form unless the operator needs access to protected or private members.
         <a id="p235">
         </a>
        </p>
        <div>
         <span aria-label="234" epub:type="pagebreak" id="pagebreak_234" role="doc-pagebreak">
         </span>
        </div>
        <section>
         <a id="st0010">
         </a>
         <div class="pageavoid">
          <p class="tnum">
           <a href="#Bt0010">
            Table 6.1
           </a>
          </p>
          <div class="big_device">
           <table class="tbody" id="t0010">
            <caption class="ttitle">
             <a id="tspara0010">
             </a>
             List of operators and the syntax for declaring these in your application programming interfaces.
            </caption>
            <thead>
             <tr>
              <th class="tcolhd1" scope="col">
               Operator name
              </th>
              <th class="tcolhd1" scope="col">
               Syntax
              </th>
              <th class="tcolhd1" scope="col">
               Sample operator declarations
              </th>
             </tr>
            </thead>
            <tbody>
             <tr>
              <th class="tb" scope="row">
               Assignment
              </th>
              <td class="tb">
               <span class="inlinecode">
                x = y
               </span>
              </td>
              <td class="tb">
               <span class="inlinecode">
                T1&amp; T1::operator =(const T2&amp; y);
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Dereference
              </th>
              <td class="tb">
               <span class="inlinecode">
                ∗x
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; operator ∗(T1&amp; x);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; T1::operator ∗() const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Reference
              </th>
              <td class="tb">
               <span class="inlinecode">
                &amp;x
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1∗ operator &amp;(T1&amp; x);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1∗ T1::operator &amp;();
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Class member access
              </th>
              <td class="tb">
               <span class="inlinecode">
                x-&gt;y
               </span>
              </td>
              <td class="tb">
               <span class="inlinecode">
                T2∗ T1::operator -&gt;();
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Pointer-to-member selection
              </th>
              <td class="tb">
               <span class="inlinecode">
                x-&gt;∗y
               </span>
              </td>
              <td class="tb">
               <span class="inlinecode">
                T2 T1::operator-&gt;∗(T2 T1::∗);
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Array subscript
              </th>
              <td class="tb">
               <span class="inlinecode">
                x[n]
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T2&amp; T1::operator [](unsigned int n);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T2&amp; T1::operator [](const std::string &amp;s);
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Function call
              </th>
              <td class="tb">
               <span class="inlinecode">
                x()
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 void T1::operator ()(T2&amp; x);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T2 T1::operator ()() const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               C-style cast
              </th>
              <td class="tb">
               <span class="inlinecode">
                (y) x
               </span>
              </td>
              <td class="tb">
               <span class="inlinecode">
                T1::operator T2() const;
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Unary plus
              </th>
              <td class="tb">
               <span class="inlinecode">
                +x
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1 operator +(const T1&amp; x);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1 T1::operator +() const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Addition
              </th>
              <td class="tb">
               <span class="inlinecode">
                x + y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1 operator +(const T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1 T1::operator +(const T2&amp; y) const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Assignment by addition
              </th>
              <td class="tb">
               <span class="inlinecode">
                x += y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; operator +=(T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; T1::operator +=(const T2&amp; y);
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Prefix increment
              </th>
              <td class="tb">
               <span class="inlinecode">
                ++x
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; operator ++(T1&amp; x);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; T1::operator ++();
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Postfix increment
              </th>
              <td class="tb">
               <span class="inlinecode">
                x++
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1 operator ++(T1&amp; x, int);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1 T1::operator ++(int);
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Unary minus
              </th>
              <td class="tb">
               <span class="inlinecode">
                -x
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1 operator -(const T1&amp; x);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1 T1::operator -() const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Subtraction
              </th>
              <td class="tb">
               <span class="inlinecode">
                x - y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1 operator -(const T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1 T1::operator -(const T2&amp; y) const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Assignment by subtraction
              </th>
              <td class="tb">
               <span class="inlinecode">
                x -= y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; operator -=(T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; T1::operator -=(const T2&amp; y);
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Prefix decrement
              </th>
              <td class="tb">
               <span class="inlinecode">
                --
                <span title='hsp="0.25"'>
                </span>
                --x
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; operator --
                 <span title='hsp="0.25"'>
                 </span>
                 --(T1&amp; x);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; T1::operator --
                 <span title='hsp="0.25"'>
                 </span>
                 --();
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Postfix decrement
              </th>
              <td class="tb">
               <span class="inlinecode">
                x--
                <span title='hsp="0.25"'>
                </span>
                --
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1 operator --
                 <span title='hsp="0.25"'>
                 </span>
                 --(T1&amp; x, int);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1 T1::operator --(int);
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Multiplication
              </th>
              <td class="tb">
               <span class="inlinecode">
                x ∗ y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1 operator ∗(const T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1 T1::operator ∗(const T2&amp; y) const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Assignment by multiplication
              </th>
              <td class="tb">
               <span class="inlinecode">
                x ∗= y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; operator ∗=(T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; T1::operator ∗=(const T2&amp; y);
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Division
              </th>
              <td class="tb">
               <span class="inlinecode">
                x / y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1 operator /(const T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1 T1::operator /(const T2&amp; y) const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Assignment of division
              </th>
              <td class="tb">
               <span class="inlinecode">
                x /= y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; operator /=(T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; T1::operator /=(const T2&amp; y);
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Modulo
              </th>
              <td class="tb">
               <span class="inlinecode">
                x % y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1 operator %(const T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1 T1::operator %(const T2&amp; y) const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <td class="tb_ralign" colspan="3">
               Table Continued
              </td>
             </tr>
            </tbody>
           </table>
          </div>
          <div>
           <span aria-label="235" epub:type="pagebreak" id="pagebreak_235" role="doc-pagebreak">
           </span>
          </div>
          <div class="big_device">
           <table class="tbody">
            <thead>
             <tr>
              <th class="tcolhd1" scope="col">
               Operator name
              </th>
              <th class="tcolhd1" scope="col">
               Syntax
              </th>
              <th class="tcolhd1" scope="col">
               Sample operator declarations
              </th>
             </tr>
            </thead>
            <tbody>
             <tr>
              <th class="tb" scope="row">
               Assignment of modulo
              </th>
              <td class="tb">
               <span class="inlinecode">
                x %= y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; operator %=(T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; T1::operator %=(const T2&amp; y);
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Equality
              </th>
              <td class="tb">
               <span class="inlinecode">
                x == y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 bool operator ==(const T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 bool T1::operator ==(const T2&amp; y) const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Inequality
              </th>
              <td class="tb">
               <span class="inlinecode">
                x != y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 bool operator !=(const T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 bool T1::operator !=(const T2&amp; y) const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Less than
              </th>
              <td class="tb">
               <span class="inlinecode">
                x &lt; y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 bool operator &lt;(const T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 bool T1::operator &lt;(const T2&amp; y) const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Less than or equal to
              </th>
              <td class="tb">
               <span class="inlinecode">
                x &lt;= y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 bool operator &lt;=(const T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 bool T1::operator &lt;=(const T2&amp; y) const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Greater than
              </th>
              <td class="tb">
               <span class="inlinecode">
                x &gt; y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 bool operator &gt;(const T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 bool T1::operator &gt;(const T2&amp; y) const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Greater than or equal to
              </th>
              <td class="tb">
               <span class="inlinecode">
                x &gt;= y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 bool operator &gt;=(const T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 bool T1::operator &gt;=(const T2&amp; y) const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Logical NOT
              </th>
              <td class="tb">
               <span class="inlinecode">
                !x
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 bool operator !(const T1&amp; x);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 bool T1::operator !() const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Bitwise left shift (BLS)
              </th>
              <td class="tb">
               <span class="inlinecode">
                x &lt;&lt; y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1 operator &lt;&lt;(const T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 ostream&amp; operator &lt;&lt;(ostream &amp;, const T1 &amp;x);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1 T1::operator &lt;&lt;(const T2&amp; y) const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Assignment by BLS
              </th>
              <td class="tb">
               <span class="inlinecode">
                x &lt;&lt;= y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; operator &lt;&lt;=(T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; T1::operator &lt;&lt;=(const T2&amp; y);
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Bitwise right shift (BRS)
              </th>
              <td class="tb">
               <span class="inlinecode">
                x &gt;&gt; y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1 operator &gt;&gt;(const T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 istream&amp; operator &gt;&gt;(istream &amp;, T1 &amp;x);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1 T1::operator &gt;&gt;(const T2&amp; y) const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Assignment by BRS
              </th>
              <td class="tb">
               <span class="inlinecode">
                x &gt;&gt;= y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; operator &gt;&gt;=(T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; T1::operator &gt;&gt;=(const T2&amp; y);
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Bitwise NOT
              </th>
              <td class="tb">
               <span class="inlinecode">
                ∼x
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1 operator ∼(const T1&amp; x);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1 T1::operator ∼() const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Bitwise AND
              </th>
              <td class="tb">
               <span class="inlinecode">
                x &amp; y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1 operator &amp;(const T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1 T1::operator &amp;(const T2&amp; y) const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Assignment by bitwise AND
              </th>
              <td class="tb">
               <span class="inlinecode">
                x &amp;= y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; operator &amp;=(T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; T1::operator &amp;=(const T2&amp; y);
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Bitwise OR
              </th>
              <td class="tb">
               <span class="inlinecode">
                x | y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1 operator |(const T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1 T1::operator |(const T2&amp; y) const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Assignment by bitwise OR
              </th>
              <td class="tb">
               <span class="inlinecode">
                x |= y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; operator |=(T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; T1::operator |=(const T2&amp; y);
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Bitwise XOR
              </th>
              <td class="tb">
               <span class="inlinecode">
                x
                <sup>
                 ˆ
                </sup>
                y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1 operator
                 <sup>
                  ˆ
                 </sup>
                 (const T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1 T1::operator
                 <sup>
                  ˆ
                 </sup>
                 (const T2&amp; y) const;
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Assignment by bitwise XOR
              </th>
              <td class="tb">
               <span class="inlinecode">
                x
                <sup>
                 ˆ
                </sup>
                = y
               </span>
              </td>
              <td class="tb">
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; operator
                 <sup>
                  ˆ
                 </sup>
                 =(T1&amp; x, const T2&amp; y);
                </span>
               </div>
               <div class="tb1">
                <span class="inlinecode">
                 T1&amp; T1::operator
                 <sup>
                  ˆ
                 </sup>
                 =(const T2&amp; y);
                </span>
               </div>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Allocate object
              </th>
              <td class="tb">
               <span class="inlinecode">
                new
               </span>
              </td>
              <td class="tb">
               <span class="inlinecode">
                void∗ T1::operator new(size_t n);
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Allocate array
              </th>
              <td class="tb">
               <span class="inlinecode">
                new []
               </span>
              </td>
              <td class="tb">
               <span class="inlinecode">
                void∗ T1::operator new[](size_t n);
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Deallocate object
              </th>
              <td class="tb">
               <span class="inlinecode">
                delete
               </span>
              </td>
              <td class="tb">
               <span class="inlinecode">
                void T1::operator delete(void∗ x);
               </span>
              </td>
             </tr>
             <tr>
              <th class="tb" scope="row">
               Deallocate array
              </th>
              <td class="tb">
               <span class="inlinecode">
                delete []
               </span>
              </td>
              <td class="tb">
               <span class="inlinecode">
                void T1::operator delete[](void∗ x);
               </span>
              </td>
             </tr>
            </tbody>
           </table>
          </div>
          <div>
           <span aria-label="236" epub:type="pagebreak" id="pagebreak_236" role="doc-pagebreak">
           </span>
          </div>
         </div>
        </section>
       </section>
       <section>
        <a id="s0095">
        </a>
        <h3 class="h2hd" id="cesectitle0105">
         Conversion operators
        </h3>
        <p class="textfl" id="p0580">
         A conversion operator provides a way for you to define how an object can be automatically converted to a different type. A classic example is to define a custom string class that can be passed to functions that accept a
         <span class="inlinecode">
          const char ∗
         </span>
         pointer, such as the standard C library functions
         <span class="inlinecode">
          strcmp()
         </span>
         or
         <span class="inlinecode">
          strlen()
         </span>
         :
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0195">
           <img alt="image" height="1008" src="../../IMAGES/B9780443222191000106/main.assets/u06-38-9780443222191.jpg" width="2186"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0585">
         Note that the conversion operator does not specify a return value type. That's because the type is inferred by the compiler based upon the operator's name. Also, note that conversion operators take no arguments. As of C++11, it's also possible to prefix a conversion operator with the
         <span class="inlinecode">
          explicit
         </span>
         keyword to prevent its use in implicit conversations.
        </p>
        <div>
         <aside aria-labelledby="b0055" epub:type="sidebar">
          <div class="box_top_space">
          </div>
          <div class="boxg1" id="b0055">
           <div class="b1textfl" id="bpar0055">
            <i>
             TIP: Add conversion operators to your classes to let them take advantage of automatic type coercion.
            </i>
           </div>
          </div>
         </aside>
        </div>
       </section>
      </section>
      <section>
       <a id="s0100">
       </a>
       <h2 class="h1hd" id="cesectitle0110">
        Function parameters
       </h2>
       <p class="textfl" id="p0590">
        In the following sections, I'll address a couple of C++ best practices relating to the use of function parameters. This includes when you should prefer to use pointers instead of references to pass objects into a function, and when you should use default arguments.
       </p>
       <section>
        <a id="s0105">
        </a>
        <h3 class="h2hd" id="cesectitle0115">
         Pointer versus reference parameters
        </h3>
        <p class="textfl" id="p0595">
         When specifying the parameters for your functions, you can chose to pass them as value parameters, pointers, or references. For example:
         <a id="p237">
         </a>
         <span aria-label="237" epub:type="pagebreak" id="pagebreak_237" role="doc-pagebreak">
         </span>
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0200">
           <img alt="image" height="197" src="../../IMAGES/B9780443222191000106/main.assets/u06-39-9780443222191.jpg" width="2079"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0600">
         You pass a parameter as a reference or pointer when you want to receive a handle for the actual object rather than a copy of the object. This is done either for performance reasons (as I'll discuss in
         <a href="../B9780443222191000064/CH0007_251-327_B9780443222191000064.xhtml">
          Chapter 7
         </a>
         ) or so that you can modify the client's object. C++ compilers normally implement references using pointers, so under the hood they are often the same thing. However, there are several practical differences, such as:
        </p>
        <div>
         <ol id="ulist0045">
          <li class="bulllist" id="p0605">
           <a id="u0155">
           </a>
           ▪ References are used as if they were a value, such as
           <span class="inlinecode">
            object.Function()
           </span>
           instead of
           <span class="inlinecode">
            object-&gt;Function()
           </span>
           .
          </li>
          <li class="bulllist" id="p0610">
           <a id="u0160">
           </a>
           ▪ A reference must be initialized to point to an object and does not support changing the referent object after initialization.
          </li>
          <li class="bulllist" id="p0615">
           <a id="u0165">
           </a>
           ▪ You cannot take the address of a reference as you can with pointers. Using the &amp; operator on a reference returns the address of the referent object.
          </li>
          <li class="bulllist" id="p0620">
           <a id="u0170">
           </a>
           ▪ You can't create arrays of references.
          </li>
         </ol>
        </div>
        <p class="text" id="p0625">
         The question of whether to use a pointer or a reference for a parameter is really a matter of personal taste. However, I will suggest that in general you should prefer the use of references over pointers for any input parameters. This is because the calling syntax for your clients is simpler, and you do not need to worry about checking for
         <span class="inlinecode">
          nullptr
         </span>
         values (because references cannot be null). However, if you need to support passing
         <span class="inlinecode">
          nullptr
         </span>
         , or you're writing a plain C API, then you must obviously use a pointer.
        </p>
        <p class="text" id="p0630">
         In terms of output parameters (parameters that your function may modify), some engineers dislike that references don't indicate to your clients that a parameter may be changed. For example, the reference and pointer versions of the previous
         <span class="inlinecode">
          GetColor()
         </span>
         function can be called by clients as:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0205">
           <img alt="image" height="139" src="../../IMAGES/B9780443222191000106/main.assets/u06-40-9780443222191.jpg" width="2044"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0635">
         In both of these cases, the
         <span class="inlinecode">
          GetColor()
         </span>
         function can modify the value of the
         <span class="inlinecode">
          red
         </span>
         ,
         <span class="inlinecode">
          green
         </span>
         , and
         <span class="inlinecode">
          blue
         </span>
         variables. However, the pointer version makes this fact explicit because of the required use of the &amp; operator. For this reason, APIs such as the Qt framework prefer to represent output parameters using pointers instead of references. If you decide to follow this convention, too (which I recommend), then by implication all of your reference parameters should be const references.
         <a id="p238">
         </a>
         <span aria-label="238" epub:type="pagebreak" id="pagebreak_238" role="doc-pagebreak">
         </span>
        </p>
        <div>
         <aside aria-labelledby="b0060" epub:type="sidebar">
          <div class="box_top_space">
          </div>
          <div class="boxg1" id="b0060">
           <div class="b1textfl" id="bpar0060">
            <i>
             TIP: Prefer the use of const references over pointers for input parameters where feasible. For output parameters, consider using pointers over nonconst references to indicate explicitly to the client that they may be modified.
            </i>
           </div>
          </div>
         </aside>
        </div>
       </section>
       <section>
        <a id="s0110">
        </a>
        <h3 class="h2hd" id="cesectitle0120">
         Default arguments
        </h3>
        <p class="textfl" id="p0640">
         Default arguments are a very useful tool to reduce the number of methods in your API and provide implicit documentation on their use. They can also be used to extend an API call in a backward-compatible fashion, so that older client code will still compile, but newer code can optionally provide additional arguments (although it should be noted that this will break binary compatibility, because the mangled symbol name for the method will necessarily change if a new argument is added). As an example, consider this code fragment for a Sphere class:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0210">
           <img alt="image" height="371" src="../../IMAGES/B9780443222191000106/main.assets/u06-41-9780443222191.jpg" width="2117"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0645">
         In this case, the user can construct a new
         <span class="inlinecode">
          Sphere
         </span>
         object in several different ways, supplying as much detail as needed. For example:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0215">
           <img alt="image" height="255" src="../../IMAGES/B9780443222191000106/main.assets/u06-42-9780443222191.jpg" width="865"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0650">
         However, there are two issues to consider with this example. First, it supports combinations of arguments that don't make logical sense, such as supplying an
         <span class="inlinecode">
          x
         </span>
         argument but no
         <span class="inlinecode">
          y
         </span>
         argument. Also, the default values will be compiled into your client's programs. This means that your clients must recompile their code if you release a new version of the API with a different default radius. In essence, you are exposing the behavior of the API when you do not explicitly specify a radius value.
        </p>
        <p class="text" id="p0655">
         To illustrate why this might be bad, consider the possibility that you later add support for the notion of different default units, letting the user switch between values specified in meters, centimeters, or millimeters. In this case, a constant default radius of 10.0 would be inappropriate for all units.
         <a id="p239">
         </a>
        </p>
        <div>
         <span aria-label="239" epub:type="pagebreak" id="pagebreak_239" role="doc-pagebreak">
         </span>
        </div>
        <p class="text" id="p0660">
         An alternative approach is to provide multiple overloaded methods instead of using default arguments. For example:
        </p>
        <div>
         <div class="pageavoid">
          <figure class="fig" id="f0220">
           <img alt="image" height="487" src="../../IMAGES/B9780443222191000106/main.assets/u06-43-9780443222191.jpg" width="1594"/>
           <figcaption class="figleg">
           </figcaption>
          </figure>
         </div>
        </div>
        <p class="text" id="p0665">
         Using this approach, the implementation of the first two constructors can use a default value for the attributes that are not specified. But importantly, these default values are specified in the
         <span class="inlinecode">
          .cpp
         </span>
         file and are not exposed in the
         <span class="inlinecode">
          .h
         </span>
         file. As a result, a later version of the API could change these values without any impact on the public interface.
        </p>
        <div>
         <aside aria-labelledby="b0065" epub:type="sidebar">
          <div class="box_top_space">
          </div>
          <div class="boxg1" id="b0065">
           <div class="b1textfl" id="bpar0065">
            <i>
             TIP: Prefer overloaded functions to default arguments when the default value would expose an implementation constant.
            </i>
           </div>
          </div>
         </aside>
        </div>
        <p class="text" id="p0670">
         Not all instances of default arguments need to be converted to overloaded methods. If the default argument represents an invalid or empty value, such as defining
         <span class="inlinecode">
          nullptr
         </span>
         as the default value for a pointer or
         <span class="inlinecode">
          ""
         </span>
         for a string argument, then this usage is unlikely to change between API versions. However, if you have cases where you are hardcoding specific constant values into your API that might change in future releases, then you should convert these cases to use the overloaded method technique instead.
        </p>
        <p class="text" id="p0675">
         As a performance note, you should also try to avoid defining default arguments that involve constructing a temporary object, because these will be passed into the method by value and can therefore be expensive.
        </p>
       </section>
      </section>
      <section>
       <a id="s0115">
       </a>
       <h2 class="h1hd" id="cesectitle0125">
        Avoid #define for constants
       </h2>
       <p class="textfl" id="p0680">
        The
        <span class="inlinecode">
         #define
        </span>
        preprocessor directive is essentially used to substitute one string with another string in your source code. However, its use is generally frowned upon in the C++ community for several good reasons (
        <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib17">
         Cline et al., 1998
        </a>
        ; DeLoura, 2001;
        <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib70">
         Meyers, 2005
        </a>
        ). Many of these reasons are related to the subtle problems that can happen if you use
        <span class="inlinecode">
         #define
        </span>
        to specify code macros that you wish to insert into multiple places. For example:
        <a id="p240">
        </a>
        <span aria-label="240" epub:type="pagebreak" id="pagebreak_240" role="doc-pagebreak">
        </span>
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0225">
          <img alt="image" height="371" src="../../IMAGES/B9780443222191000106/main.assets/u06-44-9780443222191.jpg" width="1388"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="text" id="p0685">
        However, you should never be using
        <span class="inlinecode">
         #define
        </span>
        in this way for your public API headers, because of course it leaks implementation details. If you want to use this technique in your
        <span class="inlinecode">
         .cpp
        </span>
        files, and you understand all the idiosyncrasies of
        <span class="inlinecode">
         #define
        </span>
        , then go ahead, but never do this in your public headers.
       </p>
       <p class="text" id="p0690">
        That just leaves the use of
        <span class="inlinecode">
         #define
        </span>
        to specify constants for your API, such as:
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0230">
          <img alt="image" height="197" src="../../IMAGES/B9780443222191000106/main.assets/u06-45-9780443222191.jpg" width="1074"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="text" id="p0695">
        You should avoid even this use of
        <span class="inlinecode">
         #define
        </span>
        (unless you're writing a pure C API, of course), for these reasons:
       </p>
       <div>
        <ul class="ce_list" id="olist0035">
         <li class="numlist" id="p0700">
          <a id="o0060">
          </a>
          1.
          <b>
           No typing.
          </b>
          A
          <span class="inlinecode">
           #define
          </span>
          does not involve any type checking for the constant you are defining. You must therefore make sure that you explicitly specify the type of the constant you're defining to avoid any ambiguities, such as the use of the “f” suffix on single-precision floating-point constants. If you defined a floating-point constant as simply 10, then it may be assumed to be an integer in certain cases and cause undesired math rounding errors.
         </li>
         <li class="numlist" id="p0705">
          <a id="o0065">
          </a>
          2.
          <b>
           No scoping.
          </b>
          A
          <span class="inlinecode">
           #define
          </span>
          statement is global and is not limited to a particular scope, such as within a single class. You can use the
          <span class="inlinecode">
           #undef
          </span>
          preprocessor directive to undefine a previous
          <span class="inlinecode">
           #define
          </span>
          , but this makes little sense for declaring a constant that you want your clients to be able to use.
         </li>
         <li class="numlist" id="p0710">
          <a id="o0070">
          </a>
          3.
          <b>
           No access control.
          </b>
          You cannot mark a
          <span class="inlinecode">
           #define
          </span>
          as public, protected, or private. It's essentially always public. You therefore can't use
          <span class="inlinecode">
           #define
          </span>
          to specify a constant that should be accessed only by derived classes of a base class that you define.
         </li>
         <li class="numlist" id="p0715">
          <a id="o0075">
          </a>
          4.
          <b>
           No symbols.
          </b>
          In the previous example, the symbolic names such as
          <span class="inlinecode">
           MORPH_IN_TIME
          </span>
          may be stripped from your code by the preprocessor, and as such the compiler never sees this name and cannot enter it into the symbol table (
          <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib70">
           Meyers, 2005
          </a>
          ). This can hide valuable information from your clients when they try to debug code using your API, because they will simply see the constant value used in the debugger, without any descriptive name.
         </li>
        </ul>
       </div>
       <p class="textfl">
        <a id="p241">
        </a>
       </p>
       <div>
        <span aria-label="241" epub:type="pagebreak" id="pagebreak_241" role="doc-pagebreak">
        </span>
       </div>
       <p class="text" id="p0720">
        The preferred alternative to using
        <span class="inlinecode">
         #define
        </span>
        to declare API constants is to use a const variable. I will discuss some of the best practices of declaring constants in the later chapter on Performance, because it's possible to declare const variables in a way that adds bloat to your clients' programs. For now, I'll simply present a good conversion of the previous
        <span class="inlinecode">
         #define
        </span>
        example:
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0235">
          <img alt="image" height="487" src="../../IMAGES/B9780443222191000106/main.assets/u06-46-9780443222191.jpg" width="1213"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="text" id="p0725">
        where the actual values of these constants are specified in the associated
        <span class="inlinecode">
         .cpp
        </span>
        file. If you really want your users to know what the values of these constants are, then you can tell them this information in the API documentation for the
        <span class="inlinecode">
         Morph
        </span>
        class. Alternatively, as of C++17, you can use inline variables to define your constants only in your header files, which is a much more elegant solution. Note that this representation doesn't suffer from any of the problems I listed earlier: the constants are typed as floats, scoped to the
        <span class="inlinecode">
         Morph
        </span>
        class, explicitly marked as publicly accessible, and will generate entries in the symbol table.
       </p>
       <div>
        <aside aria-labelledby="b0070" epub:type="sidebar">
         <div class="box_top_space">
         </div>
         <div class="boxg1" id="b0070">
          <div class="b1textfl" id="bpar0070">
           <i>
            TIP: Use static const data members to represent class constants instead of #define (or use inline variables as of C++17).
           </i>
          </div>
         </div>
        </aside>
       </div>
       <p class="text" id="p0730">
        A further use of
        <span class="inlinecode">
         #define
        </span>
        is to provide a list of possible values for a given variable. For example:
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0240">
          <img alt="image" height="255" src="../../IMAGES/B9780443222191000106/main.assets/u06-47-9780443222191.jpg" width="900"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="text" id="p0735">
        This is better expressed in C++ using enumerated types, via an
        <span class="inlinecode">
         enum class
        </span>
        . Using enums gives you better type safety because the compiler will now ensure that you set any enum values with the symbolic name and not directly as an integer. This also makes it more difficult to pass illegal values, such as
        <span>
         −
        </span>
        1 or 23 in the previous example. You can turn the earlier
        <span class="inlinecode">
         #define
        </span>
        lines into an enumerated type as:
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0245">
          <img alt="image" height="371" src="../../IMAGES/B9780443222191000106/main.assets/u06-48-9780443222191.jpg" width="901"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="textfl">
        <a id="p242">
        </a>
       </p>
       <div>
        <span aria-label="242" epub:type="pagebreak" id="pagebreak_242" role="doc-pagebreak">
        </span>
       </div>
      </section>
      <section>
       <a id="s0120">
       </a>
       <h2 class="h1hd" id="cesectitle0130">
        Avoid using friends
       </h2>
       <p class="textfl" id="p0740">
        In C++, friendship is a way for your class to grant full access privileges to another class or function. The friend class or function can then access all protected and private members of your class. This can be useful when you need to split your class into two or more parts, but you still need each part to access private members of the other part. It's also useful when you need to employ an internal visitor or callback technique: that is, when some other internal class in your implementation code needs to call a private method in your class.
       </p>
       <p class="text" id="p0745">
        One alternative would be to expose the member data and function that need to be shared, converting them from private to public so that the other class can access them. However, this would mean that you're exposing implementation details to your clients, details that would not otherwise be part of your logical interface. From this point of view, friends are a good thing because they let you open up access to your class to only specific clients. However, friendship can be abused by your users, allowing them to gain full access to your class's internal details.
       </p>
       <p class="text" id="p0750">
        For example, consider the following class that specifies a single
        <span class="inlinecode">
         Node
        </span>
        , as part of a
        <span class="inlinecode">
         Graph
        </span>
        hierarchy. The
        <span class="inlinecode">
         Graph
        </span>
        may need to perform various iterations over all nodes and therefore needs to keep track of whether a node has already been visited (to handle graph cycles). One way to implement this would be to have the
        <span class="inlinecode">
         Node
        </span>
        object hold the state for whether it has already been visited, with accessors for this state. This is a purely implementation detail, so you don't want to expose this functionality in the public interface. Instead, you declare it as private, but explicitly give the
        <span class="inlinecode">
         Graph
        </span>
        object access to the
        <span class="inlinecode">
         Node
        </span>
        object by declaring it as a friend:
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0250">
          <img alt="image" height="718" src="../../IMAGES/B9780443222191000106/main.assets/u06-49-9780443222191.jpg" width="935"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="textfl">
        <a id="p243">
        </a>
       </p>
       <div>
        <span aria-label="243" epub:type="pagebreak" id="pagebreak_243" role="doc-pagebreak">
        </span>
       </div>
       <p class="text" id="p0755">
        This seems okay on the face of it: you have kept the various
        <span class="inlinecode">
         ∗Visited()
        </span>
        methods as private and only permitted the
        <span class="inlinecode">
         Graph
        </span>
        class to access to our internal details. However, the problem with this is that the friendship offer is based upon the name of the other class only. It would therefore be possible for clients to create their own class called
        <span class="inlinecode">
         Graph
        </span>
        , which would then be able to access all protected and private members of
        <span class="inlinecode">
         Node
        </span>
        (
        <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib52" id="bib_52">
         Lakos, 1996
        </a>
        ). The subsequent client program demonstrates how easy it is to perform this kind of access control violation:
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0255">
          <img alt="image" height="1123" src="../../IMAGES/B9780443222191000106/main.assets/u06-50-9780443222191.jpg" width="1525"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="text" id="p0760">
        So, by using friends you are leaving a gaping hole in your API that could be used to circumvent your public API boundary and break encapsulation.
       </p>
       <p class="text" id="p0765">
        In that example, a better solution that obviates the need to use friends would be for the
        <span class="inlinecode">
         Graph
        </span>
        object to maintain its own list of nodes that it has already visited (e.g., by maintaining an
        <span class="inlinecode">
         std::set&lt;Node ∗&gt;
        </span>
        container) rather than storing the visited state in the individual nodes themselves. This is also a better conceptual design because the information about whether another class has processed a
        <span class="inlinecode">
         Node
        </span>
        is not inherently an attribute of the
        <span class="inlinecode">
         Node
        </span>
        itself.
       </p>
       <div>
        <aside aria-labelledby="b0075" epub:type="sidebar">
         <div class="box_top_space">
         </div>
         <div class="boxg1" id="b0075">
          <div class="b1textfl" id="bpar0075">
           <i>
            TIP: Avoid using friends. They tend to indicate a poor design and can allow users to gain access to all protected and private members of your API.
           </i>
          </div>
         </div>
        </aside>
       </div>
       <p class="text" id="p0770">
        It's worth noting that there can be some acceptable uses of friends, such as to help with unit testing of private methods. I will show how to do this in the Testing Private Code section of the Testing chapter.
        <a id="p244">
        </a>
       </p>
       <div>
        <span aria-label="244" epub:type="pagebreak" id="pagebreak_244" role="doc-pagebreak">
        </span>
       </div>
      </section>
      <section>
       <a id="s0125">
       </a>
       <h2 class="h1hd" id="cesectitle0135">
        Exporting symbols
       </h2>
       <p class="textfl" id="p0775">
        In addition to the language-level access control features (public, private, and protected), there are two related concepts that allow you to expose symbols in your API at the physical file level:
       </p>
       <div>
        <ul class="ce_list" id="olist0040">
         <li class="numlist" id="p0780">
          <a id="o0080">
          </a>
          1. External linkage
         </li>
         <li class="numlist" id="p0785">
          <a id="o0085">
          </a>
          2. Exported visibility
         </li>
        </ul>
       </div>
       <p class="text" id="p0790">
        The term external linkage means that a symbol in one translation unit can be accessed from other translation units, whereas exporting refers to a symbol that is visible from a library file such as a DLL. Only external linkage symbols can be exported.
       </p>
       <p class="text" id="p0795">
        Let's look at external linkage first. This is the first stage that determines whether your clients can access symbols in your shared libraries. Specifically, global (file scope) free functions and variables in your
        <span class="inlinecode">
         .cpp
        </span>
        file will have external linkage unless you take steps to prevent this. For example, consider this code that might appear in one of your
        <span class="inlinecode">
         .cpp
        </span>
        files:
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0260">
          <img alt="image" height="718" src="../../IMAGES/B9780443222191000106/main.assets/u06-51-9780443222191.jpg" width="1836"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="text" id="p0800">
        Even though you have contained the use of these functions and variables inside a
        <span class="inlinecode">
         .cpp
        </span>
        file, resourceful clients could easily gain access to these symbols from their own programs (ignoring symbol exporting issues for the moment). They could then call your global functions directly and modify your global state without going through your public API, thus breaking encapsulation. The following program fragment demonstrates how to achieve this:
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0265">
          <img alt="image" height="718" src="../../IMAGES/B9780443222191000106/main.assets/u06-52-9780443222191.jpg" width="2114"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="textfl">
        <a id="p245">
        </a>
       </p>
       <div>
        <span aria-label="245" epub:type="pagebreak" id="pagebreak_245" role="doc-pagebreak">
        </span>
       </div>
       <p class="text" id="p0805">
        There are a couple of solutions to this kind of external linkage leakage problem:
       </p>
       <div>
        <ul class="ce_list" id="olist0045">
         <li class="numlist" id="p0810">
          <a id="o0090">
          </a>
          1.
          <b>
           Static declaration.
          </b>
          Prepend the declaration of your functions and variables with the
          <span class="inlinecode">
           static
          </span>
          keyword. This specifies that the function or variable should have internal linkage and hence will not be accessible outside the translation unit in which it appears.
         </li>
         <li class="numlist" id="p0815">
          <a id="o0095">
          </a>
          2.
          <b>
           Anonymous namespace.
          </b>
          A more idiomatic C++ solution is to enclose your file-scope functions and variables inside an anonymous namespace. This is a better solution because it avoids polluting the global namespace. This can be done as:
         </li>
        </ul>
       </div>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0270">
          <img alt="image" height="950" src="../../IMAGES/B9780443222191000106/main.assets/u06-53-9780443222191.jpg" width="1836"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <div>
        <aside aria-labelledby="b0080" epub:type="sidebar">
         <div class="box_top_space">
         </div>
         <div class="boxg1" id="b0080">
          <div class="b1textfl" id="bpar0080">
           <i>
            TIP: Use internal linkage to hide file scope free functions and variables inside your .cpp files. This means using the static keyword or the anonymous namespace.
           </i>
          </div>
         </div>
        </aside>
       </div>
       <p class="text" id="p0820">
        For symbols that have external linkage, there's the further concept of exporting symbols, which determines whether a symbol is visible from a shared library. Most compilers provide decorations for classes and functions that let you explicitly specify whether a symbol will appear in the exported symbol table for a library file. However, this tends to be compiler-specific behavior. For example:
       </p>
       <div>
        <ul class="ce_list" id="olist0050">
         <li class="numlist" id="p0825">
          <a id="o0100">
          </a>
          1.
          <b>
           Microsoft Visual Studio.
          </b>
          Symbols in a DLL are not accessible by default. You must explicitly export functions, classes, and variables in a DLL to allow your clients to access them. You do this using the
          <span class="inlinecode">
           __declspec
          </span>
          decorator before a symbol. For example, you specify
          <span class="inlinecode">
           __declspec(dllexport)
          </span>
          to export a symbol when you're building a DLL. Clients must then specify
          <span class="inlinecode">
           __declspec(dllimport)
          </span>
          to access the same symbol in their own programs.
          <a id="p246">
          </a>
         </li>
         <li>
          <span aria-label="246" epub:type="pagebreak" id="pagebreak_246" role="doc-pagebreak">
          </span>
         </li>
         <li class="numlist" id="p0830">
          <a id="o0105">
          </a>
          2.
          <b>
           GNU/Clang C++ compiler.
          </b>
          Symbols with external linkage in a dynamic library are visible by default. However, you can use the visibility
          <span class="inlinecode">
           __attribute__
          </span>
          decorator to explicitly hide a symbol. As an alternative to hiding individual symbols, the GNU C++ 4.0 compiler introduced the
          <span class="inlinecode">
           -fvisibility=hidden
          </span>
          flag to set all declarations to hidden visibility by default. Individual symbols can then be explicitly exported using
          <span class="inlinecode">
           __attribute__ ((visibility("default")))
          </span>
          . This is more like Windows behavior, in which all symbols are considered internal unless you explicitly export them. Using the
          <span class="inlinecode">
           -fvisibility=hidden
          </span>
          flag can also have a dramatic impact on the load time performance of your dynamic library and produce smaller library files.
         </li>
        </ul>
       </div>
       <p class="text" id="p0835">
        You can define various preprocessor macros to deal with these compiler differences in a cross-platform way. Here's an example of defining a
        <span class="inlinecode">
         DLL_PUBLIC
        </span>
        macro to export symbols explicitly, and a
        <span class="inlinecode">
         DLL_HIDDEN
        </span>
        macro to hide symbols when using the GNU C++ compiler. Note that you must specify an
        <span class="inlinecode">
         _EXPORTING
        </span>
        define when you build the library file on Windows (i.e.,
        <span class="inlinecode">
         /D "_EXPORTING"
        </span>
        ). This is an arbitrary define name; you can call it whatever you like (as long as you also update this code):
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0275">
          <img alt="image" height="1412" src="../../IMAGES/B9780443222191000106/main.assets/u06-54-9780443222191.jpg" width="2150"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="text" id="p0840">
        For example, to export a class or function of your API you can do this:
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0280">
          <img alt="image" height="139" src="../../IMAGES/B9780443222191000106/main.assets/u06-55-9780443222191.jpg" width="1005"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="text" id="p0845">
        Many compilers also allow you to provide a simple ASCII file that defines the list of symbols that should be exported by a dynamic library, so that you don't need to decorate
        <a id="p247">
        </a>
        <span aria-label="247" epub:type="pagebreak" id="pagebreak_247" role="doc-pagebreak">
        </span>
        your code with macros such as the previous
        <span class="inlinecode">
         DLL_PUBLIC
        </span>
        . Symbols that don't appear in this file will be hidden from client programs. For example, the Windows Visual Studio compiler supports
        <span class="inlinecode">
         .def
        </span>
        files, whereas the GNU compiler supports export map files. See
        <a href="#s0010">
         Appendix A
        </a>
        for more details on these export files.
       </p>
       <div>
        <aside aria-labelledby="b0085" epub:type="sidebar">
         <div class="box_top_space">
         </div>
         <div class="boxg1" id="b0085">
          <div class="b1textfl" id="bpar0085">
           <i>
            TIP: Explicitly export public API symbols to maintain direct control over the classes, functions, and variables that are accessible from your dynamic libraries. For GNU C++, this implies using the
           </i>
           <span class="inlinecode">
            <i>
             -fvisibility=hidden
            </i>
           </span>
           <i>
            option.
           </i>
          </div>
         </div>
        </aside>
       </div>
       <p class="text" id="p0850">
        Note that with the introduction of modules in C++20, you can use the
        <span class="inlinecode">
         export
        </span>
        keyword within a named module to indicate which symbols should be accessible from the module. This effectively standardizes the export behavior of symbols for translation units for all compilers, though only if you're using modules. See the Modules section in the C++ Revisions chapter for more details about this feature.
       </p>
      </section>
      <section>
       <a id="s0130">
       </a>
       <h2 class="h1hd" id="cesectitle0140">
        Coding conventions
       </h2>
       <p class="textfl" id="p0855">
        C++ is a very complex language with many power features. The use of good coding conventions can partially help to manage this complexity by ensuring that all code follows certain style guidelines and avoids common pitfalls. It also contributes toward consistent code, which I identified as one of the important qualities of a good API in
        <a href="../B9780443222191000143/CH0002_25-80_B9780443222191000143.xhtml">
         Chapter 2
        </a>
        .
       </p>
       <div>
        <aside aria-labelledby="b0090" epub:type="sidebar">
         <div class="box_top_space">
         </div>
         <div class="boxg1" id="b0090">
          <div class="b1textfl" id="bpar0090">
           <i>
            TIP: Specify coding standards for your API to help enforce consistency, define processes, and document common engineering pitfalls.
           </i>
          </div>
         </div>
        </aside>
       </div>
       <p class="text" id="p0860">
        Producing a coding standard document can be a lengthy and factious process, not only because of the complexity of the language but also because of the amount of personal taste and style that it aims to stipulate. Different engineers have different preferences for where to place brackets and spaces, or what style of comments to adopt, or whether to use lower or upper camelCase for function names. For example, in this book I have consistently formatted source code snippets with pointer or reference symbols next to variable names, not type names. For example:
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0285">
          <img alt="image" height="81" src="../../IMAGES/B9780443222191000106/main.assets/u06-56-9780443222191.jpg" width="415"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="textfl">
        <a id="p248">
        </a>
       </p>
       <div>
        <span aria-label="248" epub:type="pagebreak" id="pagebreak_248" role="doc-pagebreak">
        </span>
       </div>
       <p class="text" id="p0865">
        instead of:
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0290">
          <img alt="image" height="81" src="../../IMAGES/B9780443222191000106/main.assets/u06-57-9780443222191.jpg" width="415"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="text" id="p0870">
        I favor the former style because from a language perspective the pointer is associated with the variable, not the type (in both of these cases,
        <span class="inlinecode">
         a
        </span>
        and
        <span class="inlinecode">
         b
        </span>
        are pointers). However, other software engineers prefer the latter style.
       </p>
       <p class="text" id="p0875">
        In this book, I do not advocate that you should adopt any particular style for your projects, but I do urge you to adopt some conventions for your API, whatever they are. The important point is to be consistent. Indeed, it's generally accepted among engineers that when editing a source file, you should adopt the conventions that are already in force in that file, rather than adding your own style into the mix and producing a file with a mixture of inconsistent styles (or you might be more antisocial and reformat the entire file to your own style).
       </p>
       <p class="text" id="p0880">
        Many large companies have already gone through the process of creating and publishing coding style documents, so you could always simply adopt one of these standards to make the decision easier. Doing a Web search for “C++ Coding Conventions” should return many hits for your consideration. In particular, the Google C++ Style Guide is a very extensive document used by many other groups (
        <a href="https://google.github.io/styleguide/">
         https://google.github.io/styleguide/
        </a>
        ). There are also some great books that provide even more depth and provide detail on numerous code constructs that should be used or avoided (
        <a href="../B9780443222191160015/References_583-587_B9780443222191160015.xhtml#bib98">
         Sutter and Alexandrescu, 2004
        </a>
        ).
       </p>
       <p class="text" id="p0885">
        Without making specific suggestions, I will enumerate some of the areas that a good coding standard should cover:
       </p>
       <div>
        <ol id="ulist0050">
         <li class="bulllist" id="p0890">
          <a id="u0175">
          </a>
          ▪
          <b>
           Naming conventions.
          </b>
          Whether to use
          <span class="inlinecode">
           .cc
          </span>
          ,
          <span class="inlinecode">
           .c++
          </span>
          , or
          <span class="inlinecode">
           .cpp
          </span>
          ; capitalization of filenames; use of prefixes in filenames; capitalization of classes, functions, variables, differentiating private members, constants, typedefs, enums, macros, namespaces; use of namespaces; and so on.
         </li>
         <li class="bulllist" id="p0895">
          <a id="u0180">
          </a>
          ▪
          <b>
           Header files.
          </b>
          How to
          <span class="inlinecode">
           #include
          </span>
          headers; use of double quotes versus angle brackets; ordering
          <span class="inlinecode">
           #include
          </span>
          statements; using
          <span class="inlinecode">
           #define
          </span>
          guards or
          <span class="inlinecode">
           #pragma once
          </span>
          ; use of forward declarations; inlining code policy; and so forth.
         </li>
         <li class="bulllist" id="p0900">
          <a id="u0185">
          </a>
          ▪
          <b>
           Comments.
          </b>
          Comment style; templates for commenting files, classes, functions, and so on; documentation requirements; commenting code with todo notes or highlighting known hacks; and so on.
         </li>
         <li class="bulllist" id="p0905">
          <a id="u0190">
          </a>
          ▪
          <b>
           Formatting.
          </b>
          Line length limit; spaces versus tabs; placement of braces; spacing between statements; how to break long lines; layout of constructor initialization lists; etc.
         </li>
         <li class="bulllist" id="p0910">
          <a id="u0195">
          </a>
          ▪
          <b>
           Classes.
          </b>
          Use of constructors; factories; inheritance; multiple inheritance; interfaces; composition, structs versus classes; access control; and so forth.
          <a id="p249">
          </a>
         </li>
         <li>
          <span aria-label="249" epub:type="pagebreak" id="pagebreak_249" role="doc-pagebreak">
          </span>
         </li>
         <li class="bulllist" id="p0915">
          <a id="u0200">
          </a>
          ▪
          <b>
           Best practices.
          </b>
          Use of templates; use of exceptions; use of enums; const correctness; use of pointers for output parameters, use of pimpl; initialization of all member variables; casting; operator overloading rules; virtual destructors; use of globals; and so on.
         </li>
         <li class="bulllist" id="p0920">
          <a id="u0205">
          </a>
          ▪
          <b>
           Portability.
          </b>
          Writing architecture-specific code; preprocessor macros for platforms; class member alignment; and so forth.
         </li>
         <li class="bulllist" id="p0925">
          <a id="u0210">
          </a>
          ▪
          <b>
           Process.
          </b>
          Compiling with warnings as errors; unit tests requirements; use of code reviews; use of use cases; SCM style check hooks; compile with extra checks such as
          <span class="inlinecode">
           -Wextra
          </span>
          and
          <span class="inlinecode">
           -Weffc++
          </span>
          ; and so on.
         </li>
        </ol>
       </div>
       <p class="text" id="p0930">
        The best kind of coding conventions are the ones that can be applied to your code automatically. There are several tools you can use to format your source files consistently; one that I like is clang-format. This comes with a few built-in styles such as LLVM, GNU, Google, Chromium, Microsoft, Mozilla, and WebKit. So if you want just to adopt one of these standard coding conventions, you can very easily conform all of your code with a single command line, such as:
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0295">
          <img alt="image" height="81" src="../../IMAGES/B9780443222191000106/main.assets/u06-58-9780443222191.jpg" width="1352"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="text" id="p0935">
        And if there's some part of the style that you don't like, then clang-format supports an extensive list of settings that you can edit. To do this, you can dump out the configuration for one of the standard styles to a file, and then edit that file to suit your preferences. For example, here's how you could create a config file called
        <span class="inlinecode">
         .clang-format
        </span>
        with all of the Microsoft style options, and then you can go in and edit that file to your own taste:
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0300">
          <img alt="image" height="81" src="../../IMAGES/B9780443222191000106/main.assets/u06-59-9780443222191.jpg" width="2012"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="text" id="p0940">
        You can then format your code with your custom style by running the command:
       </p>
       <div>
        <div class="pageavoid">
         <figure class="fig" id="f0305">
          <img alt="image" height="81" src="../../IMAGES/B9780443222191000106/main.assets/u06-60-9780443222191.jpg" width="1283"/>
          <figcaption class="figleg">
          </figcaption>
         </figure>
        </div>
       </div>
       <p class="text" id="p0945">
        In this case, the tool will specifically look for a file called
        <span class="inlinecode">
         .clang-format
        </span>
        in your source directory. If it doesn't find the file, it will look through each parent directory. A good practice is therefore to put this file in the root directory of your source repository so that it affects all of your code. You could also consider updating any build scripts to format your code automatically or define a hook for your revision control system to run it before pushing changes. That way, you can ensure that your code always follows your code
        <a id="p250">
        </a>
        <span aria-label="250" epub:type="pagebreak" id="pagebreak_250" role="doc-pagebreak">
        </span>
        conventions, and as an added bonus you can avoid code review feedback with nitpick comments about spacing or braces placement.
       </p>
       <p class="text" id="p0950">
        In fact, all of the code samples throughout this book have been formatted with
        <span class="inlinecode">
         clang-format
        </span>
        to enforce a consistent style. You can find the configuration file that I used in the source code package on the book website,
        <a href="https://APIBook.com/">
         https://APIBook.com/
        </a>
        .
       </p>
      </section>
     </section>
    </section>
   </div>
  </div>
 </body>
</html>
