<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html>
<html epub:prefix="z3998: http://www.daisy.org/z3998/2012/vocab/structure/#" lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
 <head>
  <link href="style.css" rel="stylesheet" type="text/css"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   10
  </title>
 </head>
 <body>
  <div class="navigation">
   <a class="nav-button" href="chapter_013.html">
    ← Previous
   </a>
   <a class="nav-button" href="index.html">
    Table of Contents
   </a>
   <a class="nav-button" href="chapter_015.html">
    Next →
   </a>
  </div>
  <div class="chapter-content">
   <div id="_idContainer168">
    <h1 class="chapter-number" id="_idParaDest-207">
     <a id="_idTextAnchor207">
     </a>
     10
    </h1>
    <h1 id="_idParaDest-208">
     <a id="_idTextAnchor208">
     </a>
     JSON Parsing Made Easy
    </h1>
    <p>
     JSON is the file
     <a id="_idIndexMarker671">
     </a>
     extension of a data format called
     <strong class="bold">
      JavaScript Object Notation
     </strong>
     , which is used to store and transport information in a structured format. The
     <a id="_idIndexMarker672">
     </a>
     JSON format is used extensively for the web. Most modern web
     <strong class="bold">
      Application Programming Interfaces
     </strong>
     (
     <strong class="bold">
      APIs
     </strong>
     ) use JSON format to transfer data to their
     <span class="No-Break">
      web clients.
     </span>
    </p>
    <p>
     This chapter will cover the
     <span class="No-Break">
      following recipes:
     </span>
    </p>
    <ul>
     <li>
      JSON format in
      <span class="No-Break">
       a nutshell
      </span>
     </li>
     <li>
      Processing JSON data from a
      <span class="No-Break">
       text file
      </span>
     </li>
     <li>
      Writing JSON data to a
      <span class="No-Break">
       text file
      </span>
     </li>
     <li>
      Using Google’s
      <span class="No-Break">
       Geocoding API
      </span>
     </li>
    </ul>
    <h1 id="_idParaDest-209">
     <a id="_idTextAnchor209">
     </a>
     Technical requirements
    </h1>
    <p>
     The technical requirements for this chapter include Qt 6.6.1 MinGW 64-bit and Qt Creator 12.0.2. All the code used in this chapter can be downloaded from the following GitHub
     <span class="No-Break">
      repository:
     </span>
     <a href="https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter10">
      <span class="No-Break">
       https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter10
      </span>
     </a>
     <span class="No-Break">
      .
     </span>
    </p>
    <h1 id="_idParaDest-210">
     <a id="_idTextAnchor210">
     </a>
     JSON format in a nutshell
    </h1>
    <p>
     JSON is a
     <a id="_idIndexMarker673">
     </a>
     human-readable text format commonly used for data transmission in web
     <a id="_idIndexMarker674">
     </a>
     applications, especially
     <strong class="bold">
      JavaScript
     </strong>
     applications. However, it is also used for many other purposes, hence it is independent of JavaScript and can be used for any programming language or platform, despite
     <span class="No-Break">
      its name.
     </span>
    </p>
    <p>
     In this example, we will learn about JSON format and how to verify whether your JSON data is in a valid format
     <span class="No-Break">
      or not.
     </span>
    </p>
    <h2 id="_idParaDest-211">
     <a id="_idTextAnchor211">
     </a>
     How to do it…
    </h2>
    <p>
     Let’s get
     <a id="_idIndexMarker675">
     </a>
     started and learn how to write your own JSON data and verify
     <span class="No-Break">
      its format:
     </span>
    </p>
    <ol>
     <li>
      Open up your web browser and go to the
      <strong class="bold">
       JSONLint Online Validator and Formatter
      </strong>
      website
      <span class="No-Break">
       at
      </span>
      <a href="https://jsonlint.com">
       <span class="No-Break">
        https://jsonlint.com
       </span>
      </a>
      <span class="No-Break">
       .
      </span>
     </li>
     <li>
      Write the following JSON data in the text editor on
      <span class="No-Break">
       the website:
      </span>
      <pre class="source-code">
{
    "members": [
        {
            "name": "John",
            "age": 29,
            "gender": "male"
        },
        {
            "name": "Alice",
            "age": 24,
            "gender": "female"
        },
        {
            "name": "",
            "age": 26,
            "gender": "male"
        }
    ]
}</pre>
     </li>
     <li>
      After that, press the
      <strong class="bold">
       Validate JSON
      </strong>
      button. You should get the
      <span class="No-Break">
       following result:
      </span>
      <pre class="source-code">
JSON is valid!</pre>
     </li>
     <li>
      Now, try to
      <a id="_idIndexMarker676">
      </a>
      remove the double quote symbols from the
      <span class="No-Break">
       <strong class="source-inline">
        members
       </strong>
      </span>
      <span class="No-Break">
       variable:
      </span>
      <pre class="source-code">
{
    <strong class="bold">members</strong>: [
        {
            "name": "John",
            "age": 29,
            "gender": "male"
        },</pre>
     </li>
     <li>
      Press the
      <strong class="bold">
       Validate JSON
      </strong>
      button again and you should get an error
      <span class="No-Break">
       like this:
      </span>
      <pre class="source-code">
Invalid JSON!
Error: Parse error on line 1:
{    members: [        {
-----^
Expecting 'STRING', '}', got 'undefined'</pre>
     </li>
     <li>
      Now, revert to the valid JSON format by adding the double quote symbols back to the
      <strong class="source-inline">
       members
      </strong>
      variable. Then, press the
      <strong class="bold">
       Compress
      </strong>
      button. You should get the following result, which has no empty space and
      <span class="No-Break">
       next lines:
      </span>
      <pre class="source-code">
{"members":[{"name":"John","age":29,"gender":"male"},
{"name":"Alice","age":24,"gender":"female"},
{"name":"","age":26,"gender":"male"}]}</pre>
     </li>
     <li>
      You can now press the
      <strong class="bold">
       Prettify
      </strong>
      button to revert it to the
      <span class="No-Break">
       previous structure.
      </span>
     </li>
    </ol>
    <h2 id="_idParaDest-212">
     <a id="_idTextAnchor212">
     </a>
     How it works…
    </h2>
    <p>
     The curly braces,
     <strong class="source-inline">
      {
     </strong>
     and
     <strong class="source-inline">
      }
     </strong>
     , contain
     <a id="_idIndexMarker677">
     </a>
     a set of data as an object. An
     <strong class="bold">
      object
     </strong>
     is an individual data structure
     <a id="_idIndexMarker678">
     </a>
     that contains its own properties or variables
     <a id="_idIndexMarker679">
     </a>
     in the form of
     <strong class="bold">
      key-value pairs
     </strong>
     . Keys are unique strings that act as human-readable variable names, and values are represented by either a string, integer, floating-point number, Boolean, or even an entire object or array. JSON supports recursive objects, which is very handy for many different
     <span class="No-Break">
      use cases.
     </span>
    </p>
    <p>
     The square
     <a id="_idIndexMarker680">
     </a>
     brackets,
     <strong class="source-inline">
      [
     </strong>
     and
     <strong class="source-inline">
      ]
     </strong>
     , indicate that the data is contained in an array. An
     <strong class="bold">
      array
     </strong>
     simply stores a list of values of the same type, which can be manipulated, sorted, or removed from the array by iterating over its content using a standard iterator pattern in any programming language you use for
     <span class="No-Break">
      your project.
     </span>
    </p>
    <p>
     In the previous example, we first created a nameless object as the main object of the data. You must create either a main object or a main array as a starting point. Then, we added an array called
     <strong class="source-inline">
      members
     </strong>
     , which contains individual objects with variables such as
     <strong class="source-inline">
      name
     </strong>
     ,
     <strong class="source-inline">
      age
     </strong>
     , and
     <strong class="source-inline">
      gender
     </strong>
     . Do note that if you add double quotes (
     <strong class="source-inline">
      "
     </strong>
     ) around an integer or floating-point number, the variable will be treated as a string instead of
     <span class="No-Break">
      a number.
     </span>
    </p>
    <p>
     The previous example demonstrated the simplest form of JSON data that can be sent through the network and processed by any modern
     <span class="No-Break">
      programming language.
     </span>
    </p>
    <h1 id="_idParaDest-213">
     <a id="_idTextAnchor213">
     </a>
     Processing JSON data from a text file
    </h1>
    <p>
     In this
     <a id="_idIndexMarker681">
     </a>
     recipe, we will learn how to process JSON
     <a id="_idIndexMarker682">
     </a>
     data taken from a text file and extract it using the
     <span class="No-Break">
      stream reader.
     </span>
    </p>
    <h2 id="_idParaDest-214">
     <a id="_idTextAnchor214">
     </a>
     How to do it…
    </h2>
    <p>
     Let’s create a simple program that reads and processes XML files by following
     <span class="No-Break">
      these steps:
     </span>
    </p>
    <ol>
     <li>
      Create a new
      <strong class="bold">
       Qt Widgets Application
      </strong>
      project at your
      <span class="No-Break">
       desired location.
      </span>
     </li>
     <li>
      Open any
      <a id="_idIndexMarker683">
      </a>
      text editor and create a JSON
      <a id="_idIndexMarker684">
      </a>
      file that looks like the following, then save it
      <span class="No-Break">
       as
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        scene.json
       </strong>
      </span>
      <span class="No-Break">
       :
      </span>
      <pre class="source-code">
[
    {
        "name": "Library",
        "tag": "building",
        "position": [120.0, 0.0, 50.68],
        "rotation": [0.0, 0.0, 0.0],
        "scale": [1.0, 1.0, 1.0]
    }
]</pre>
     </li>
     <li>
      Continue to write the JSON code by adding more objects after the
      <strong class="source-inline">
       Library
      </strong>
      object, as shown in the
      <span class="No-Break">
       following code:
      </span>
      <pre class="source-code">
{
    "name": "Town Hall",
    "tag": "building",
    "position": [80.2, 0.0, 20.5],
    "rotation": [0.0, 0.0, 0.0],
    "scale": [1.0, 1.0, 1.0]
},
{
    "name": "Tree",
    "tag": "prop",
    "position": [10.46, -0.2, 80.2],
    "rotation": [0.0, 0.0, 0.0],
    "scale": [1.0, 1.0, 1.0]
}</pre>
     </li>
     <li>
      Go
      <a id="_idIndexMarker685">
      </a>
      back to Qt Creator and open
      <strong class="source-inline">
       mainwindow.h
      </strong>
      . Add the following headers at the top
      <a id="_idIndexMarker686">
      </a>
      of the script, right after
      <strong class="source-inline">
       #
      </strong>
      <span class="No-Break">
       <strong class="source-inline">
        include &lt;QMainWindow&gt;
       </strong>
      </span>
      <span class="No-Break">
       :
      </span>
      <pre class="source-code">
#include &lt;QJsonDocument&gt;
#include &lt;QJsonArray&gt;
#include &lt;QJsonObject&gt;
#include &lt;QDebug&gt;
#include &lt;QFile&gt;
#include &lt;QFileDialog&gt;</pre>
     </li>
     <li>
      Open
      <strong class="source-inline">
       mainwindow.ui
      </strong>
      and drag a push button from the widget box on the left side to the UI editor. Change the object name of the button to
      <strong class="source-inline">
       loadJsonButton
      </strong>
      and its display text to
      <span class="No-Break">
       <strong class="source-inline">
        Load JSON
       </strong>
      </span>
      <span class="No-Break">
       :
      </span>
     </li>
    </ol>
    <div>
     <div class="IMG---Figure" id="_idContainer160">
      <img alt="Figure 10.1 – Adding the Load JSON push button" src="../images\image/B20976_10_001.jpg"/>
     </div>
    </div>
    <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
     Figure 10.1 – Adding the Load JSON push button
    </p>
    <ol>
     <li value="6">
      Right-click on the button and select
      <strong class="bold">
       Go to slot…
      </strong>
      . A window will pop up with a list of signals available
      <span class="No-Break">
       for selection.
      </span>
     </li>
     <li>
      Choose
      <a id="_idIndexMarker687">
      </a>
      the default
      <strong class="source-inline">
       clicked()
      </strong>
      option
      <a id="_idIndexMarker688">
      </a>
      and press the
      <strong class="bold">
       OK
      </strong>
      button. Qt will now insert a slot function in your header and source files
      <span class="No-Break">
       called
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        on_loadJsonButton_clicked()
       </strong>
      </span>
      <span class="No-Break">
       .
      </span>
     </li>
     <li>
      Add the following code to the
      <span class="No-Break">
       <strong class="source-inline">
        on_loadJsonButton_clicked()
       </strong>
      </span>
      <span class="No-Break">
       function:
      </span>
      <pre class="source-code">
void MainWindow::on_loadJsonButton_clicked()
{
    QString filename = QFileDialog::getOpenFileName(this, "Open JSON", ".", "JSON files (*.json)");
    QFile file(filename);
    if (!file.open(QFile::ReadOnly | QFile::Text))
        qDebug() &lt;&lt; "Error loading JSON file.";
    QByteArray data = file.readAll();
    file.close();
    QJsonDocument json = QJsonDocument::fromJson(data);</pre>
     </li>
     <li>
      We continue to write the code. The following code loops through the JSON file and prints out each attribute’s name
      <span class="No-Break">
       and value:
      </span>
      <pre class="source-code">
if (json.isArray())
{
    QJsonArray array = json.array();
    if (array.size() &gt; 0)
    {
        for (int i = 0; i &lt; array.size(); ++i)
        {
            qDebug() &lt;&lt; "[Object]=================================";
            QJsonObject object = json[i].toObject();
            QStringList keys = object.keys();
            for (int j = 0; j &lt; keys.size(); ++j)
            {
                qDebug() &lt;&lt; keys.at(j) &lt;&lt; object.value(keys.at(j));
            }
            qDebug() &lt;&lt; "=========================================";
        }
    }
}</pre>
     </li>
     <li>
      Build
      <a id="_idIndexMarker689">
      </a>
      and run the project and you will see
      <a id="_idIndexMarker690">
      </a>
      a window pop up that looks like the one you made in
      <span class="No-Break">
       <em class="italic">
        step 5
       </em>
      </span>
      <span class="No-Break">
       :
      </span>
     </li>
    </ol>
    <div>
     <div class="IMG---Figure" id="_idContainer161">
      <img alt="Figure 10.2 – Building and launching the program" src="../images\image/B20976_10_002.jpg"/>
     </div>
    </div>
    <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
     Figure 10.2 – Building and launching the program
    </p>
    <ol>
     <li value="11">
      Click on the
      <strong class="bold">
       Load JSON
      </strong>
      button and you should see the
      <em class="italic">
       file selector
      </em>
      window pop up on the screen. Select the JSON file you created in
      <em class="italic">
       step 2
      </em>
      and press the
      <strong class="bold">
       Select
      </strong>
      button. You
      <a id="_idIndexMarker691">
      </a>
      should see the following
      <a id="_idIndexMarker692">
      </a>
      debug text appear in the
      <em class="italic">
       Application Output
      </em>
      window in Qt Creator, which indicates that the program has successfully loaded the data from the JSON file you
      <span class="No-Break">
       just selected:
      </span>
     </li>
    </ol>
    <div>
     <div class="IMG---Figure" id="_idContainer162">
      <img alt="Figure 10.3 – The results printed in the Application Output window" src="../images\image/B20976_10_003.jpg"/>
     </div>
    </div>
    <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
     Figure 10.3 – The results printed in the Application Output window
    </p>
    <h2 id="_idParaDest-215">
     <a id="_idTextAnchor215">
     </a>
     How it works…
    </h2>
    <p>
     In this example, we’re trying to extract and process data from a JSON file using the
     <strong class="source-inline">
      QJsonDocument
     </strong>
     class. Imagine you’re making a computer game and you’re using JSON files to
     <a id="_idIndexMarker693">
     </a>
     store the attributes of all the objects in your game scene. In this case, the JSON format plays an important role in storing the data in a structured way, which allows for
     <span class="No-Break">
      easy extraction.
     </span>
    </p>
    <p>
     We need to add the header of the class related to JSON to our source file, which, in this case, is the
     <strong class="source-inline">
      QJsonDocument
     </strong>
     class. The
     <strong class="source-inline">
      QJsonDocument
     </strong>
     class is built into Qt’s core library, so there is no need to include any additional modules with it, which also means that it’s the recommended class to use to process JSON data in Qt. Once we click on the
     <strong class="bold">
      Load JSON
     </strong>
     button, the
     <strong class="source-inline">
      on_loadJsonButton_clicked()
     </strong>
     slot will be called; this is where we write the code to process the
     <span class="No-Break">
      JSON data.
     </span>
    </p>
    <p>
     We use a file dialog to select the JSON file we want to process. Then, we send the selected file’s filename, together with its path, to the
     <strong class="source-inline">
      QFile
     </strong>
     class to open and read the text data of the JSON file. After that, the file’s data is sent to the
     <strong class="source-inline">
      QJsonDocument
     </strong>
     class
     <span class="No-Break">
      for processing.
     </span>
    </p>
    <p>
     We first
     <a id="_idIndexMarker694">
     </a>
     check whether the main JSON structure
     <a id="_idIndexMarker695">
     </a>
     is an array. If it is an array, we then check whether the array has any data in it. After that, use a
     <strong class="source-inline">
      for
     </strong>
     loop to read through the entire array and extract the individual objects stored in
     <span class="No-Break">
      the array.
     </span>
    </p>
    <p>
     Then, we extract the key-pair data from the objects and print out both the key
     <span class="No-Break">
      and value.
     </span>
    </p>
    <h2 id="_idParaDest-216">
     <a id="_idTextAnchor216">
     </a>
     There’s more…
    </h2>
    <p>
     Besides the web applications, many commercial game engines and interactive applications use the JSON format to store information for in-game scenes, meshes, and other forms of assets used in their products. This is because the JSON format provides many benefits over other file formats, such as compact file size, high flexibility and extendibility, easy file recovery, and a relational tree structure that allows it to be used for highly efficient and performance-critical applications, such as search engines, intelligent data mining servers, and
     <span class="No-Break">
      scientific simulations.
     </span>
    </p>
    <p class="callout-heading">
     Note
    </p>
    <p class="callout">
     To learn
     <a id="_idIndexMarker696">
     </a>
     more about the XML format,
     <span class="No-Break">
      visit
     </span>
     <a href="https://www.w3schools.com/js/js_json_intro.asp">
      <span class="No-Break">
       https://www.w3schools.com/js/js_json_intro.asp
      </span>
     </a>
     <span class="No-Break">
      .
     </span>
    </p>
    <h1 id="_idParaDest-217">
     <a id="_idTextAnchor217">
     </a>
     Writing JSON data to a text file
    </h1>
    <p>
     Since we
     <a id="_idIndexMarker697">
     </a>
     have learned how to process data obtained
     <a id="_idIndexMarker698">
     </a>
     from a JSON file in the previous recipe, we will move on to learning how to save data to a JSON file. We will continue with the previous example and add
     <span class="No-Break">
      to it.
     </span>
    </p>
    <h2 id="_idParaDest-218">
     <a id="_idTextAnchor218">
     </a>
     How to do it…
    </h2>
    <p>
     We will learn how to save data in a JSON file through the
     <span class="No-Break">
      following steps:
     </span>
    </p>
    <ol>
     <li>
      Add another button to
      <strong class="source-inline">
       mainwindow.ui
      </strong>
      , then set its object name as
      <strong class="source-inline">
       saveJsonButton
      </strong>
      and its label as
      <span class="No-Break">
       <strong class="source-inline">
        Save JSON
       </strong>
      </span>
      <span class="No-Break">
       :
      </span>
     </li>
    </ol>
    <div>
     <div class="IMG---Figure" id="_idContainer163">
      <img alt="Figure 10.4 – Adding the Save JSON button" src="../images\image/B20976_10_004.jpg"/>
     </div>
    </div>
    <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
     Figure 10.4 – Adding the Save JSON button
    </p>
    <ol>
     <li value="2">
      Right-click
      <a id="_idIndexMarker699">
      </a>
      on the button and select
      <strong class="bold">
       Go to slot…
      </strong>
      . A window
      <a id="_idIndexMarker700">
      </a>
      will pop up with a list of signals available for selection. Select the
      <strong class="source-inline">
       clicked()
      </strong>
      option and click
      <strong class="bold">
       OK
      </strong>
      . A signal function called
      <strong class="source-inline">
       on_saveJsonButton_clicked()
      </strong>
      will now be automatically added to both your
      <strong class="source-inline">
       mainwindow.h
      </strong>
      and
      <strong class="source-inline">
       mainwindow.cpp
      </strong>
      files
      <span class="No-Break">
       by Qt:
      </span>
     </li>
    </ol>
    <div>
     <div class="IMG---Figure" id="_idContainer164">
      <img alt="Figure 10.5 – Selecting the clicked() signal and pressing OK" src="../images\image/B20976_10_005.jpg"/>
     </div>
    </div>
    <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
     Figure 10.5 – Selecting the clicked() signal and pressing OK
    </p>
    <ol>
     <li value="3">
      Add the following code to the
      <span class="No-Break">
       <strong class="source-inline">
        on_saveJsonButton_clicked()
       </strong>
      </span>
      <span class="No-Break">
       function:
      </span>
      <pre class="source-code">
QQString filename = QFileDialog::getSaveFileName(this, "Save JSON", ".", "JSON files (*.json)");
QFile file(filename);
if (!file.open(QFile::WriteOnly | QFile::Text))
    qDebug() &lt;&lt; "Error saving JSON file.";
QJsonDocument json;
QJsonArray array;</pre>
     </li>
     <li>
      Let’s
      <a id="_idIndexMarker701">
      </a>
      also write the first
      <span class="No-Break">
       <strong class="source-inline">
        contact
       </strong>
      </span>
      <span class="No-Break">
       element:
      </span>
      <pre class="source-code">
QJsonObject contact1;
contact1["category"] = "Friend";
contact1["name"] = "John Doe";
contact1["age"] = 32;
contact1["address"] = "114B, 2nd Floor, Sterling Apartment, Morrison Town";
contact1["phone"] = "0221743566";
array.append(contact1);</pre>
     </li>
     <li>
      Write
      <a id="_idIndexMarker702">
      </a>
      the second
      <strong class="source-inline">
       contact
      </strong>
      element
      <span class="No-Break">
       as follows:
      </span>
      <pre class="source-code">
QJsonObject contact2;
contact2["category"] = "Family";
contact2["name"] = "Jane Smith";
contact2["age"] = 24;
contact2["address"] = "13, Ave Park, Alexandria";
contact2["phone"] = "0025728396";
array.append(contact2);</pre>
     </li>
     <li>
      Finally, save the data into the
      <span class="No-Break">
       text file:
      </span>
      <pre class="source-code">
json.setArray(array);
    file.write(json.toJson());
    file.close();
}</pre>
     </li>
     <li>
      Build and
      <a id="_idIndexMarker703">
      </a>
      run the program and you should see an
      <a id="_idIndexMarker704">
      </a>
      additional button on the
      <span class="No-Break">
       program UI:
      </span>
     </li>
    </ol>
    <div>
     <div class="IMG---Figure" id="_idContainer165">
      <img alt="Figure 10.6 – Your application should now look like this" src="../images\image/B20976_10_006.jpg"/>
     </div>
    </div>
    <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
     Figure 10.6 – Your application should now look like this
    </p>
    <ol>
     <li value="8">
      Click on the
      <strong class="bold">
       Save JSON
      </strong>
      button and a save file dialog will appear on the screen. Type the filename you require and click the
      <span class="No-Break">
       <strong class="bold">
        Save
       </strong>
      </span>
      <span class="No-Break">
       button.
      </span>
     </li>
     <li>
      Open up the JSON file you just saved with any text editor. The first part of the file should look
      <span class="No-Break">
       like this:
      </span>
      <pre class="source-code">
[
    {
        "address": "114B, 2nd Floor, Sterling Apartment, Morrison Town",
        "age": 32,
        "category": "Friend",
        "name": "John Doe",
        "phone": "0221743566"
    },
    {
        "address": "13, Ave Park, Alexandria",
        "age": 24,
        "category": "Family",
        "name": "Jane Smith",
        "phone": "0025728396"
    }
]</pre>
     </li>
    </ol>
    <h2 id="_idParaDest-219">
     <a id="_idTextAnchor219">
     </a>
     How it works…
    </h2>
    <p>
     The saving
     <a id="_idIndexMarker705">
     </a>
     process is similar to loading a JSON file in the
     <a id="_idIndexMarker706">
     </a>
     previous example. The only difference is instead of using the
     <strong class="source-inline">
      QJsonDocument::fromJson()
     </strong>
     function, we switched to using the
     <strong class="source-inline">
      QJsonDocument::toJson()
     </strong>
     function. We still used the file dialog and the
     <strong class="source-inline">
      QFile
     </strong>
     class to save the XML file. This time, we had to change the open mode from
     <strong class="source-inline">
      QFile::ReadOnly
     </strong>
     to
     <strong class="source-inline">
      QFile::WriteOnly
     </strong>
     before passing the byte array data to the
     <span class="No-Break">
      <strong class="source-inline">
       QFile
      </strong>
     </span>
     <span class="No-Break">
      class.
     </span>
    </p>
    <p>
     Next, we started writing the JSON file by creating
     <strong class="source-inline">
      QJsonDocument
     </strong>
     and
     <strong class="source-inline">
      QJsonArray
     </strong>
     variables followed by creating a
     <strong class="source-inline">
      QJsonObject
     </strong>
     object for each contact. Then, we filled in the information for each contact and appended it to the
     <span class="No-Break">
      <strong class="source-inline">
       QJsonArray
      </strong>
     </span>
     <span class="No-Break">
      array.
     </span>
    </p>
    <p>
     Finally, we used
     <strong class="source-inline">
      QJsonDocument::setArray()
     </strong>
     to apply the
     <strong class="source-inline">
      QJsonArray
     </strong>
     array we created previously as the main array of the JSON data before passing it to the
     <strong class="source-inline">
      QFile
     </strong>
     class as a byte array data using the
     <span class="No-Break">
      <strong class="source-inline">
       QJsonDocument::toJson()
      </strong>
     </span>
     <span class="No-Break">
      function.
     </span>
    </p>
    <h1 id="_idParaDest-220">
     <a id="_idTextAnchor220">
     </a>
     Using Google’s Geocoding API
    </h1>
    <p>
     In this
     <a id="_idIndexMarker707">
     </a>
     example, we will learn how to obtain the full address of a specific location by using Google’s
     <span class="No-Break">
      Geocoding API.
     </span>
    </p>
    <h2 id="_idParaDest-221">
     <a id="_idTextAnchor221">
     </a>
     How to do it…
    </h2>
    <p>
     Let’s create a program that utilizes the Geocoding API by following
     <span class="No-Break">
      these steps:
     </span>
    </p>
    <ol>
     <li>
      Create a new
      <strong class="bold">
       Qt Widgets
      </strong>
      <span class="No-Break">
       <strong class="bold">
        Application
       </strong>
      </span>
      <span class="No-Break">
       project.
      </span>
     </li>
     <li>
      Open
      <strong class="source-inline">
       mainwindow.ui
      </strong>
      and add a couple of text labels, input fields, and a button to make your UI look similar
      <span class="No-Break">
       to this:
      </span>
     </li>
    </ol>
    <div>
     <div class="IMG---Figure" id="_idContainer166">
      <img alt="Figure 10.7 – Setting up your UI" src="../images\image/B20976_10_007.jpg"/>
     </div>
    </div>
    <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
     Figure 10.7 – Setting up your UI
    </p>
    <ol>
     <li value="3">
      Open your project (
      <strong class="source-inline">
       .pro
      </strong>
      ) file and add the network module to your project. You can do that by simply adding the word
      <strong class="source-inline">
       network
      </strong>
      after
      <strong class="source-inline">
       core
      </strong>
      and
      <strong class="source-inline">
       gui
      </strong>
      , as shown in the
      <span class="No-Break">
       following code:
      </span>
      <pre class="source-code">
QT += core gui <strong class="bold">network</strong></pre>
     </li>
     <li>
      Open
      <strong class="source-inline">
       mainwindow.h
      </strong>
      and add the following headers to the
      <span class="No-Break">
       source code:
      </span>
      <pre class="source-code">
#include &lt;QMainWindow&gt;
#include &lt;QDebug&gt;
#include &lt;QtNetwork/QNetworkAccessManager&gt;
#include &lt;QtNetwork/QNetworkReply&gt;
#include &lt;QJsonDocument&gt;
#include &lt;QJsonArray&gt;
#include &lt;QJsonObject&gt;</pre>
     </li>
     <li>
      Declare a slot function manually and call
      <span class="No-Break">
       it
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        getAddressFinished()
       </strong>
      </span>
      <span class="No-Break">
       :
      </span>
      <pre class="source-code">
private slots:
void getAddressFinished(QNetworkReply* reply);</pre>
     </li>
     <li>
      Declare a
      <strong class="source-inline">
       private
      </strong>
      variable
      <span class="No-Break">
       called
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        addressRequest
       </strong>
      </span>
      <span class="No-Break">
       :
      </span>
      <pre class="source-code">
private:
QNetworkAccessManager* addressRequest;</pre>
     </li>
     <li>
      Open
      <strong class="source-inline">
       mainwindow.ui
      </strong>
      again, right-click on the
      <strong class="bold">
       Get Address
      </strong>
      button, and select
      <strong class="bold">
       Go to slot…
      </strong>
      . Then, choose the
      <strong class="source-inline">
       clicked()
      </strong>
      option and press
      <strong class="bold">
       OK
      </strong>
      . A slot function
      <a id="_idIndexMarker708">
      </a>
      will now be added to both the
      <strong class="source-inline">
       mainwindow.h
      </strong>
      and
      <strong class="source-inline">
       mainwindow.cpp
      </strong>
      <span class="No-Break">
       source files.
      </span>
     </li>
     <li>
      Open
      <strong class="source-inline">
       mainwindow.cpp
      </strong>
      and add the following code to the
      <span class="No-Break">
       class constructor:
      </span>
      <pre class="source-code">
MainWindow::MainWindow(QWidget *parent) :
QMainWindow(parent),
ui(new Ui::MainWindow) {
ui-&gt;setupUi(this);
<strong class="bold">addressRequest = new QNetworkAccessManager();</strong>
<strong class="bold">connect(addressRequest, &amp;QNetworkAccessManager::finished, this, &amp;MainWindow::getAddressFinished);</strong>
}</pre>
     </li>
     <li>
      Add the following code to the
      <strong class="source-inline">
       getAddressFinished()
      </strong>
      slot function we just
      <span class="No-Break">
       declared manually:
      </span>
      <pre class="source-code">
void MainWindow::getAddressFinished(QNetworkReply* reply) {
QByteArray bytes = reply-&gt;readAll();
//qDebug() &lt;&lt; QString::fromUtf8(bytes.data(), bytes.size());
QJsonDocument json = QJsonDocument::fromJson(bytes);</pre>
     </li>
     <li>
      Continue to get the first set of results from the JSON array to obtain the
      <span class="No-Break">
       formatted address:
      </span>
      <pre class="source-code">
QJsonObject object = json.object();
QJsonArray results = object["results"].toArray();
QJsonObject first = results.at(0).toObject();
QString address = first["formatted_address"].toString();
qDebug() &lt;&lt; "Address:" &lt;&lt; address;
}</pre>
     </li>
     <li>
      Add the
      <a id="_idIndexMarker709">
      </a>
      following code to the
      <strong class="source-inline">
       clicked()
      </strong>
      slot function created
      <span class="No-Break">
       by Qt:
      </span>
      <pre class="source-code">
void MainWindow::on_getAddressButton_clicked() {
QString latitude = ui-&gt;latitude-&gt;text();
QString longitude = ui-&gt;longitude-&gt;text();
QNetworkRequest request;
request.setUrl(QUrl("https://maps.googleapis.com/maps/api/geocode/json?latlng=" + latitude + "," + longitude + "&amp;key=YOUR_KEY"));
addressRequest-&gt;get(request);
}</pre>
     </li>
     <li>
      Build and run the program and you should be able to obtain the address by inserting the
      <strong class="bold">
       Longitude
      </strong>
      and
      <strong class="bold">
       Latitude
      </strong>
      values and clicking the
      <strong class="bold">
       Get
      </strong>
      <span class="No-Break">
       <strong class="bold">
        Address
       </strong>
      </span>
      <span class="No-Break">
       button:
      </span>
     </li>
    </ol>
    <div>
     <div class="IMG---Figure" id="_idContainer167">
      <img alt="Figure 10.8 – Inserting the coordinates and pressing the Get Address button" src="../images\image/B20976_10_008.jpg"/>
     </div>
    </div>
    <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
     Figure 10.8 – Inserting the coordinates and pressing the Get Address button
    </p>
    <ol>
     <li value="13">
      Let’s try with a longitude of
      <strong class="source-inline">
       -73.9780838
      </strong>
      and a latitude of
      <strong class="source-inline">
       40.6712957
      </strong>
      . Click the
      <strong class="bold">
       Get Address
      </strong>
      button and you will see the following result in the application
      <span class="No-Break">
       output window:
      </span>
      <pre class="source-code">
Address: "185 7th Ave, Brooklyn, NY 11215, USA"</pre>
     </li>
    </ol>
    <h2 id="_idParaDest-222">
     <a id="_idTextAnchor222">
     </a>
     How it works…
    </h2>
    <p>
     I won’t be able to tell you exactly how Google obtains the address from its backend system but I can teach you how to request data from Google by using
     <strong class="source-inline">
      QNetworkRequest
     </strong>
     . All you need to do is to set the URL of the network request to the URL I used in the previous source code and append both the latitude and longitude information to
     <span class="No-Break">
      the URL.
     </span>
    </p>
    <p>
     After that, all we
     <a id="_idIndexMarker710">
     </a>
     can do is wait for the response from the Google API server. We need to specify JSON as the desired format when sending the request to Google; otherwise, it may return the results in JSON format. This can be done by adding the
     <strong class="source-inline">
      json
     </strong>
     keyword within the network request URL, as
     <span class="No-Break">
      highlighted here:
     </span>
    </p>
    <pre class="console">
request.setUrl(QUrl("https://maps.googleapis.com/maps/api/geocode/xml?keylatlng=" + latitude + "," + longitude + "&amp;key=YOUR_CODE"));</pre>
    <p>
     When the program receives the response from Google, the
     <strong class="source-inline">
      getAddressFinished()
     </strong>
     slot function will be called and we will be able to obtain the data sent by Google
     <span class="No-Break">
      through
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       QNetworkReply
      </strong>
     </span>
     <span class="No-Break">
      .
     </span>
    </p>
    <p>
     Google usually replies with a long text in JSON format, which contains a ton of data we don’t need. All we need is the text stored in the
     <strong class="source-inline">
      formatted_address
     </strong>
     element in the JSON data. Since there is more than one element by the name of
     <strong class="source-inline">
      formatted_address
     </strong>
     , we just need to find the first one and ignore the rest. You can also do the
     <a id="_idIndexMarker711">
     </a>
     reverse by providing an address to Google and obtaining the location’s coordinates from its
     <span class="No-Break">
      network response.
     </span>
    </p>
    <h2 id="_idParaDest-223">
     <a id="_idTextAnchor223">
     </a>
     There’s more…
    </h2>
    <p>
     Google’s
     <strong class="bold">
      Geocoding API
     </strong>
     is part
     <a id="_idIndexMarker712">
     </a>
     of the
     <strong class="bold">
      Google Maps APIs
     </strong>
     web services, which provide geographical data for your map applications. Besides the Geocoding
     <a id="_idIndexMarker713">
     </a>
     API, you can
     <a id="_idIndexMarker714">
     </a>
     also use their
     <strong class="bold">
      Location API
     </strong>
     ,
     <strong class="bold">
      Geolocation API
     </strong>
     , and
     <strong class="bold">
      Time Zone API
     </strong>
     to
     <a id="_idIndexMarker715">
     </a>
     achieve your
     <span class="No-Break">
      desired results.
     </span>
    </p>
    <p class="callout-heading">
     Note
    </p>
    <p class="callout">
     For more
     <a id="_idIndexMarker716">
     </a>
     information regarding the Google Maps APIs web services,
     <span class="No-Break">
      visit
     </span>
     <a href="https://developers.google.com/maps/web-services">
      <span class="No-Break">
       https://developers.google.com/maps/web-services
      </span>
     </a>
     <span class="No-Break">
      .
     </span>
    </p>
   </div>
  </div>
 </body>
</html>
