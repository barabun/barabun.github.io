<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html>
<html epub:prefix="z3998: http://www.daisy.org/z3998/2012/vocab/structure/#" lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
 <head>
  <link href="style.css" rel="stylesheet" type="text/css"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   12
  </title>
 </head>
 <body>
  <div class="navigation">
   <a class="nav-button" href="chapter_019.html">
    ← Previous
   </a>
   <a class="nav-button" href="index.html">
    Table of Contents
   </a>
   <a class="nav-button" href="chapter_021.html">
    Next →
   </a>
  </div>
  <div class="chapter-content">
   <div class="calibre2" id="_idContainer217">
    <h1 class="chapter-number" id="_idParaDest-243">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor243">
     </a>
     12
    </h1>
    <h1 class="calibre5" id="_idParaDest-244">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor244">
     </a>
     Accessing Databases with SQL Driver and Qt
    </h1>
    <p class="calibre3">
     <strong class="bold">
      Structured Query Language
     </strong>
     (
     <strong class="bold">
      SQL
     </strong>
     ) is a special programming language used to manage data held in a relational database management system. A SQL server is a database system designed to use one of the many types of SQL programming languages to manage
     <span>
      its data.
     </span>
    </p>
    <p class="calibre3">
     In this chapter, we will cover the
     <span>
      following recipes:
     </span>
    </p>
    <ul class="calibre15">
     <li class="calibre14">
      Setting up
      <span>
       a database
      </span>
     </li>
     <li class="calibre14">
      Connecting to
      <span>
       a database
      </span>
     </li>
     <li class="calibre14">
      Writing basic
      <span>
       SQL queries
      </span>
     </li>
     <li class="calibre14">
      Creating a login screen
      <span>
       with Qt
      </span>
     </li>
     <li class="calibre14">
      Displaying information from a database in
      <span>
       model view
      </span>
     </li>
     <li class="calibre14">
      Advanced
      <span>
       SQL queries
      </span>
     </li>
    </ul>
    <h1 class="calibre5" id="_idParaDest-245">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor245">
     </a>
     Technical requirements
    </h1>
    <p class="calibre3">
     The technical requirements for this chapter include Qt 6.6.1 MinGW 64-bit and Qt Creator 12.0.2. All the code used in this chapter can be downloaded from the following GitHub
     <span>
      repository:
     </span>
     <a class="pcalibre pcalibre1 calibre6" href="https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter12">
      <span>
       https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter12
      </span>
     </a>
     <span>
      .
     </span>
    </p>
    <h1 class="calibre5" id="_idParaDest-246">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor246">
     </a>
     Setting up a database
    </h1>
    <p class="calibre3">
     Qt supports several different types of SQL drivers
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker763">
     </a>
     in the form of plugins/add-ons, such as
     <strong class="bold">
      SQLite
     </strong>
     ,
     <strong class="bold">
      ODBC
     </strong>
     ,
     <strong class="bold">
      PostgreSQL
     </strong>
     ,
     <strong class="bold">
      MySQL
     </strong>
     , and so on. However, it’s very easy to integrate these drivers into your Qt project. We will learn how to do this in the
     <span>
      following example.
     </span>
    </p>
    <h2 class="calibre7" id="_idParaDest-247">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor247">
     </a>
     How to do it…
    </h2>
    <p class="calibre3">
     In this example, we will learn
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker764">
     </a>
     how to use Qt with
     <strong class="bold">
      SQLite
     </strong>
     . Let’s set up our SQLite editor before we dive
     <span>
      into Qt:
     </span>
    </p>
    <ol class="calibre13">
     <li class="calibre14">
      Download
      <strong class="bold">
       SQLiteStudio
      </strong>
      from
      <a class="pcalibre pcalibre1 calibre6" href="https://sqlitestudio.pl">
       https://sqlitestudio.pl
      </a>
      and install it to administrate your
      <span>
       SQLite databases:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer185">
      <img alt="Figure 12.1 – Install SQLiteStudio onto your computer" class="calibre4" src="image/B20976_12_001.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.1 – Install SQLiteStudio onto your computer
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="2">
      Open
      <strong class="bold">
       SQLiteStudio
      </strong>
      and you should see something
      <span>
       like this:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer186">
      <img alt="Figure 12.2 – SQLiteStudio is a handy program for managing SQLite databases" class="calibre4" src="image/B20976_12_002.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.2 – SQLiteStudio is a handy program for managing SQLite databases
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="3">
      We need to create a new
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker765">
      </a>
      database before we start; go to
      <strong class="bold">
       Database
      </strong>
      |
      <strong class="bold">
       Add a database
      </strong>
      . Select the
      <strong class="bold">
       SQLite 3
      </strong>
      option for your database type, followed by selecting your file name and
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker766">
      </a>
      setting your database name. Then, click the
      <strong class="bold">
       Test connection
      </strong>
      button. You should see a green tick appearing beside the button. After that, click on the
      <span>
       <strong class="bold">
        OK
       </strong>
      </span>
      <span>
       button:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer187">
      <img alt="Figure 12.3 – Creating a new SQLite 3 database" class="calibre4" src="image/B20976_12_003.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.3 – Creating a new SQLite 3 database
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="4">
      Once the database has
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker767">
      </a>
      been created, you should see the database appear in the
      <strong class="bold">
       Databases
      </strong>
      window. Then, right-click on
      <strong class="bold">
       Tables
      </strong>
      and select
      <strong class="bold">
       Create a table
      </strong>
      option from the menu that
      <span>
       pops up:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer188">
      <img alt="Figure 12.4 – Select the Create a table option from the menu" class="calibre4" src="image/B20976_12_004.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.4 – Select the Create a table option from the menu
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="5">
      Set the table name as
      <strong class="source-inline1">
       employee
      </strong>
      . Then, click on the
      <strong class="bold">
       Add column (lns)
      </strong>
      button located above the
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker768">
      </a>
      table name input field. The
      <strong class="bold">
       Column
      </strong>
      window will now
      <span>
       pop up:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer189">
      <img alt="Figure 12.5 – Create a new column called emp_id" class="calibre4" src="image/B20976_12_005.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.5 – Create a new column called emp_id
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="6">
      Set the column name as
      <strong class="source-inline1">
       emp_id
      </strong>
      , set the data type as
      <strong class="bold">
       INTEGER
      </strong>
      , and check the
      <strong class="bold">
       Primary key
      </strong>
      checkbox. Then, click
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker769">
      </a>
      on the
      <strong class="bold">
       Configure
      </strong>
      button
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker770">
      </a>
      at the right of the
      <strong class="bold">
       Primary key
      </strong>
      checkbox. The
      <strong class="bold">
       Edit constraint
      </strong>
      window will now pop up. Check on the
      <strong class="bold">
       Autoincrement
      </strong>
      checkbox and
      <span>
       click
      </span>
      <span>
       <strong class="bold">
        Apply
       </strong>
      </span>
      <span>
       :
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer190">
      <img alt="Figure 12.6 – Enable the Autoincrement checkbox" class="calibre4" src="image/B20976_12_006.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.6 – Enable the Autoincrement checkbox
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="7">
      After that, press the
      <strong class="bold">
       OK
      </strong>
      button under the
      <strong class="bold">
       Column
      </strong>
      window. We have now successfully created a new column called
      <strong class="source-inline1">
       emp_id
      </strong>
      . Let’s repeat the steps above (without enabling the
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker771">
      </a>
      primary key) to create other columns. You may follow the same settings as
      <span>
       seen here:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer191">
      <img alt="Figure 12.7 – Create all five columns" class="calibre4" src="image/B20976_12_007.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.7 – Create all five columns
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="8">
      The columns are not actually created at this point. Click on the button with a green tick icon located
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker772">
      </a>
      above the table name. A window will pop up to confirm the creation of the columns. Press
      <strong class="bold">
       OK
      </strong>
      <span>
       to proceed:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer192">
      <img alt="Figure 12.8 – Click the OK button to confirm" class="calibre4" src="image/B20976_12_008.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.8 – Click the OK button to confirm
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="9">
      Now, we have created the
      <strong class="source-inline1">
       employee
      </strong>
      table. Let’s move on from the
      <strong class="bold">
       Structure
      </strong>
      tab to the
      <strong class="bold">
       Data
      </strong>
      tab. We can use the
      <strong class="bold">
       Data
      </strong>
      tab to view all the data belonging to the
      <strong class="source-inline1">
       employee
      </strong>
      table, which is currently empty. Let’s insert dummy data into the
      <strong class="source-inline1">
       employee
      </strong>
      table by
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker773">
      </a>
      clicking on the
      <strong class="bold">
       Insert row (Ins)
      </strong>
      button, which is the one with a green plus icon. Then, simply insert some dummy data
      <span>
       like so:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer193">
      <img alt="Figure 12.9 – Insert dummy data into the employee table" class="calibre4" src="image/B20976_12_009.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.9 – Insert dummy data into the employee table
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="10">
      Let’s set up the SQL driver for our Qt project. Just go to your Qt installation folder and look for the
      <strong class="source-inline1">
       sqldrivers
      </strong>
      folder. For example, mine is located
      <span>
       at
      </span>
      <span>
       <strong class="source-inline1">
        C:\Qt\6.4.2\mingw_64\plugins\sqldrivers
       </strong>
      </span>
      <span>
       .
      </span>
     </li>
     <li class="calibre14">
      Copy the entire
      <strong class="source-inline1">
       sqldrivers
      </strong>
      folder to your project’s build directory. You can remove the DLL files that are not relevant to the SQL server you’re running. In our case, since we’re using
      <strong class="bold">
       SQLite
      </strong>
      , we can delete everything
      <span>
       except
      </span>
      <span>
       <strong class="source-inline1">
        qsqlite.dll
       </strong>
      </span>
      <span>
       .
      </span>
     </li>
     <li class="calibre14">
      The DLL files mentioned in the previous step are the drivers that enable Qt to communicate with different
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker774">
      </a>
      types of SQL architecture. You may also need the DLL file of the SQL client library in order for the driver to work. In our case, we need
      <strong class="source-inline1">
       sqlite3.dll
      </strong>
      to be located in the same directory as our program’s executable. You can either get it from the installation directory of
      <strong class="bold">
       SQLiteStudio
      </strong>
      or from the official website of
      <span>
       <strong class="bold">
        SQLite
       </strong>
      </span>
      <span>
       :
      </span>
      <a class="pcalibre pcalibre1 calibre6" href="https://www.sqlite.org/download.html">
       <span>
        https://www.sqlite.org/download.html
       </span>
      </a>
      <span>
       .
      </span>
     </li>
    </ol>
    <h2 class="calibre7" id="_idParaDest-248">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor248">
     </a>
     How it works…
    </h2>
    <p class="calibre3">
     Qt provides us with SQL
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker775">
     </a>
     drivers so that we can easily connect to different types of SQL servers without implementing
     <span>
      them ourselves.
     </span>
    </p>
    <p class="calibre3">
     Currently, Qt officially supports SQLite, ODBC, and PostgreSQL. If you need to connect directly to MySQL, you need to recompile Qt drivers by yourself, which is out of the scope of this book. For security reasons, it’s not recommended that you connect to MySQL directly from your application. Instead, your application should interact with your MySQL database (or any other SQL servers that are not officially supported by Qt) indirectly by sending an HTTP request using
     <strong class="source-inline">
      QNetworkAccessManager
     </strong>
     to your backend script (such as PHP, ASP, and JSP), which can then communicate with
     <span>
      the database.
     </span>
    </p>
    <p class="calibre3">
     If you only need a simple file-based database and don’t plan to use a server-based database,
     <strong class="bold">
      SQLite
     </strong>
     is a good choice for you, which is what we have chosen for
     <span>
      this chapter.
     </span>
    </p>
    <p class="calibre3">
     In the
     <em class="italic">
      Connecting to a database
     </em>
     recipe, we will learn how to connect to our SQL database using Qt’s
     <span>
      SQL module.
     </span>
    </p>
    <h1 class="calibre5" id="_idParaDest-249">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor249">
     </a>
     Connecting to a database
    </h1>
    <p class="calibre3">
     In this recipe, we will learn how to
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker776">
     </a>
     connect our Qt 6 application to the
     <span>
      SQL server.
     </span>
    </p>
    <h2 class="calibre7" id="_idParaDest-250">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor250">
     </a>
     How to do it…
    </h2>
    <p class="calibre3">
     Connecting to SQL Server in Qt is
     <span>
      really simple:
     </span>
    </p>
    <ol class="calibre13">
     <li class="calibre14">
      Open Qt Creator and create a new
      <strong class="bold">
       Qt Widgets
      </strong>
      <span>
       <strong class="bold">
        Application
       </strong>
      </span>
      <span>
       project.
      </span>
     </li>
     <li class="calibre14">
      Open your project file (
      <strong class="source-inline1">
       .pro
      </strong>
      ), add the
      <strong class="source-inline1">
       sql
      </strong>
      module to your project, and run
      <strong class="source-inline1">
       qmake
      </strong>
      <span>
       like this:
      </span>
      <pre class="source-code">
QT += core gui <strong class="bold1">sql</strong></pre>
     </li>
     <li class="calibre14">
      Open
      <strong class="source-inline1">
       mainwindow.ui
      </strong>
      and drag seven label widgets, a combo box, and a checkbox to the canvas. Set the
      <strong class="source-inline1">
       text
      </strong>
      properties of four of the labels to
      <strong class="source-inline1">
       Name:
      </strong>
      ,
      <strong class="source-inline1">
       Age:
      </strong>
      ,
      <strong class="source-inline1">
       Gender:
      </strong>
      , and
      <strong class="source-inline1">
       Married:
      </strong>
      . Then, set the
      <strong class="source-inline1">
       objectName
      </strong>
      properties of the rest to name, age, gender, and married. There is no need to set the object name for the previous four labels because they’re for display
      <span>
       purposes only:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer194">
      <img alt="Figure 12.10 –  Setting the text properties" class="calibre4" src="image/B20976_12_010.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.10 –  Setting the text properties
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="4">
      Open
      <strong class="source-inline1">
       mainwindow.h
      </strong>
      and add
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker777">
      </a>
      the following headers below the
      <span>
       <strong class="source-inline1">
        QMainWindow
       </strong>
      </span>
      <span>
       header:
      </span>
      <pre class="source-code">
#include &lt;QMainWindow&gt;
<strong class="bold1">#include &lt;QtSql&gt;</strong>
<strong class="bold1">#include &lt;QSqlDatabase&gt;</strong>
<strong class="bold1">#include &lt;QSqlQuery&gt;</strong>
<strong class="bold1">#include &lt;QDebug&gt;</strong></pre>
     </li>
     <li class="calibre14">
      Open
      <strong class="source-inline1">
       mainwindow.cpp
      </strong>
      and insert the following code into the
      <span>
       class constructor:
      </span>
      <pre class="source-code">
MainWindow::MainWindow(QWidget *parent) :
     QMainWindow(parent), ui(new Ui::MainWindow) {
     ui-&gt;setupUi(this);
     <strong class="bold1">QSqlDatabase db = QSqlDatabase::addDatabase("QSQLITE");</strong>
     <strong class="bold1">db.setDatabaseName("database.db3");</strong></pre>
     </li>
     <li class="calibre14">
      Start the SQL query once the database connection has
      <span>
       been opened:
      </span>
      <pre class="source-code">
     if (db.open()) {
           QSqlQuery query;
           if (query.exec("SELECT emp_name, emp_age, emp_gender, emp_married FROM employee")) {
                 while (query.next()) {
                       qDebug() &lt;&lt; query.value(0) &lt;&lt; query.value(1) &lt;&lt;
query.value(2) &lt;&lt; query.value(3);
                       ui-&gt;name-&gt;setText(query.value(0).toString());
                       ui-&gt;age-&gt;setText(query.value(1).toString());
                       ui-&gt;gender-&gt;setCurrentIndex(query.value(2).toInt());
                       ui-&gt;married-&gt;setChecked(query.value(3).toBool());
                 }
           }</pre>
     </li>
     <li class="calibre14">
      Print out any
      <span>
       error
      </span>
      <span>
       <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker778">
       </a>
      </span>
      <span>
       texts:
      </span>
      <pre class="source-code">
           else {
                 qDebug() &lt;&lt; query.lastError().text();
           }
           db.close();
     }
     else {
           qDebug() &lt;&lt; "Failed to connect to database.";
     }
}</pre>
     </li>
     <li class="calibre14">
      If you compile and run your
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker779">
      </a>
      project now, you should get something
      <span>
       like this:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer195">
      <img alt="Figure 12.11 – The data from our database is now showing on the Qt program" class="calibre4" src="image/B20976_12_011.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.11 – The data from our database is now showing on the Qt program
    </p>
    <h2 class="calibre7" id="_idParaDest-251">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor251">
     </a>
     How it works…
    </h2>
    <p class="calibre3">
     The previous example shows you how to connect to your SQL database using the
     <strong class="source-inline">
      QSqlDatabase
     </strong>
     class derived from the SQL module. You won’t be able to access any of the classes related to SQL without adding the module to your
     <span>
      Qt project.
     </span>
    </p>
    <p class="calibre3">
     We must tell Qt which SQL architecture we are running by mentioning it when calling the
     <strong class="source-inline">
      addDatabase()
     </strong>
     function. The options supported by Qt are
     <strong class="bold">
      QSQLITE
     </strong>
     ,
     <strong class="bold">
      QODBC
     </strong>
     ,
     <strong class="bold">
      QODBC3
     </strong>
     ,
     <strong class="bold">
      QPSQL
     </strong>
     , and
     <strong class="bold">
      QPSQL7
     </strong>
     . If you encounter an error message that says
     <strong class="source-inline">
      QSqlDatabase: QMYSQL driver not loaded
     </strong>
     , you should check whether the DLL files are placed in the
     <span>
      correct directory.
     </span>
    </p>
    <p class="calibre3">
     We can send our SQL statements to the database through the
     <strong class="source-inline">
      QSqlQuery
     </strong>
     class and wait for it to return the results, which are usually either the data you requested or error messages due to invalid statements. If there are any data coming from the database server, they will all be stored in the
     <strong class="source-inline">
      QSqlQuery
     </strong>
     class. All you need to retrieve these data is to perform a “while” loop on the
     <strong class="source-inline">
      QSqlQuery
     </strong>
     class to check for all existing records and retrieve them by calling the
     <span>
      <strong class="source-inline">
       value()
      </strong>
     </span>
     <span>
      function.
     </span>
    </p>
    <p class="calibre3">
     Since we used SQLite in the preceding example, we don’t need to set the server host, username, and password when connecting to the database. SQLite is a file-based SQL database; therefore, we only need to set the file name when
     <span>
      calling
     </span>
     <span>
      <strong class="source-inline">
       QSqlDatabase::setDatabaseName()
      </strong>
     </span>
     <span>
      .
     </span>
    </p>
    <p class="callout-heading">
     Important note
    </p>
    <p class="callout">
     Qt 6 no longer officially
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker780">
     </a>
     supports QMYSQL or QMYSQL3. You can add MySQL support by re-compiling Qt from the source yourself. However, this method is not recommended for beginners. For more information, check
     <span>
      out
     </span>
     <a class="pcalibre pcalibre1 calibre6" href="https://doc.qt.io/qt-6/sql-driver.html#compile-qt-with-a-specific-driver">
      <span>
       https://doc.qt.io/qt-6/sql-driver.html#compile-qt-with-a-specific-driver
      </span>
     </a>
     <span>
      .
     </span>
    </p>
    <h1 class="calibre5" id="_idParaDest-252">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor252">
     </a>
     Writing basic SQL queries
    </h1>
    <p class="calibre3">
     In the previous example, we
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker781">
     </a>
     wrote our very first SQL query, which involves the
     <strong class="source-inline">
      SELECT
     </strong>
     statement. This time, we will learn how to use some other SQL statements, such as
     <strong class="source-inline">
      INSERT
     </strong>
     ,
     <strong class="source-inline">
      UPDATE
     </strong>
     ,
     <span>
      and
     </span>
     <span>
      <strong class="source-inline">
       DELETE
      </strong>
     </span>
     <span>
      .
     </span>
    </p>
    <h2 class="calibre7" id="_idParaDest-253">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor253">
     </a>
     How to do it…
    </h2>
    <p class="calibre3">
     Let’s create a simple program that demonstrates basic SQL query commands by following
     <span>
      these steps:
     </span>
    </p>
    <ol class="calibre13">
     <li class="calibre14">
      We can use our previous project files, but there are a couple of things we need to change. Open
      <strong class="source-inline1">
       mainwindow.ui
      </strong>
      and replace the labels for
      <strong class="bold">
       Name
      </strong>
      and
      <strong class="bold">
       Age
      </strong>
      with line-edit widgets. Then, add three buttons to the canvas and call them
      <strong class="source-inline1">
       UPDATE
      </strong>
      ,
      <strong class="source-inline1">
       INSERT
      </strong>
      ,
      <span>
       and
      </span>
      <span>
       <strong class="source-inline1">
        DELETE
       </strong>
      </span>
      <span>
       :
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer196">
      <img alt="Figure 12.12 – Modify the UI to this" class="calibre4" src="image/B20976_12_012.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.12 – Modify the UI to this
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="2">
      Open
      <strong class="source-inline1">
       mainwindow.h
      </strong>
      and add the following variables under the
      <span>
       private inheritance:
      </span>
      <pre class="source-code">
private:
     Ui::MainWindow *ui;
     <strong class="bold1">QSqlDatabase db;</strong>
     <strong class="bold1">bool connected;</strong>
     <strong class="bold1">int currentID;</strong></pre>
     </li>
     <li class="calibre14">
      Open
      <strong class="source-inline1">
       mainwindow.cpp
      </strong>
      and go to the class constructor. It is still pretty much the same as the previous example, except we store the database connection status in a Boolean
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker782">
      </a>
      variable called
      <strong class="source-inline1">
       connected
      </strong>
      , and we also obtain the ID of the data from the database and store it in an integer variable
      <span>
       called
      </span>
      <span>
       <strong class="source-inline1">
        currentID
       </strong>
      </span>
      <span>
       :
      </span>
      <pre class="source-code">
MainWindow::MainWindow(QWidget *parent) :
     QMainWindow(parent), ui(new Ui::MainWindow) {
     ui-&gt;setupUi(this);
     <strong class="bold1">db = QSqlDatabase::addDatabase("QSQLITE");</strong>
     <strong class="bold1">db.setDatabaseName("database.db3");</strong>
     <strong class="bold1">connected = db.open();</strong></pre>
     </li>
     <li class="calibre14">
      Let’s make a query after we have connected to
      <span>
       the database:
      </span>
      <pre class="source-code">
     if (connected) {
           QSqlQuery query;
           if (query.exec("SELECT emp_id, emp_name, emp_age, emp_gender, emp_married FROM employee")) {
                 while (query.next()) {
                       currentID = query.value(0).toInt();
                       ui-&gt;name-&gt;setText(query.value(1).toString());
                       ui-&gt;age-&gt;setText(query.value(2).toString());
                       ui-&gt;gender-&gt;setCurrentIndex(query.value(3).toInt());
                       ui-&gt;married-&gt;setChecked(query.value(4).toBool());
                 }
           }</pre>
     </li>
     <li class="calibre14">
      Print out any
      <span>
       error
      </span>
      <span>
       <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker783">
       </a>
      </span>
      <span>
       messages:
      </span>
      <pre class="source-code">
           else {
                 qDebug() &lt;&lt; query.lastError().text();
           }
     }
     else {
           qDebug() &lt;&lt; "Failed to connect to database.";
     }
}</pre>
     </li>
     <li class="calibre14">
      Go to
      <strong class="source-inline1">
       mainwindow.ui
      </strong>
      and right-click on one of the buttons we added to the canvas in step 1. Select
      <strong class="bold">
       Go to slot…
      </strong>
      and click
      <strong class="bold">
       OK
      </strong>
      . Repeat these steps on the other button, and now you should see three slot functions being added to both your
      <strong class="source-inline1">
       mainwindow.h
      </strong>
      <span>
       and
      </span>
      <span>
       <strong class="source-inline1">
        mainwindow.cpp
       </strong>
      </span>
      <span>
       :
      </span>
      <pre class="source-code">
private slots:
     void on_updateButton_clicked();
     void on_insertButton_clicked();
     void on_deleteButton_clicked();</pre>
     </li>
     <li class="calibre14">
      Open
      <strong class="source-inline1">
       mainwindow.cpp
      </strong>
      and we will declare what the program will do when we click on the
      <span>
       <strong class="bold">
        Update
       </strong>
      </span>
      <span>
       button:
      </span>
      <pre class="source-code">
void MainWindow::on_updateButton_clicked() {
     if (connected) {
           if (currentID == 0) {
                 qDebug() &lt;&lt; "Nothing to update.";
           }
           else {
                 QString id = QString::number(currentID);
                 QString name = ui-&gt;name-&gt;text();
                 QString age = ui-&gt;age-&gt;text();
                 QString gender =
QString::number(ui-&gt;gender-&gt;currentIndex());
                 QString married =
QString::number(ui-&gt;married-&gt;isChecked());</pre>
     </li>
     <li class="calibre14">
      Make an
      <strong class="source-inline1">
       UPDATE
      </strong>
      query
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker784">
      </a>
      <span>
       like so:
      </span>
      <pre class="source-code">
                 qDebug() &lt;&lt; "UPDATE employee SET emp_name = '" + name + "', emp_age = '" + age + "', emp_gender = " + gender + ", emp_married = " + married + " WHERE emp_id = " + id;
                 QSqlQuery query;
                 if (query.exec("UPDATE employee SET emp_name = '" + name + "', emp_age = '" + age + "', emp_gender = " + gender + ", emp_married = " + married + " WHERE emp_id = " + id)) {
                       qDebug() &lt;&lt; "Update success.";
                 }</pre>
     </li>
     <li class="calibre14">
      Print out the last error message,
      <span>
       if any:
      </span>
      <pre class="source-code">
                 else {
                       qDebug() &lt;&lt; query.lastError().text();
                 }
           }
     }
     else {
           qDebug() &lt;&lt; "Failed to connect to database.";
     }
}</pre>
     </li>
     <li class="calibre14">
      Declare what will
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker785">
      </a>
      happen when the
      <strong class="bold">
       INSERT
      </strong>
      button
      <span>
       is clicked:
      </span>
      <pre class="source-code">
void MainWindow::on_insertButton_clicked() {
     if (connected) {
           QString name = ui-&gt;name-&gt;text();
           QString age = ui-&gt;age-&gt;text();
           QString gender =
QString::number(ui-&gt;gender-&gt;currentIndex());
           QString married =
QString::number(ui-&gt;married-&gt;isChecked());
           qDebug() &lt;&lt; "INSERT INTO employee (emp_name, emp_age, emp_gender, emp_married) VALUES ('" + name + "','" + age + "', " + gender + "," + married + ")";</pre>
     </li>
     <li class="calibre14">
      Make an
      <strong class="source-inline1">
       INSERT
      </strong>
      query
      <span>
       like so:
      </span>
      <pre class="source-code">
           QSqlQuery query;
           if (query.exec("INSERT INTO employee (emp_name, emp_age, emp_gender, emp_married) VALUES ('" + name + "','" + age + "', " + gender + "," + married + ")")) {
                 currentID = query.lastInsertId().toInt();
                 qDebug() &lt;&lt; "Insert success.";
           } else {
                 qDebug() &lt;&lt; query.lastError().text();
           }
     }
     else {
           qDebug() &lt;&lt; "Failed to connect to database.";
     }
}</pre>
     </li>
     <li class="calibre14">
      Declare what will
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker786">
      </a>
      happen when the
      <strong class="bold">
       Delete
      </strong>
      button
      <span>
       is clicked:
      </span>
      <pre class="source-code">
void MainWindow::on_deleteButton_clicked() {
     if (connected) {
           if (currentID == 0) {
                 qDebug() &lt;&lt; "Nothing to delete.";
           } else {
                 QString id = QString::number(currentID);
                 qDebug() &lt;&lt; "DELETE FROM employee WHERE emp_id = " + id;
                 QSqlQuery query;
                 if (query.exec("DELETE FROM employee WHERE emp_id = " + id)) {
                       currentID = 0;
                       qDebug() &lt;&lt; "Delete success.";
                 } else {
                       qDebug() &lt;&lt; query.lastError().text();
                 }
           }
     }
     else {
           qDebug() &lt;&lt; "Failed to connect to database.";
     }
}</pre>
     </li>
     <li class="calibre14">
      Call
      <strong class="source-inline1">
       QSqlDatabase::close()
      </strong>
      at the class destructor to properly terminate the SQL connection
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker787">
      </a>
      before exiting
      <span>
       the program:
      </span>
      <pre class="source-code">
MainWindow::~MainWindow() {
     db.close();
     delete ui;
}</pre>
     </li>
     <li class="calibre14">
      If you compile and run the program now, you should be able to select the default data from the database. Then, you can choose to update it or delete it from the database. You can also insert new data into the database by clicking the Insert button. You can use
      <strong class="bold">
       SQLiteStudio
      </strong>
      to check whether the data are being
      <span>
       altered correctly:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer197">
      <img alt="Figure 12.13 – Data successfully modified in SQLite" class="calibre4" src="image/B20976_12_013.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.13 – Data successfully modified in SQLite
    </p>
    <h2 class="calibre7" id="_idParaDest-254">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor254">
     </a>
     How it works…
    </h2>
    <p class="calibre3">
     It’s very important to check whether the database is connected before we proceed to send an SQL query to the database. Therefore, we keep that status in a variable and use it to check before sending out any queries. This, however, is not recommended for complex programs that are kept
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker788">
     </a>
     open for long periods of time, as the database might get disconnected during those periods, and a fixed variable may not be accurate. In that case, it’s better to check the actual status by
     <span>
      calling
     </span>
     <span>
      <strong class="source-inline">
       QSqlDatabase::isOpen()
      </strong>
     </span>
     <span>
      .
     </span>
    </p>
    <p class="calibre3">
     The
     <strong class="source-inline">
      currentID
     </strong>
     variable is used to save the ID of the current data you obtained from the database. When you want to update the data or delete them from the database, this variable is crucial for letting the database know what data you’re trying to update or delete. If you set your database table correctly, SQLite will treat each item of data as a unique entry, so you can be sure that no repeated ID will be produced in the database when new data are
     <span>
      being saved.
     </span>
    </p>
    <p class="calibre3">
     After inserting new data into the database, we call
     <strong class="source-inline">
      QSqlQuery::lastInsertId()
     </strong>
     to obtain the ID of the new data and save it as a
     <strong class="source-inline">
      currentID
     </strong>
     variable so that it becomes the current data that we can update or delete from the database. It is a good habit to test your SQL queries on
     <strong class="source-inline">
      SQLiteStudio
     </strong>
     before using them in Qt. You can instantly find out whether your SQL statements are correct or incorrect instead of waiting for your project to be built, trying it out, and then rebuilding it. As programmers, we must work in the most
     <span>
      efficient way.
     </span>
    </p>
    <p class="calibre3">
     Work hard and
     <span>
      work smart.
     </span>
    </p>
    <h1 class="calibre5" id="_idParaDest-255">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor255">
     </a>
     Creating a login screen with Qt
    </h1>
    <p class="calibre3">
     In this recipe, we will learn
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker789">
     </a>
     how put our knowledge to use and create a
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker790">
     </a>
     functional login screen using Qt
     <span>
      and SQLite.
     </span>
    </p>
    <h2 class="calibre7" id="_idParaDest-256">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor256">
     </a>
     How to do it…
    </h2>
    <p class="calibre3">
     Create your first functional login screen by following
     <span>
      these steps:
     </span>
    </p>
    <ol class="calibre13">
     <li class="calibre14">
      Open a web browser and go to
      <strong class="bold">
       SQLiteStudio
      </strong>
      . We will create a new data table called
      <strong class="source-inline1">
       user
      </strong>
      , which looks
      <span>
       like this:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer198">
      <img alt="Figure 12.14 – Create a new user table" class="calibre4" src="image/B20976_12_014.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.14 – Create a new user table
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="2">
      Let’s insert our first item of data into the newly created table and set
      <strong class="source-inline1">
       user_employeeID
      </strong>
      to the ID of an existing employee. In this way, the user account we create will be linked to the data of one of
      <span>
       the employees:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer199">
      <img alt="Figure 12.15 – The user_employeeID column is linked to the employee’s emp_id column" class="calibre4" src="image/B20976_12_015.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.15 – The user_employeeID column is linked to the employee’s emp_id column
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="3">
      Open
      <strong class="bold">
       Qt Creator
      </strong>
      and create a new
      <strong class="bold">
       Qt Widgets Application
      </strong>
      project. We will start off with
      <strong class="source-inline1">
       mainwindow.ui
      </strong>
      . Place a
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker791">
      </a>
      stacked widget on the canvas and make sure it contains
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker792">
      </a>
      two pages. Then, set up the two pages in the stacked widget
      <span>
       as follows:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer200">
      <img alt="Figure 12.16 – Create a two-page UI inside a stacked widget" class="calibre4" src="image/B20976_12_016.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.16 – Create a two-page UI inside a stacked widget
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="4">
      On the first page of the stacked widget, click the
      <strong class="bold">
       Edit Tab Order
      </strong>
      icon on top of the widget so that you can adjust the order of the widgets in
      <span>
       your program:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer201">
      <img alt="Figure 12.17 – Change the order of the widgets by pressing this button" class="calibre4" src="image/B20976_12_017.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.17 – Change the order of the widgets by pressing this button
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="5">
      Once you click the
      <strong class="bold">
       Edit Tab Order
      </strong>
      icon, you will see some numbers appear on top of each widget in the canvas. Make sure the numbers look the same as they do in the screenshot that follows. Otherwise, click
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker793">
      </a>
      on the numbers to change their order. We only do this for
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker794">
      </a>
      the first page of the stacked widget; it’s okay to keep the second page as
      <span>
       it is:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer202">
      <img alt="Figure 12.18 – The order of each widget is shown" class="calibre4" src="image/B20976_12_018.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.18 – The order of each widget is shown
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="6">
      Right-click on the
      <strong class="bold">
       Login
      </strong>
      button and select
      <strong class="bold">
       Go to slot…
      </strong>
      . Then, make sure the
      <strong class="source-inline1">
       clicked()
      </strong>
      option is selected and press
      <strong class="bold">
       OK
      </strong>
      . Qt will then create a slot function for you in your project source files. Repeat this step for the
      <strong class="bold">
       Log Out
      </strong>
      button
      <span>
       as well.
      </span>
     </li>
     <li class="calibre14">
      Open
      <strong class="source-inline1">
       mainwindow.h
      </strong>
      and add the following headers after the
      <strong class="source-inline1">
       #include &lt;
      </strong>
      <span>
       <strong class="source-inline1">
        QMainWindow&gt;
       </strong>
      </span>
      <span>
       line:
      </span>
      <pre class="source-code">
#include &lt;QMainWindow&gt;
<strong class="bold1">#include &lt;QtSql&gt;</strong>
<strong class="bold1">#include &lt;QSqlDatabase&gt;</strong>
<strong class="bold1">#include &lt;QSqlQuery&gt;</strong>
<strong class="bold1">#include &lt;QMessageBox&gt;</strong>
<strong class="bold1">#include &lt;QDebug&gt;</strong></pre>
     </li>
     <li class="calibre14">
      Add the following variable
      <span>
       to
      </span>
      <span>
       <strong class="source-inline1">
        mainwindow.h
       </strong>
      </span>
      <span>
       :
      </span>
      <pre class="source-code">
private:
     Ui::MainWindow *ui;
     QSqlDatabase db;</pre>
     </li>
     <li class="calibre14">
      Open
      <strong class="source-inline1">
       mainwindow.cpp
      </strong>
      and
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker795">
      </a>
      put this code in the
      <span>
       class constructor:
      </span>
      <pre class="source-code">
MainWindow::MainWindow(QWidget *parent) :
     QMainWindow(parent),
     ui(new Ui::MainWindow) {
     ui-&gt;setupUi(this);
     <strong class="bold1">ui-&gt;stackedWidget-&gt;setCurrentIndex(0);</strong>
     <strong class="bold1">db = QSqlDatabase::addDatabase("QSQLITE");</strong>
     <strong class="bold1">db.setDatabaseName("database.db3");</strong>
     <strong class="bold1">if (!db.open()) {</strong>
           <strong class="bold1">qDebug() &lt;&lt; "Failed to connect to database.";</strong>
     <strong class="bold1">}</strong>
}</pre>
     </li>
     <li class="calibre14">
      Define what will
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker796">
      </a>
      happen if the
      <strong class="source-inline1">
       Login
      </strong>
      button
      <span>
       is clicked:
      </span>
      <pre class="source-code">
void MainWindow::on_loginButton_clicked() {
     QString username = ui-&gt;username-&gt;text();
     QString password = ui-&gt;password-&gt;text();
     QSqlQuery query;
     if (query.exec("SELECT user_employeeID from user WHERE user_username = '" + username + "' AND user_password = '" + password + "'")) {
           int resultSize = 0;
           while (query.next()) {
                 QString employeeID = query.value(0).toString();
                 QSqlQuery query2;</pre>
     </li>
     <li class="calibre14">
      Make a
      <span>
       SQL
      </span>
      <span>
       <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker797">
       </a>
      </span>
      <span>
       query:
      </span>
      <pre class="source-code">
                 if (query2.exec("SELECT emp_name, emp_age, emp_gender, emp_married FROM employee WHERE emp_id = " + employeeID)) {
                       while (query2.next()) {
                             QString name = query2.value(0).toString();
                             QString age = query2.value(1).toString();
                             int gender = query2.value(2).toInt();
                             bool married = query2.value(3).toBool();
                             ui-&gt;name-&gt;setText(name);
                             ui-&gt;age-&gt;setText(age);</pre>
     </li>
     <li class="calibre14">
      We continue with
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker798">
      </a>
      the preceding code, and we set the gender and married texts before switching the stacked widget to its
      <span>
       second page:
      </span>
      <pre class="source-code">
                             if (gender == 0)
                                   ui-&gt;gender-&gt;setText("Male");
                             else
                                   ui-&gt;gender-&gt;setText("Female");
                             if (married)
                                   ui-&gt;married-&gt;setText("Yes");
                             else
                                   ui-&gt;married-&gt;setText("No");
                             ui-&gt;stackedWidget-&gt;setCurrentIndex(1);
                       }
                 }
                 resultSize++;
           }</pre>
     </li>
     <li class="calibre14">
      Print an error
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker799">
      </a>
      message if the
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker800">
      </a>
      <span>
       login fails:
      </span>
      <pre class="source-code">
           if (resultSize == 0)
           {
                 QMessageBox::warning(this, "Login failed", "Invalid username or password.");
           }
     }
     else
     {
           qDebug() &lt;&lt; query.lastError().text();
     }
}</pre>
     </li>
     <li class="calibre14">
      Define what will happen
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker801">
      </a>
      if the
      <strong class="bold">
       Log Out
      </strong>
      button
      <span>
       is clicked:
      </span>
      <pre class="source-code">
void MainWindow::on_logoutButton_clicked() {
     ui-&gt;stackedWidget-&gt;setCurrentIndex(0);
}</pre>
     </li>
     <li class="calibre14">
      Close the database
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker802">
      </a>
      when the main window
      <span>
       is closed:
      </span>
      <pre class="source-code">
MainWindow::~MainWindow() {
     db.close();
     delete ui;
}</pre>
     </li>
     <li class="calibre14">
      Compile and run the program, and you should be able to log in with the dummy account. After you have logged in, you should be able to see the dummy employee information linked to the user account. You can also log out by clicking on the
      <strong class="bold">
       Log
      </strong>
      <span>
       <strong class="bold">
        Out
       </strong>
      </span>
      <span>
       button:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer203">
      <img alt="Figure 12.19 – A simple, working login screen" class="calibre4" src="image/B20976_12_019.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.19 – A simple, working login screen
    </p>
    <h2 class="calibre7" id="_idParaDest-257">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor257">
     </a>
     How it works…
    </h2>
    <p class="calibre3">
     In this example, we select data from the user table that matches the username and password that we inserted into the text fields. If nothing is found, it means we have provided an invalid username
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker803">
     </a>
     or password. Otherwise, obtain the
     <strong class="source-inline">
      user_employeeID
     </strong>
     data from the user account
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker804">
     </a>
     and do another SQL query to look for information from the
     <strong class="source-inline">
      employee
     </strong>
     table that matches the
     <strong class="source-inline">
      user_employeeID
     </strong>
     variable. Then, display the data according to the UI of
     <span>
      your program.
     </span>
    </p>
    <p class="calibre3">
     We must set the widget order in the
     <strong class="bold">
      Edit Tab Order
     </strong>
     mode so that when the program has started, the first widget that gets focused on is the username line-edit widget. If the user presses the
     <em class="italic">
      Tab
     </em>
     key on the keyboard, the focus should switch to the second widget, which is the password line edit. An incorrect widget order will ruin the user experience and drive away any potential users. Make sure that the
     <strong class="bold">
      echoMode
     </strong>
     option of the password line edit is set to
     <strong class="bold">
      Password
     </strong>
     . That setting will hide the actual password inserted into the line edit and replace it with dot symbols for
     <span>
      security purposes.
     </span>
    </p>
    <p class="calibre3">
     Since SQLite does not support returning the query size, we cannot use the
     <strong class="source-inline">
      QSqlQuery::size()
     </strong>
     function to determine how many results are being returned; the result will always be -
     <strong class="source-inline">
      1
     </strong>
     . Therefore, we declared a
     <strong class="source-inline">
      resultSize
     </strong>
     variable to count the result within the while
     <span>
      loop operation.
     </span>
    </p>
    <h1 class="calibre5" id="_idParaDest-258">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor258">
     </a>
     Displaying information from a database in model view
    </h1>
    <p class="calibre3">
     Follow these steps to display
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker805">
     </a>
     information from a database on a model
     <span>
      view widget:
     </span>
    </p>
    <h2 class="calibre7" id="_idParaDest-259">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor259">
     </a>
     How to do it…
    </h2>
    <p class="calibre3">
     In this recipe, we will learn how to display multiple sets of data obtained from our SQL database in a model view in
     <span>
      our program:
     </span>
    </p>
    <ol class="calibre13">
     <li class="calibre14">
      We will be using the database table called
      <strong class="source-inline1">
       employee
      </strong>
      , which we used in the previous example in
      <em class="italic">
       Creating a login screen with Qt
      </em>
      . This time, we need a lot more data in the employee table. Open up your
      <strong class="bold">
       SQLiteStudio
      </strong>
      control panel. Add data for a few more employees so that we can display it later in
      <span>
       our program:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer204">
      <img alt="Figure 12.20 – Add more dummy data to the employee table" class="calibre4" src="image/B20976_12_020.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.20 – Add more dummy data to the employee table
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="2">
      Open Qt Creator, create a new
      <strong class="bold">
       Qt Widgets Application
      </strong>
      project, and then add the
      <strong class="bold">
       SQL
      </strong>
      module to
      <span>
       your project.
      </span>
     </li>
     <li class="calibre14">
      Open
      <strong class="source-inline1">
       mainwindow.ui
      </strong>
      and add a table widget (not a table view) from
      <strong class="bold">
       Item Widget
      </strong>
      (item-based) under the
      <strong class="bold">
       Widget
      </strong>
      box pane. Select the main window on the canvas and click on
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker806">
      </a>
      either the
      <strong class="bold">
       Lay Out Vertically
      </strong>
      or
      <strong class="bold">
       Lay Out Horizontally
      </strong>
      button to make the table widget stick to the size of the main window even when
      <span>
       it’s resized:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer205">
      <img alt="Figure 12.21 – Click on the Lay Out Vertically button" class="calibre4" src="image/B20976_12_021.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.21 – Click on the Lay Out Vertically button
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="4">
      Double-click on the table widget and a window will appear. Under the
      <strong class="bold">
       Columns
      </strong>
      tab, add five items by clicking on the
      <strong class="bold">
       +
      </strong>
      button in the top-left corner. Name the items
      <strong class="bold">
       ID
      </strong>
      ,
      <strong class="bold">
       Name
      </strong>
      ,
      <strong class="bold">
       Age
      </strong>
      ,
      <strong class="bold">
       Gender
      </strong>
      , and
      <strong class="bold">
       Married
      </strong>
      . Click
      <strong class="bold">
       OK
      </strong>
      when
      <span>
       you’re done:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer206">
      <img alt="Figure 12.22 – We also set the text alignment to center" class="calibre4" src="image/B20976_12_022.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.22 – We also set the text alignment to center
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="5">
      Right-click on the table widget and select
      <strong class="bold">
       Go to slot…
      </strong>
      in the pop-up menu. Scroll all the way down, select the
      <strong class="source-inline1">
       itemChanged(QTableWidgetItem*)
      </strong>
      option in the pop-up
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker807">
      </a>
      window, and press
      <strong class="bold">
       OK
      </strong>
      . A slot function will be created in both of your
      <span>
       source files.
      </span>
     </li>
     <li class="calibre14">
      Open
      <strong class="source-inline1">
       mainwindow.h
      </strong>
      and add these private variables to the
      <span>
       <strong class="source-inline1">
        MainWindow
       </strong>
      </span>
      <span>
       class:
      </span>
      <pre class="source-code">
private:
     Ui::MainWindow *ui;
     <strong class="bold1">bool hasInit;</strong>
     <strong class="bold1">QSqlDatabase db;</strong></pre>
     </li>
     <li class="calibre14">
      Add the following class headers
      <span>
       to
      </span>
      <span>
       <strong class="source-inline1">
        mainwindow.h
       </strong>
      </span>
      <span>
       :
      </span>
      <pre class="source-code">
#include &lt;QtSql&gt;
#include &lt;QSqlDatabase&gt;
#include &lt;QSqlQuery&gt;
#include &lt;QMessageBox&gt;
#include &lt;QDebug&gt;
#include &lt;QTableWidgetItem&gt;</pre>
     </li>
     <li class="calibre14">
      Open
      <strong class="source-inline1">
       mainwindow.cpp
      </strong>
      ; we’re going to write tons of code there. We need to declare what will happen when the program is started. Add the following code to the constructor
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker808">
      </a>
      of the
      <span>
       <strong class="source-inline1">
        MainWindow
       </strong>
      </span>
      <span>
       class:
      </span>
      <pre class="source-code">
MainWindow::MainWindow(QWidget *parent) :
     QMainWindow(parent),
     ui(new Ui::MainWindow)
{
     <strong class="bold1">hasInit = false;</strong>
     ui-&gt;setupUi(this);
     <strong class="bold1">db = QSqlDatabase::addDatabase("QSQLITE");</strong>
     <strong class="bold1">db.setDatabaseName("database.db3");</strong>
     <strong class="bold1">ui-&gt;tableWidget-&gt;setColumnHidden(0, true);</strong></pre>
     </li>
     <li class="calibre14">
      The SQL query code looks
      <span>
       like this:
      </span>
      <pre class="source-code">
     if (db.open()) {
           QSqlQuery query;
           if (query.exec("SELECT emp_id, emp_name, emp_age, emp_gender, emp_married FROM employee")) {
                 while (query.next()) {
                       qDebug() &lt;&lt; query.value(0) &lt;&lt; query.value(1) &lt;&lt; query.value(2) &lt;&lt; query.value(3) &lt;&lt; query.value(4);
                       QString id = query.value(0).toString();
                       QString name = query.value(1).toString();
                       QString age = query.value(2).toString();
                       int gender = query.value(3).toInt();
                       bool married = query.value(4).toBool();</pre>
     </li>
     <li class="calibre14">
      Create
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker809">
      </a>
      several
      <span>
       <strong class="source-inline1">
        QTableWidgetItem
       </strong>
      </span>
      <span>
       objects:
      </span>
      <pre class="source-code">
                       ui-&gt;tableWidget-&gt;setRowCount(ui-&gt;tableWidget-&gt;rowCount() + 1);
                       QTableWidgetItem* idItem = new QTableWidgetItem(id);
                       QTableWidgetItem* nameItem = new QTableWidgetItem(name);
                       QTableWidgetItem* ageItem = new QTableWidgetItem(age);
                       QTableWidgetItem* genderItem = new QTableWidgetItem();
                       if (gender == 0)
                             genderItem-&gt;setData(0, "Male");
                       else
                             genderItem-&gt;setData(0, "Female");
                       QTableWidgetItem* marriedItem = new QTableWidgetItem();
                       if (married)
                             marriedItem-&gt;setData(0, "Yes");
                       else
                             marriedItem-&gt;setData(0, "No");</pre>
     </li>
     <li class="calibre14">
      Move those
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker810">
      </a>
      objects to the
      <span>
       table widget:
      </span>
      <pre class="source-code">
                       ui-&gt;tableWidget-&gt;setItem(ui-&gt;tableWidget-&gt;rowCount() - 1, 0, idItem);
                       ui-&gt;tableWidget-&gt;setItem(ui-&gt;tableWidget-&gt;rowCount() - 1, 1, nameItem);
                       ui-&gt;tableWidget-&gt;setItem(ui-&gt;tableWidget-&gt;rowCount() - 1, 2, ageItem);
                       ui-&gt;tableWidget-&gt;setItem(ui-&gt;tableWidget-&gt;rowCount() - 1, 3, genderItem);
                       ui-&gt;tableWidget-&gt;setItem(ui-&gt;tableWidget-&gt;rowCount() - 1, 4, marriedItem);
                 }
                 hasInit = true;
           }
           else {
                 qDebug() &lt;&lt; query.lastError().text();
           }
     }
     else {
           qDebug() &lt;&lt; "Failed to connect to database.";
     }
}</pre>
     </li>
     <li class="calibre14">
      Declare what will happen when an item of the table widget has been edited. Add the
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker811">
      </a>
      following code to the
      <strong class="source-inline1">
       on_tableWidget_itemChanged()
      </strong>
      <span>
       slot function:
      </span>
      <pre class="source-code">
void MainWindow::on_tableWidget_itemChanged(QTableWidgetItem *item) {
     if (hasInit) {
           QString id = ui-&gt;tableWidget-&gt;item(item-&gt;row(), 0)-&gt;data(0).toString();
           QString name = ui-&gt;tableWidget-&gt;item(item-&gt;row(), 1)-&gt;data(0).toString();
           QString age = QString::number(ui-&gt;tableWidget-&gt;item(item-&gt;row(), 2)-&gt;data(0).toInt());
           ui-&gt;tableWidget-&gt;item(item-&gt;row(), 2)-&gt;setData(0, age);
           QString gender;
           if (ui-&gt;tableWidget-&gt;item(item-&gt;row(), 3)-&gt;data(0).toString() == "Male") {
                 gender = "0";
           } else {
                 ui-&gt;tableWidget-&gt;item(item-&gt;row(), 3)-&gt;setData(0,"Female");
                 gender = "1";
           }
           QString married;
           if (ui-&gt;tableWidget-&gt;item(item-&gt;row(), 4)-&gt;data(0).toString() == "No") {
                 married = "0";
           } else {
                 ui-&gt;tableWidget-&gt;item(item-&gt;row(), 4)-&gt;setData(0, "Yes");
                 married = "1";
           }
           qDebug() &lt;&lt; id &lt;&lt; name &lt;&lt; age &lt;&lt; gender &lt;&lt; married;
           QSqlQuery query;
           if (query.exec("UPDATE employee SET emp_name = '" + name + "', emp_age = '" + age + "', emp_gender = '" + gender + "', emp_married = '" + married + "' WHERE emp_id = " + id)) {
                 QMessageBox::information(this, "Update Success", "Data updated to database.");
           } else {
                 qDebug() &lt;&lt; query.lastError().text();
           }
     }
}</pre>
     </li>
     <li class="calibre14">
      Close the
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker812">
      </a>
      database at the
      <span>
       class destructor:
      </span>
      <pre class="source-code">
MainWindow::~MainWindow() {
     db.close();
     delete ui;
}</pre>
     </li>
     <li class="calibre14">
      If you compile and run the example now, you should get something
      <span>
       like this:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer207">
      <img alt="Figure 12.23 – We have created our own SQL editor" class="calibre4" src="image/B20976_12_023.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.23 – We have created our own SQL editor
    </p>
    <h2 class="calibre7" id="_idParaDest-260">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor260">
     </a>
     How it works…
    </h2>
    <p class="calibre3">
     The table widget is similar to
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker813">
     </a>
     the one you see in spreadsheet
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker814">
     </a>
     applications such as
     <strong class="bold">
      Microsoft Excel
     </strong>
     and
     <strong class="bold">
      OpenOffice Calc
     </strong>
     . In contrast to other types of
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker815">
     </a>
     model viewers, such as list view or tree view, table view (or table widget) is a two-dimensional model viewer, which displays data in the form of rows
     <span>
      and columns.
     </span>
    </p>
    <p class="calibre3">
     The main difference between a table view and a table widget in Qt is that a table widget is built on top of a table view class, which means a table widget is easier to use and more suitable for beginners. However, a table widget is less flexible and tends to be less scalable than a table view, which is not the best choice if you want to customize your table. After retrieving data from SQLite, we created a
     <strong class="source-inline">
      QTableWidgetItem
     </strong>
     item for each of the data items and set which column and row should be added to the table widget. Before adding an item to the table widget, we must increase the row count of the table by calling
     <strong class="source-inline">
      QTableWidget::setRowCount()
     </strong>
     . We can also get the current row count of the table widget by simply
     <span>
      calling
     </span>
     <span>
      <strong class="source-inline">
       QTableWidget::rowCount()
      </strong>
     </span>
     <span>
      .
     </span>
    </p>
    <p class="calibre3">
     The first column from the left is hidden from view because we only use it to save the ID of the data so that we can use it to update the database when one of the data items in its row has changed. The
     <strong class="source-inline">
      on_tableWidget_itemChanged()
     </strong>
     slot function will be called when the data in one of the cells has changed. It will not only get called when you edit the data in the cell but also when the data are first added to the table after being retrieved from the database. To ensure that this function is only triggered when we edit the data, we use a Boolean
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker816">
     </a>
     variable called
     <strong class="source-inline">
      hasInit
     </strong>
     to check whether we have done the initialization process (adding the first batch of data to the table). If
     <strong class="source-inline">
      hasInit
     </strong>
     is false, ignore the
     <span>
      function call.
     </span>
    </p>
    <p class="calibre3">
     To prevent users from entering a totally irrelevant type of data, such as inserting letters into a numerical-only data cell, we manually check whether the data are anything close to what we’d expected when they were being edited. Revert it to a default value if it doesn’t come close to anything considered valid. This is, of course, a simple hack, which does the job but is not the most professional method. Alternatively, you can try to create a new class that inherits the
     <strong class="source-inline">
      QItemDelegate
     </strong>
     class and defines how your model view should behave. Then, call
     <strong class="source-inline">
      QTableWidget::setItemDelegate()
     </strong>
     to apply the class to your
     <span>
      table widget.
     </span>
    </p>
    <h1 class="calibre5" id="_idParaDest-261">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor261">
     </a>
     Advanced SQL queries
    </h1>
    <p class="calibre3">
     By following this
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker817">
     </a>
     recipe, you will learn how to use advanced SQL statements such as
     <strong class="source-inline">
      INNER
     </strong>
     <strong class="source-inline">
      JOIN
     </strong>
     ,
     <strong class="source-inline">
      COUNT
     </strong>
     ,
     <strong class="source-inline">
      LIKE
     </strong>
     ,
     <span>
      and
     </span>
     <span>
      <strong class="source-inline">
       DISTINCT
      </strong>
     </span>
     <span>
      .
     </span>
    </p>
    <h2 class="calibre7" id="_idParaDest-262">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor262">
     </a>
     How to do it…
    </h2>
    <p class="calibre3">
     You can do a lot more than just perform simple queries on the SQL database. Let’s follow these steps to
     <span>
      learn how:
     </span>
    </p>
    <ol class="calibre13">
     <li class="calibre14">
      We need to add a few tables to our database before we can dive into the programming part. Open your
      <strong class="bold">
       SQLiteStudio
      </strong>
      . We need several tables for this example
      <span>
       to work:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer208">
      <img alt="Figure 12.24 – Additional tables that we need to create for this example" class="calibre4" src="image/B20976_12_024.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.24 – Additional tables that we need to create for this example
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="2">
      I will show you the structure of each of the tables required for this project and the dummy data
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker818">
      </a>
      inserted into the tables for testing. The first table is called
      <strong class="source-inline1">
       branch
      </strong>
      , which is used to store the IDs and names of different branches of the
      <span>
       dummy company:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer209">
      <img alt="Figure 12.25 – The branch table" class="calibre4" src="image/B20976_12_025.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.25 – The branch table
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="3">
      Secondly, we have the
      <strong class="source-inline1">
       department
      </strong>
      table, which stores the IDs and names of different departments of the dummy company, which is also linked to the
      <strong class="source-inline1">
       branch
      </strong>
      data by the
      <span>
       branch IDs:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer210">
      <img alt="Figure 12.26 – The department table, which links to the branch table" class="calibre4" src="image/B20976_12_026.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.26 – The department table, which links to the branch table
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="4">
      We also have an
      <strong class="source-inline1">
       employee
      </strong>
      table, which stores information on all the employees in the dummy
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker819">
      </a>
      company. This table is similar to the one we used in the previous examples, except it has two extra columns,
      <strong class="source-inline1">
       emp_birthday
      </strong>
      <span>
       and
      </span>
      <span>
       <strong class="source-inline1">
        emp_departmentID
       </strong>
      </span>
      <span>
       :
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer211">
      <img alt="Figure 12.27 – The employee table, which links to the department table" class="calibre4" src="image/B20976_12_027.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.27 – The employee table, which links to the department table
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="5">
      We also have a table called
      <strong class="source-inline1">
       log
      </strong>
      , which contains dummy records of the login time for each employee.
      <strong class="source-inline1">
       log_loginTime
      </strong>
      will be set as a date-time
      <span>
       variable type:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer212">
      <img alt="Figure 12.28 – The log table, which links to the user table" class="calibre4" src="image/B20976_12_028.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.28 – The log table, which links to the user table
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="6">
      We have the
      <strong class="source-inline1">
       user
      </strong>
      table that
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker820">
      </a>
      we also used in the
      <span>
       previous examples:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer213">
      <img alt="Figure 12.29 – The user table" class="calibre4" src="image/B20976_12_029.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.29 – The user table
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="7">
      Open Qt Creator. This time, instead of choosing
      <strong class="bold">
       Qt Widgets Application
      </strong>
      , we select
      <strong class="bold">
       Qt
      </strong>
      <span>
       <strong class="bold">
        Console Application
       </strong>
      </span>
      <span>
       :
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer214">
      <img alt="Figure 12.30 – Create a Qt Console Application project" class="calibre4" src="image/B20976_12_030.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.30 – Create a Qt Console Application project
    </p>
    <ol class="calibre13">
     <li class="calibre14" value="8">
      Open your project file (.pro) and add the
      <strong class="source-inline1">
       sql
      </strong>
      module to
      <span>
       your project:
      </span>
      <pre class="source-code">
QT += core <strong class="bold1">sql</strong>
<strong class="bold1">QT -= gui</strong></pre>
     </li>
     <li class="calibre14">
      Open
      <strong class="source-inline1">
       main.cpp
      </strong>
      and add
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker821">
      </a>
      the following header files to the top of the
      <span>
       source file:
      </span>
      <pre class="source-code">
#include &lt;QSqlDatabase&gt;
#include &lt;QSqlQuery&gt;
#include &lt;QSqlError&gt;
#include &lt;QDate&gt;
#include &lt;QDebug&gt;</pre>
     </li>
     <li class="calibre14">
      Add the following function to display employees who are more than 30
      <span>
       years old:
      </span>
      <pre class="source-code">
void filterAge() {
     qDebug() &lt;&lt; "== Employees above 40 year old =============";
     QSqlQuery query;
     if (query.exec("SELECT emp_name, emp_age FROM employee WHERE emp_age &gt; 40")) {
           while (query.next()) {
                 qDebug() &lt;&lt; query.value(0).toString() &lt;&lt; query.value(1).toString();
           }
     }
     else {
     qDebug() &lt;&lt; query.lastError().text();
     }
}</pre>
     </li>
     <li class="calibre14">
      Add the following
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker822">
      </a>
      function to display the
      <strong class="source-inline1">
       department
      </strong>
      and
      <strong class="source-inline1">
       branch
      </strong>
      information of
      <span>
       each employee:
      </span>
      <pre class="source-code">
void getDepartmentAndBranch() {
     qDebug() &lt;&lt; "== Get employees' department and branch =============";
     QSqlQuery query;
     if (query.exec("SELECT emp_name, dep_name, brh_name FROM (SELECT emp_name, emp_departmentID FROM employee) AS myEmployee INNER JOIN department ON department.dep_id = myEmployee.emp_departmentID INNER JOIN branch ON branch.brh_id = department.dep_branchID")) {
           while (query.next()) {
                 qDebug() &lt;&lt; query.value(0).toString() &lt;&lt; query.value(1).toString() &lt;&lt; query.value(2).toString();
           }
     }
     else {
           qDebug() &lt;&lt; query.lastError().text();
     }
}</pre>
     </li>
     <li class="calibre14">
      Add the following function, which displays employees who are working in the New York branch and are
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker823">
      </a>
      under 40
      <span>
       years old:
      </span>
      <pre class="source-code">
void filterBranchAndAge() {
     qDebug() &lt;&lt; "== Employees from New York and age below 40 =============";
     QSqlQuery query;
     if (query.exec("SELECT emp_name, emp_age, dep_name, brh_name FROM (SELECT emp_name, emp_age, emp_departmentID FROM employee) AS myEmployee INNER JOIN department ON department.dep_id = myEmployee.emp_departmentID INNER JOIN branch ON branch.brh_id = department.dep_branchID WHERE branch.brh_name = 'New York' AND myEmployee.emp_age &lt; 40")) {
           while (query.next()) {
                 qDebug() &lt;&lt; query.value(0).toString() &lt;&lt; query.value(1).toString() &lt;&lt; query.value(2).toString() &lt;&lt; query.value(3).toString();
           }
     }
     else {
     qDebug() &lt;&lt; query.lastError().text();
     }
}</pre>
     </li>
     <li class="calibre14">
      Add the following function, which
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker824">
      </a>
      counts the total number of female employees in the
      <span>
       dummy company:
      </span>
      <pre class="source-code">
void countFemale() {
     qDebug() &lt;&lt; "== Count female employees =============";
     QSqlQuery query;
     if (query.exec("SELECT COUNT(emp_gender) FROM employee WHERE emp_gender = 1")) {
           while (query.next()) {
                 qDebug() &lt;&lt; query.value(0).toString();
           }
     }
     else {
           qDebug() &lt;&lt; query.lastError().text();
     }
}</pre>
     </li>
     <li class="calibre14">
      Add the following
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker825">
      </a>
      function, which filters the employee list and only displays those names that start
      <span>
       with
      </span>
      <span>
       <strong class="source-inline1">
        Ja
       </strong>
      </span>
      <span>
       :
      </span>
      <pre class="source-code">
void filterName() {
     qDebug() &lt;&lt; "== Employees name start with 'Ja' =============";
     QSqlQuery query;
     if (query.exec("SELECT emp_name FROM employee WHERE emp_name LIKE '%Ja%'")) {
           while (query.next()) {
                 qDebug() &lt;&lt; query.value(0).toString();
           }
     }
     else {
           qDebug() &lt;&lt; query.lastError().text();
     }
}</pre>
     </li>
     <li class="calibre14">
      Add the following function, which
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker826">
      </a>
      displays employees who have birthdays
      <span>
       in August:
      </span>
      <pre class="source-code">
void filterBirthday() {
     qDebug() &lt;&lt; "== Employees birthday in August =============";
     QSqlQuery query;
     if (query.exec("SELECT emp_name, emp_birthday FROM employee WHERE strftime('%m', emp_birthday) = '08'")) {
           while (query.next()) {
                 qDebug() &lt;&lt; query.value(0).toString() &lt;&lt; query.value(1).toDate().toString("d-MMMM-yyyy");
           }
     }
     else {
           qDebug() &lt;&lt; query.lastError().text();
     }
}</pre>
     </li>
     <li class="calibre14">
      Add the following function, which checks who logged into the dummy system on 27 April 2024 and displays
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker827">
      </a>
      their names on
      <span>
       the terminal:
      </span>
      <pre class="source-code">
void checkLog() {
     qDebug() &lt;&lt; "== Employees who logged in on 27 April 2024 =============";
     QSqlQuery query;
     if (query.exec("SELECT DISTINCT emp_name FROM (SELECT emp_id, emp_name FROM employee) AS myEmployee INNER JOIN user ON user.user_employeeID = myEmployee.emp_id INNER JOIN log ON log.log_userID = user.user_id WHERE DATE(log.log_loginTime) = '2024-04-27'")) {
           while (query.next()) {
                 qDebug() &lt;&lt; query.value(0).toString();
           }
     }
     else {
           qDebug() &lt;&lt; query.lastError().text();
     }
}</pre>
     </li>
     <li class="calibre14">
      In the
      <strong class="source-inline1">
       main()
      </strong>
      function, connect the program to the SQLite database and call all the functions that we defined in the previous steps. Close the database connection, and
      <span>
       we’re done:
      </span>
      <pre class="source-code">
int main(int argc, char *argv[]) {
     QCoreApplication a(argc, argv);
     QSqlDatabase db = QSqlDatabase::addDatabase("QSQLITE");
     db.setDatabaseName("database.db3");
     if (db.open()) {
           filterAge();
           getDepartmentAndBranch();
           filterBranchAndAge();
           countFemale();
           filterName();
           filterBirthday();
           checkLog();
           db.close();
     }
     else {
           qDebug() &lt;&lt; "Failed to connect to database.";
     }
     return a.exec();
}</pre>
     </li>
     <li class="calibre14">
      If you compile and run the project now, you
      <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker828">
      </a>
      should see a terminal window that displays the
      <span>
       filtered results:
      </span>
     </li>
    </ol>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer215">
      <img alt="Figure 12.31 – Printing the results on the Application Output window" class="calibre4" src="image/B20976_12_031.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.31 – Printing the results on the Application Output window
    </p>
    <h2 class="calibre7" id="_idParaDest-263">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor263">
     </a>
     How it works…
    </h2>
    <p class="calibre3">
     A console application does
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker829">
     </a>
     not have a GUI and only shows you a text display in a terminal window. This is usually used in a backend system, as it uses fewer resources compared to a widget application. We used it in this example because it’s faster to display the result without the need to place any widgets in the program, which we don’t need in
     <span>
      this case.
     </span>
    </p>
    <p class="calibre3">
     We separated the SQL queries into different functions so that it’s easier to maintain the code and it doesn’t become too messy. Do note that in C++, the functions have to be located before the
     <strong class="source-inline">
      main()
     </strong>
     function; otherwise, they will not be able to be called
     <span>
      by
     </span>
     <span>
      <strong class="source-inline">
       main()
      </strong>
     </span>
     <span>
      .
     </span>
    </p>
    <h2 class="calibre7" id="_idParaDest-264">
     <a class="pcalibre pcalibre1 calibre6" id="_idTextAnchor264">
     </a>
     There’s more…
    </h2>
    <p class="calibre3">
     The
     <strong class="source-inline">
      INNER JOIN
     </strong>
     statement used in the preceding example joins two tables together and selects all rows from both tables, as long as there is a match between the columns in both tables. There are many other types of
     <strong class="source-inline">
      JOIN
     </strong>
     statements that you can use in SQLite (and some other types of SQL architecture), such as
     <strong class="source-inline">
      LEFT JOIN
     </strong>
     ,
     <strong class="source-inline">
      RIGHT JOIN
     </strong>
     , and
     <strong class="source-inline">
      FULL
     </strong>
     <span>
      <strong class="source-inline">
       OUTER JOIN
      </strong>
     </span>
     <span>
      .
     </span>
    </p>
    <p class="calibre3">
     The following diagram shows the different types of
     <strong class="source-inline">
      JOIN
     </strong>
     statements and
     <span>
      their effects:
     </span>
    </p>
    <div class="calibre2">
     <div class="img---figure" id="_idContainer216">
      <img alt="Figure 12.32 – Different types of JOIN statements" class="calibre4" src="image/B20976_12_032.jpg"/>
     </div>
    </div>
    <p class="img---caption" lang="en-US" xml:lang="en-US">
     Figure 12.32 – Different types of JOIN statements
    </p>
    <p class="calibre3">
     The following bullet points explain the
     <strong class="source-inline">
      LIKE
     </strong>
     and
     <strong class="source-inline">
      DISTINCT
     </strong>
     statements, which we used in our example code in
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker830">
     </a>
     <span>
      this recipe:
     </span>
    </p>
    <ul class="calibre15">
     <li class="calibre14">
      The
      <strong class="source-inline1">
       LIKE
      </strong>
      statement is normally used to search for a string variable in the database without the full word. Notice that there are two % symbols located before and after the
      <span>
       search keyword.
      </span>
     </li>
     <li class="calibre14">
      The
      <strong class="source-inline1">
       DISTINCT
      </strong>
      statement used in the previous example filters out results that have the exact same variable. For example, without the
      <strong class="source-inline1">
       DISTINCT
      </strong>
      statement, you will see two versions of Larry King appear in the terminal because there are two records of him logging into the system on the same day. By adding the
      <strong class="source-inline1">
       DISTINCT
      </strong>
      statement, SQLite will eliminate one of the results and ensure every result
      <span>
       is unique.
      </span>
     </li>
     <li class="calibre14">
      You may be wondering what
      <strong class="source-inline1">
       d-MMMM-yyyy
      </strong>
      stands for and why we used it in the preceding example. That is actually an expression supplied to the
      <strong class="source-inline1">
       QDateTime
      </strong>
      class in Qt to display the date-time result using a given format. In this case, it will change the date-time data that we get from SQLite, 2024-08-06, to the format that we specified, resulting
      <span>
       in 6-August-2024.
      </span>
     </li>
    </ul>
    <p class="calibre3">
     For more information, check out Qt’s documentation at
     <a class="pcalibre pcalibre1 calibre6" href="http://doc.qt.io/qt-6/qdatetime.html#toString">
      http://doc.qt.io/qt-6/qdatetime.html#toString
     </a>
     , which has the full list of expressions that can be used to determine the format of the date and
     <span>
      time string.
     </span>
    </p>
    <p class="calibre3">
     SQL provides an easy and efficient way to save
     <a class="pcalibre pcalibre1 calibre6" id="_idIndexMarker831">
     </a>
     and load user data without reinventing the wheel. Qt provides you with an out-of-the-box solution for connecting your application with a SQL database; in this chapter, we have learned how to do this by using a step-by-step approach, and we were able to load and save our user’s data into the
     <span>
      SQL database.
     </span>
    </p>
   </div>
  </div>
 </body>
</html>
